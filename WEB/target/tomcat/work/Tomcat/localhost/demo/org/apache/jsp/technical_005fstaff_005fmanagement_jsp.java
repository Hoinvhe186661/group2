/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.47
 * Generated at: 2025-11-12 05:57:18 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import java.util.Set;

public final class technical_005fstaff_005fmanagement_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {


    String formatDate(java.sql.Timestamp ts) {
        if (ts == null) return "-";
        try {
            java.text.SimpleDateFormat sdf = new java.text.SimpleDateFormat("dd/MM/yyyy");
            return sdf.format(ts);
        } catch (Exception e) {
            return "-";
        }
    }
    
    String getPriorityLabel(String priority) {
        if (priority == null) return "N/A";
        if ("urgent".equals(priority)) return "Khẩn cấp";
        if ("high".equals(priority)) return "Cao";
        if ("medium".equals(priority)) return "Trung bình";
        if ("low".equals(priority)) return "Thấp";
        return priority;
    }
    
    String getStatusLabel(String status) {
        if (status == null) return "N/A";
        if ("pending".equals(status)) return "Chờ xử lý";
        if ("in_progress".equals(status)) return "Đang thực hiện";
        if ("completed".equals(status)) return "Hoàn thành";
        if ("rejected".equals(status)) return "Đã từ chối";
        if ("cancelled".equals(status)) return "Đã hủy";
        return status;
    }

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n");
      out.write("\r\n");

    // Kiểm tra đăng nhập
    String username = (String) session.getAttribute("username");
    Boolean isLoggedIn = (Boolean) session.getAttribute("isLoggedIn");
    String userRole = (String) session.getAttribute("userRole");
    
    if (username == null || isLoggedIn == null || !isLoggedIn) {
        response.sendRedirect(request.getContextPath() + "/login.jsp");
        return;
    }
    
    // Kiểm tra quyền: chỉ người có quyền manage_technical_staff mới truy cập được
    @SuppressWarnings("unchecked")
    Set<String> userPermissions = (Set<String>) session.getAttribute("userPermissions");
    if (userPermissions == null || !userPermissions.contains("manage_technical_staff")) {
        response.sendRedirect(request.getContextPath() + "/error/403.jsp");
        return;
    }
    
    // Lấy tham số filter và pagination
    String pageParam = request.getParameter("page");
    String sizeParam = request.getParameter("size");
    int currentPage = 1;
    int pageSize = 10;
    try { if (pageParam != null) currentPage = Integer.parseInt(pageParam); } catch (Exception ignored) {}
    try { if (sizeParam != null) pageSize = Integer.parseInt(sizeParam); } catch (Exception ignored) {}
    if (currentPage < 1) currentPage = 1;
    if (pageSize < 1) pageSize = 10;
    
    String statusFilter = request.getParameter("status");
    String priorityFilter = request.getParameter("priority");
    String searchKeyword = request.getParameter("q");
    String startDateFromParam = request.getParameter("startDateFrom");
    String startDateToParam = request.getParameter("startDateTo");
    String deadlineFromParam = request.getParameter("deadlineFrom");
    String deadlineToParam = request.getParameter("deadlineTo");
    
    // Normalize empty strings to null
    if (statusFilter != null && statusFilter.trim().isEmpty()) statusFilter = null;
    if (priorityFilter != null && priorityFilter.trim().isEmpty()) priorityFilter = null;
    if (searchKeyword != null && searchKeyword.trim().isEmpty()) searchKeyword = null;
    
    // Parse date parameters
    java.sql.Date startDateFrom = null;
    java.sql.Date startDateTo = null;
    java.sql.Date deadlineFrom = null;
    java.sql.Date deadlineTo = null;
    try {
        if (startDateFromParam != null && !startDateFromParam.trim().isEmpty()) {
            startDateFrom = java.sql.Date.valueOf(startDateFromParam);
        }
    } catch (Exception ignored) {}
    try {
        if (startDateToParam != null && !startDateToParam.trim().isEmpty()) {
            startDateTo = java.sql.Date.valueOf(startDateToParam);
        }
    } catch (Exception ignored) {}
    try {
        if (deadlineFromParam != null && !deadlineFromParam.trim().isEmpty()) {
            deadlineFrom = java.sql.Date.valueOf(deadlineFromParam);
        }
    } catch (Exception ignored) {}
    try {
        if (deadlineToParam != null && !deadlineToParam.trim().isEmpty()) {
            deadlineTo = java.sql.Date.valueOf(deadlineToParam);
        }
    } catch (Exception ignored) {}
    
    // Load data từ DAO
    com.hlgenerator.dao.WorkOrderTaskDAO taskDAO = new com.hlgenerator.dao.WorkOrderTaskDAO();
    java.util.Map<String, Object> result = taskDAO.getTechnicalStaffTasksFlatList(statusFilter, priorityFilter, searchKeyword, 
            startDateFrom, startDateTo, deadlineFrom, deadlineTo, currentPage, pageSize);
    java.util.List<java.util.Map<String, Object>> tasks = (java.util.List<java.util.Map<String, Object>>) result.get("data");
    int total = (Integer) result.get("total");
    int totalPages = (int) Math.ceil(total / (double) pageSize);
    if (totalPages == 0) totalPages = 1;
    if (currentPage > totalPages) currentPage = totalPages;
    
    // Helper function để format date
    java.text.SimpleDateFormat dateFormat = new java.text.SimpleDateFormat("dd/MM/yyyy");

      out.write('\r');
      out.write('\n');
      out.write("\r\n");
      out.write("<!DOCTYPE html>\r\n");
      out.write("<html>\r\n");
      out.write("<head>\r\n");
      out.write("    <meta charset=\"UTF-8\">\r\n");
      out.write("    <title>Quản Lý Nhân Viên Kỹ Thuật | HL Generator</title>\r\n");
      out.write("    <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>\r\n");
      out.write("    \r\n");
      out.write("    <!-- bootstrap 3.0.2 -->\r\n");
      out.write("    <link href=\"css/bootstrap.min.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n");
      out.write("    <!-- font Awesome -->\r\n");
      out.write("    <link href=\"css/font-awesome.min.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n");
      out.write("    <!-- Ionicons -->\r\n");
      out.write("    <link href=\"css/ionicons.min.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n");
      out.write("    <!-- DataTables -->\r\n");
      out.write("    <link href=\"css/datatables/dataTables.bootstrap.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n");
      out.write("    <!-- Theme style -->\r\n");
      out.write("    <link href=\"css/style.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n");
      out.write("    \r\n");
      out.write("    <style>\r\n");
      out.write("        .filter-section {\r\n");
      out.write("            background-color: #f8f9fa;\r\n");
      out.write("            border: 1px solid #dee2e6;\r\n");
      out.write("            border-radius: 6px;\r\n");
      out.write("            padding: 15px;\r\n");
      out.write("            margin-bottom: 15px;\r\n");
      out.write("        }\r\n");
      out.write("        .filter-header {\r\n");
      out.write("            display: flex;\r\n");
      out.write("            justify-content: space-between;\r\n");
      out.write("            align-items: center;\r\n");
      out.write("            margin-bottom: 10px;\r\n");
      out.write("            cursor: pointer;\r\n");
      out.write("        }\r\n");
      out.write("        .filter-content {\r\n");
      out.write("            display: none;\r\n");
      out.write("        }\r\n");
      out.write("        .filter-content.show {\r\n");
      out.write("            display: block;\r\n");
      out.write("        }\r\n");
      out.write("        .filter-content .filter-row {\r\n");
      out.write("            display: flex;\r\n");
      out.write("            gap: 8px;\r\n");
      out.write("            align-items: flex-end;\r\n");
      out.write("            margin-bottom: 10px;\r\n");
      out.write("        }\r\n");
      out.write("        .filter-group {\r\n");
      out.write("            flex: 1;\r\n");
      out.write("            min-width: 150px;\r\n");
      out.write("        }\r\n");
      out.write("        .filter-group.small {\r\n");
      out.write("            flex: 0 0 120px;\r\n");
      out.write("        }\r\n");
      out.write("        .filter-group label {\r\n");
      out.write("            display: block;\r\n");
      out.write("            margin-bottom: 5px;\r\n");
      out.write("            font-weight: normal;\r\n");
      out.write("            font-size: 12px;\r\n");
      out.write("        }\r\n");
      out.write("        .filter-actions {\r\n");
      out.write("            display: flex;\r\n");
      out.write("            gap: 8px;\r\n");
      out.write("            align-items: flex-end;\r\n");
      out.write("        }\r\n");
      out.write("        .filter-actions .btn {\r\n");
      out.write("            height: 32px;\r\n");
      out.write("            padding: 6px 14px;\r\n");
      out.write("            font-size: 12px;\r\n");
      out.write("            white-space: nowrap;\r\n");
      out.write("        }\r\n");
      out.write("        .badge {\r\n");
      out.write("            padding: 4px 10px;\r\n");
      out.write("            font-size: 11px;\r\n");
      out.write("            font-weight: 600;\r\n");
      out.write("            border-radius: 12px;\r\n");
      out.write("        }\r\n");
      out.write("        .badge-urgent { background-color: #d9534f !important; color: white; }\r\n");
      out.write("        .badge-high { background-color: #f0ad4e !important; color: white; }\r\n");
      out.write("        .badge-medium { background-color: #5bc0de !important; color: white; }\r\n");
      out.write("        .badge-low { background-color: #5cb85c !important; color: white; }\r\n");
      out.write("        .badge-pending { background-color: #f0ad4e !important; color: white; }\r\n");
      out.write("        .badge-in_progress { background-color: #5bc0de !important; color: white; }\r\n");
      out.write("        .badge-completed { background-color: #5cb85c !important; color: white; }\r\n");
      out.write("        .badge-rejected { background-color: #d9534f !important; color: white; }\r\n");
      out.write("        .badge-cancelled { background-color: #777 !important; color: white; }\r\n");
      out.write("        #filterToggleIcon {\r\n");
      out.write("            transition: transform 0.3s;\r\n");
      out.write("        }\r\n");
      out.write("        #filterToggleIcon.rotated {\r\n");
      out.write("            transform: rotate(180deg);\r\n");
      out.write("        }\r\n");
      out.write("        @media (max-width: 768px) {\r\n");
      out.write("            .filter-row {\r\n");
      out.write("                flex-direction: column;\r\n");
      out.write("                align-items: stretch;\r\n");
      out.write("            }\r\n");
      out.write("            .filter-group {\r\n");
      out.write("                min-width: 100%;\r\n");
      out.write("            }\r\n");
      out.write("            .filter-actions {\r\n");
      out.write("                width: 100%;\r\n");
      out.write("            }\r\n");
      out.write("            .filter-actions .btn {\r\n");
      out.write("                flex: 1;\r\n");
      out.write("            }\r\n");
      out.write("        }\r\n");
      out.write("    </style>\r\n");
      out.write("</head>\r\n");
      out.write("<body class=\"skin-black\">\r\n");
      out.write("    <!-- header logo -->\r\n");
      out.write("    <header class=\"header\">\r\n");
      out.write("        <a href=\"headtech.jsp\" class=\"logo\">\r\n");
      out.write("            Quản Lý Nhân Viên Kỹ Thuật\r\n");
      out.write("        </a>\r\n");
      out.write("        <!-- Header Navbar -->\r\n");
      out.write("        <nav class=\"navbar navbar-static-top\" role=\"navigation\">\r\n");
      out.write("            <!-- Sidebar toggle button-->\r\n");
      out.write("            <a href=\"#\" class=\"navbar-btn sidebar-toggle\" data-toggle=\"offcanvas\" role=\"button\">\r\n");
      out.write("                <span class=\"sr-only\">Toggle navigation</span>\r\n");
      out.write("                <span class=\"icon-bar\"></span>\r\n");
      out.write("                <span class=\"icon-bar\"></span>\r\n");
      out.write("                <span class=\"icon-bar\"></span>\r\n");
      out.write("            </a>\r\n");
      out.write("            <div class=\"navbar-right\">\r\n");
      out.write("                <ul class=\"nav navbar-nav\">\r\n");
      out.write("                    <!-- User Account -->\r\n");
      out.write("                    <li class=\"dropdown user user-menu\">\r\n");
      out.write("                        <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">\r\n");
      out.write("                            <i class=\"fa fa-user\"></i>\r\n");
      out.write("                            <span>");
      out.print( username );
      out.write(" <i class=\"caret\"></i></span>\r\n");
      out.write("                        </a>\r\n");
      out.write("                        <ul class=\"dropdown-menu dropdown-custom dropdown-menu-right\">\r\n");
      out.write("                            <li class=\"dropdown-header text-center\">Tài khoản</li>\r\n");
      out.write("                            <li>\r\n");
      out.write("                                <a href=\"profile.jsp\">\r\n");
      out.write("                                <i class=\"fa fa-user fa-fw pull-right\"></i>\r\n");
      out.write("                                    Hồ sơ\r\n");
      out.write("                                </a>\r\n");
      out.write("                                <a href=\"settings.jsp\">\r\n");
      out.write("                                <i class=\"fa fa-cog fa-fw pull-right\"></i>\r\n");
      out.write("                                    Cài đặt\r\n");
      out.write("                                </a>\r\n");
      out.write("                            </li>\r\n");
      out.write("                            <li class=\"divider\"></li>\r\n");
      out.write("                            <li>\r\n");
      out.write("                                <a href=\"logout\"><i class=\"fa fa-ban fa-fw pull-right\"></i> Đăng xuất</a>\r\n");
      out.write("                            </li>\r\n");
      out.write("                        </ul>\r\n");
      out.write("                    </li>\r\n");
      out.write("                </ul>\r\n");
      out.write("            </div>\r\n");
      out.write("        </nav>\r\n");
      out.write("    </header>\r\n");
      out.write("    \r\n");
      out.write("    <div class=\"wrapper row-offcanvas row-offcanvas-left\">\r\n");
      out.write("\t\t");
      org.apache.jasper.runtime.JspRuntimeLibrary.include(request, response, "partials/sidebar.jsp", out, false);
      out.write("\r\n");
      out.write("\r\n");
      out.write("        <aside class=\"right-side\">\r\n");
      out.write("            <section class=\"content-header\">\r\n");
      out.write("                <h1>\r\n");
      out.write("                    Quản Lý Nhân Viên Kỹ Thuật\r\n");
      out.write("                    <small>Xem công việc của từng nhân viên</small>\r\n");
      out.write("                </h1>\r\n");
      out.write("                <ol class=\"breadcrumb\">\r\n");
      out.write("                    <li><a href=\"headtech.jsp\"><i class=\"fa fa-dashboard\"></i> Trang chủ</a></li>\r\n");
      out.write("                    <li class=\"active\">Quản lý nhân viên kỹ thuật</li>\r\n");
      out.write("                </ol>\r\n");
      out.write("            </section>\r\n");
      out.write("\r\n");
      out.write("            <section class=\"content\">\r\n");
      out.write("                <div class=\"row\">\r\n");
      out.write("                    <div class=\"col-xs-12\">\r\n");
      out.write("                        <div class=\"panel\">\r\n");
      out.write("                            <header class=\"panel-heading\">\r\n");
      out.write("                                <h3>Danh sách nhiệm vụ nhân viên kỹ thuật</h3>\r\n");
      out.write("                            </header>\r\n");
      out.write("                            <div class=\"panel-body table-responsive\">\r\n");
      out.write("                                <div class=\"filter-section\">\r\n");
      out.write("                                    <div class=\"filter-header\" onclick=\"toggleFilters()\">\r\n");
      out.write("                                        <h4><i class=\"fa fa-filter\"></i> Bộ lọc</h4>\r\n");
      out.write("                                        <i class=\"fa fa-chevron-down\" id=\"filterToggleIcon\"></i>\r\n");
      out.write("                                    </div>\r\n");
      out.write("                                    <div class=\"filter-content\" id=\"filterContent\">\r\n");
      out.write("                                        <form method=\"get\" action=\"technical_staff_management.jsp\">\r\n");
      out.write("                                            <div class=\"filter-row\">\r\n");
      out.write("                                                <div class=\"filter-group\">\r\n");
      out.write("                                                    <label for=\"statusFilter\">Trạng thái</label>\r\n");
      out.write("                                                    <select class=\"form-control\" id=\"statusFilter\" name=\"status\">\r\n");
      out.write("                                                        <option value=\"\" ");
      out.print( statusFilter == null || "".equals(statusFilter) ? "selected" : "" );
      out.write(">Tất cả</option>\r\n");
      out.write("                                                        <option value=\"pending\" ");
      out.print( "pending".equals(statusFilter) ? "selected" : "" );
      out.write(">Chờ xử lý</option>\r\n");
      out.write("                                                        <option value=\"in_progress\" ");
      out.print( "in_progress".equals(statusFilter) ? "selected" : "" );
      out.write(">Đang thực hiện</option>\r\n");
      out.write("                                                        <option value=\"completed\" ");
      out.print( "completed".equals(statusFilter) ? "selected" : "" );
      out.write(">Hoàn thành</option>\r\n");
      out.write("                                                        <option value=\"rejected\" ");
      out.print( "rejected".equals(statusFilter) ? "selected" : "" );
      out.write(">Đã từ chối</option>\r\n");
      out.write("                                                        <option value=\"cancelled\" ");
      out.print( "cancelled".equals(statusFilter) ? "selected" : "" );
      out.write(">Đã hủy</option>\r\n");
      out.write("                                                    </select>\r\n");
      out.write("                                                </div>\r\n");
      out.write("                                                <div class=\"filter-group\">\r\n");
      out.write("                                                    <label for=\"priorityFilter\">Độ ưu tiên</label>\r\n");
      out.write("                                                    <select class=\"form-control\" id=\"priorityFilter\" name=\"priority\">\r\n");
      out.write("                                                        <option value=\"\" ");
      out.print( priorityFilter == null || "".equals(priorityFilter) ? "selected" : "" );
      out.write(">Tất cả</option>\r\n");
      out.write("                                                        <option value=\"urgent\" ");
      out.print( "urgent".equals(priorityFilter) ? "selected" : "" );
      out.write(">Khẩn cấp</option>\r\n");
      out.write("                                                        <option value=\"high\" ");
      out.print( "high".equals(priorityFilter) ? "selected" : "" );
      out.write(">Cao</option>\r\n");
      out.write("                                                        <option value=\"medium\" ");
      out.print( "medium".equals(priorityFilter) ? "selected" : "" );
      out.write(">Trung bình</option>\r\n");
      out.write("                                                        <option value=\"low\" ");
      out.print( "low".equals(priorityFilter) ? "selected" : "" );
      out.write(">Thấp</option>\r\n");
      out.write("                                                    </select>\r\n");
      out.write("                                                </div>\r\n");
      out.write("                                                <div class=\"filter-group\">\r\n");
      out.write("                                                    <label for=\"search\">Tìm kiếm</label>\r\n");
      out.write("                                                    <input type=\"text\" class=\"form-control\" id=\"search\" name=\"q\" placeholder=\"Tên NV, mã task, mô tả...\" value=\"");
      out.print( searchKeyword != null ? searchKeyword : "" );
      out.write("\">\r\n");
      out.write("                                                </div>\r\n");
      out.write("                                            </div>\r\n");
      out.write("                                            <div class=\"filter-row\">\r\n");
      out.write("                                                <div class=\"filter-group\">\r\n");
      out.write("                                                    <label for=\"startDateFrom\">Ngày giao từ</label>\r\n");
      out.write("                                                    <input type=\"date\" class=\"form-control\" id=\"startDateFrom\" name=\"startDateFrom\" value=\"");
      out.print( startDateFromParam != null ? startDateFromParam : "" );
      out.write("\">\r\n");
      out.write("                                                </div>\r\n");
      out.write("                                                <div class=\"filter-group\">\r\n");
      out.write("                                                    <label for=\"startDateTo\">Ngày giao đến</label>\r\n");
      out.write("                                                    <input type=\"date\" class=\"form-control\" id=\"startDateTo\" name=\"startDateTo\" value=\"");
      out.print( startDateToParam != null ? startDateToParam : "" );
      out.write("\">\r\n");
      out.write("                                                </div>\r\n");
      out.write("                                                <div class=\"filter-group\">\r\n");
      out.write("                                                    <label for=\"deadlineFrom\">Deadline từ</label>\r\n");
      out.write("                                                    <input type=\"date\" class=\"form-control\" id=\"deadlineFrom\" name=\"deadlineFrom\" value=\"");
      out.print( deadlineFromParam != null ? deadlineFromParam : "" );
      out.write("\">\r\n");
      out.write("                                                </div>\r\n");
      out.write("                                                <div class=\"filter-group\">\r\n");
      out.write("                                                    <label for=\"deadlineTo\">Deadline đến</label>\r\n");
      out.write("                                                    <input type=\"date\" class=\"form-control\" id=\"deadlineTo\" name=\"deadlineTo\" value=\"");
      out.print( deadlineToParam != null ? deadlineToParam : "" );
      out.write("\">\r\n");
      out.write("                                                </div>\r\n");
      out.write("                                            </div>\r\n");
      out.write("                                            <div class=\"filter-row\">\r\n");
      out.write("                                                <div class=\"filter-group small\">\r\n");
      out.write("                                                    <label for=\"pageSize\">Hiển thị</label>\r\n");
      out.write("                                                    <select class=\"form-control\" id=\"pageSize\" name=\"size\" onchange=\"this.form.submit()\">\r\n");
      out.write("                                                        <option value=\"10\" ");
      out.print( pageSize == 10 ? "selected" : "" );
      out.write(">10</option>\r\n");
      out.write("                                                        <option value=\"25\" ");
      out.print( pageSize == 25 ? "selected" : "" );
      out.write(">25</option>\r\n");
      out.write("                                                        <option value=\"50\" ");
      out.print( pageSize == 50 ? "selected" : "" );
      out.write(">50</option>\r\n");
      out.write("                                                        <option value=\"100\" ");
      out.print( pageSize == 100 ? "selected" : "" );
      out.write(">100</option>\r\n");
      out.write("                                                    </select>\r\n");
      out.write("                                                </div>\r\n");
      out.write("                                                <div class=\"filter-actions\">\r\n");
      out.write("                                                    <button type=\"submit\" class=\"btn btn-primary\">\r\n");
      out.write("                                                        <i class=\"fa fa-filter\"></i> Lọc\r\n");
      out.write("                                                    </button>\r\n");
      out.write("                                                    <a href=\"technical_staff_management.jsp\" class=\"btn btn-default\">\r\n");
      out.write("                                                        <i class=\"fa fa-times\"></i> Xóa lọc\r\n");
      out.write("                                                    </a>\r\n");
      out.write("                                                </div>\r\n");
      out.write("                                            </div>\r\n");
      out.write("                                        </form>\r\n");
      out.write("                                    </div>\r\n");
      out.write("                                </div>\r\n");
      out.write("                                \r\n");
      out.write("                                <table class=\"table table-hover\" id=\"tasksTable\">\r\n");
      out.write("                                    <thead>\r\n");
      out.write("                                        <tr>\r\n");
      out.write("                                            <th>ID</th>\r\n");
      out.write("                                            <th>Nhân viên</th>\r\n");
      out.write("                                            <th>Email</th>\r\n");
      out.write("                                            <th>Mã Task</th>\r\n");
      out.write("                                            <th>Mô tả</th>\r\n");
      out.write("                                            <th>Work Order</th>\r\n");
      out.write("                                            <th>Độ ưu tiên</th>\r\n");
      out.write("                                            <th>Trạng thái</th>\r\n");
      out.write("                                            <th>Giờ ước tính</th>\r\n");
      out.write("                                            <th>Ngày giao</th>\r\n");
      out.write("                                            <th>Deadline</th>\r\n");
      out.write("                                            <th>Ngày hoàn thành</th>\r\n");
      out.write("                                        </tr>\r\n");
      out.write("                                    </thead>\r\n");
      out.write("                                    <tbody id=\"tasksTableBody\">\r\n");
      out.write("                                        ");

                                            if (tasks != null && !tasks.isEmpty()) {
                                                for (java.util.Map<String, Object> task : tasks) {
                                        
      out.write("\r\n");
      out.write("                                        <tr>\r\n");
      out.write("                                            <td>");
      out.print( task.get("id") );
      out.write("</td>\r\n");
      out.write("                                            <td>");
      out.print( task.get("staffName") != null ? task.get("staffName") : "-" );
      out.write("</td>\r\n");
      out.write("                                            <td>");
      out.print( task.get("staffEmail") != null ? task.get("staffEmail") : "-" );
      out.write("</td>\r\n");
      out.write("                                            <td><strong>");
      out.print( task.get("taskNumber") != null ? task.get("taskNumber") : "-" );
      out.write("</strong></td>\r\n");
      out.write("                                            <td>");
      out.print( task.get("taskDescription") != null ? task.get("taskDescription") : "-" );
      out.write("</td>\r\n");
      out.write("                                            <td>");
      out.print( task.get("workOrderNumber") != null ? task.get("workOrderNumber") : "-" );
      out.write("</td>\r\n");
      out.write("                                            <td>\r\n");
      out.write("                                                ");

                                                    String priority = (String) task.get("priority");
                                                    if (priority != null) {
                                                
      out.write("\r\n");
      out.write("                                                <span class=\"badge badge-");
      out.print( priority );
      out.write('"');
      out.write('>');
      out.print( getPriorityLabel(priority) );
      out.write("</span>\r\n");
      out.write("                                                ");

                                                    } else {
                                                
      out.write("\r\n");
      out.write("                                                <span class=\"badge\">N/A</span>\r\n");
      out.write("                                                ");

                                                    }
                                                
      out.write("\r\n");
      out.write("                                            </td>\r\n");
      out.write("                                            <td>\r\n");
      out.write("                                                ");

                                                    String status = (String) task.get("status");
                                                    if (status != null) {
                                                
      out.write("\r\n");
      out.write("                                                <span class=\"badge badge-");
      out.print( status );
      out.write('"');
      out.write('>');
      out.print( getStatusLabel(status) );
      out.write("</span>\r\n");
      out.write("                                                ");

                                                    } else {
                                                
      out.write("\r\n");
      out.write("                                                <span class=\"badge\">N/A</span>\r\n");
      out.write("                                                ");

                                                    }
                                                
      out.write("\r\n");
      out.write("                                            </td>\r\n");
      out.write("                                            <td class=\"text-center\">\r\n");
      out.write("                                                ");

                                                    java.math.BigDecimal estimatedHours = (java.math.BigDecimal) task.get("estimatedHours");
                                                    if (estimatedHours != null) {
                                                
      out.write("\r\n");
      out.write("                                                ");
      out.print( String.format("%.1f", estimatedHours) );
      out.write("h\r\n");
      out.write("                                                ");

                                                    } else {
                                                
      out.write("\r\n");
      out.write("                                                -\r\n");
      out.write("                                                ");

                                                    }
                                                
      out.write("\r\n");
      out.write("                                            </td>\r\n");
      out.write("                                            <td class=\"text-center\">");
      out.print( formatDate((java.sql.Timestamp) task.get("startDate")) );
      out.write("</td>\r\n");
      out.write("                                            <td class=\"text-center\">");
      out.print( formatDate((java.sql.Timestamp) task.get("deadline")) );
      out.write("</td>\r\n");
      out.write("                                            <td class=\"text-center\">\r\n");
      out.write("                                                ");

                                                    java.sql.Timestamp completionDate = (java.sql.Timestamp) task.get("completionDate");
                                                    String statusStr = (String) task.get("status");
                                                    if (completionDate != null) {
                                                        if ("completed".equals(statusStr)) {
                                                
      out.write("\r\n");
      out.write("                                                <span class=\"text-success\" style=\"font-weight: bold;\"><i class=\"fa fa-check-circle\"></i> ");
      out.print( formatDate(completionDate) );
      out.write("</span>\r\n");
      out.write("                                                ");

                                                        } else {
                                                
      out.write("\r\n");
      out.write("                                                ");
      out.print( formatDate(completionDate) );
      out.write("\r\n");
      out.write("                                                ");

                                                        }
                                                    } else {
                                                
      out.write("\r\n");
      out.write("                                                -\r\n");
      out.write("                                                ");

                                                    }
                                                
      out.write("\r\n");
      out.write("                                            </td>\r\n");
      out.write("                                        </tr>\r\n");
      out.write("                                        ");

                                                }
                                            } else {
                                        
      out.write("\r\n");
      out.write("                                        <tr>\r\n");
      out.write("                                            <td colspan=\"12\" class=\"text-center text-muted\">Không có dữ liệu</td>\r\n");
      out.write("                                        </tr>\r\n");
      out.write("                                        ");

                                            }
                                        
      out.write("\r\n");
      out.write("                                    </tbody>\r\n");
      out.write("                                </table>\r\n");
      out.write("\r\n");
      out.write("                                <div class=\"row\" style=\"margin-top: 10px;\">\r\n");
      out.write("                                    <div class=\"col-md-6\">\r\n");
      out.write("                                        <div id=\"tasksPaginationInfo\" class=\"text-muted\" style=\"line-height: 34px;\">\r\n");
      out.write("                                            ");

                                                int _startIdx = (currentPage - 1) * pageSize + 1;
                                                int _endIdx = Math.min(currentPage * pageSize, total);
                                                if (total == 0) { _startIdx = 0; _endIdx = 0; }
                                            
      out.write("\r\n");
      out.write("                                            Hiển thị ");
      out.print( _startIdx );
      out.write(' ');
      out.write('-');
      out.write(' ');
      out.print( _endIdx );
      out.write(" của ");
      out.print( total );
      out.write(" nhiệm vụ\r\n");
      out.write("                                        </div>\r\n");
      out.write("                                    </div>\r\n");
      out.write("                                    <div class=\"col-md-6\">\r\n");
      out.write("                                        <nav aria-label=\"Phân trang nhiệm vụ\" class=\"pull-right\">\r\n");
      out.write("                                            <ul class=\"pagination pagination-sm\" style=\"margin: 0;\">\r\n");
      out.write("                                                ");

                                                    // Xây base query giữ nguyên filter
                                                    java.util.List<String> _p = new java.util.ArrayList<String>();
                                                    try { String v = request.getParameter("status"); if (v != null && !v.isEmpty()) _p.add("status=" + java.net.URLEncoder.encode(v, "UTF-8")); } catch (Exception ignored) {}
                                                    try { String v = request.getParameter("priority"); if (v != null && !v.isEmpty()) _p.add("priority=" + java.net.URLEncoder.encode(v, "UTF-8")); } catch (Exception ignored) {}
                                                    try { String v = request.getParameter("q"); if (v != null && !v.isEmpty()) _p.add("q=" + java.net.URLEncoder.encode(v, "UTF-8")); } catch (Exception ignored) {}
                                                    try { String v = request.getParameter("startDateFrom"); if (v != null && !v.isEmpty()) _p.add("startDateFrom=" + java.net.URLEncoder.encode(v, "UTF-8")); } catch (Exception ignored) {}
                                                    try { String v = request.getParameter("startDateTo"); if (v != null && !v.isEmpty()) _p.add("startDateTo=" + java.net.URLEncoder.encode(v, "UTF-8")); } catch (Exception ignored) {}
                                                    try { String v = request.getParameter("deadlineFrom"); if (v != null && !v.isEmpty()) _p.add("deadlineFrom=" + java.net.URLEncoder.encode(v, "UTF-8")); } catch (Exception ignored) {}
                                                    try { String v = request.getParameter("deadlineTo"); if (v != null && !v.isEmpty()) _p.add("deadlineTo=" + java.net.URLEncoder.encode(v, "UTF-8")); } catch (Exception ignored) {}
                                                    _p.add("size=" + pageSize);
                                                    String _base = "technical_staff_management.jsp" + (_p.isEmpty() ? "" : ("?" + String.join("&", _p)));
                                                    // Nút prev
                                                    int _prev = Math.max(1, currentPage - 1);
                                                
      out.write("\r\n");
      out.write("                                                <li class=\"");
      out.print( currentPage == 1 ? "disabled" : "" );
      out.write("\"><a href=\"");
      out.print( _base + "&page=" + _prev );
      out.write("\">&laquo;</a></li>\r\n");
      out.write("                                                ");

                                                    int _s = Math.max(1, currentPage - 2);
                                                    int _e = Math.min(totalPages, currentPage + 2);
                                                    if (_s > 1) {
                                                
      out.write("\r\n");
      out.write("                                                <li><a href=\"");
      out.print( _base + "&page=1" );
      out.write("\">1</a></li>\r\n");
      out.write("                                                ");
      out.print( (_s > 2) ? "<li class=\"disabled\"><span>...</span></li>" : "" );
      out.write("\r\n");
      out.write("                                                ");

                                                    }
                                                    for (int i = _s; i <= _e; i++) {
                                                
      out.write("\r\n");
      out.write("                                                <li class=\"");
      out.print( i == currentPage ? "active" : "" );
      out.write("\"><a href=\"");
      out.print( _base + "&page=" + i );
      out.write('"');
      out.write('>');
      out.print( i );
      out.write("</a></li>\r\n");
      out.write("                                                ");

                                                    }
                                                    if (_e < totalPages) {
                                                
      out.write("\r\n");
      out.write("                                                ");
      out.print( (_e < totalPages - 1) ? "<li class=\"disabled\"><span>...</span></li>" : "" );
      out.write("\r\n");
      out.write("                                                <li><a href=\"");
      out.print( _base + "&page=" + totalPages );
      out.write('"');
      out.write('>');
      out.print( totalPages );
      out.write("</a></li>\r\n");
      out.write("                                                ");

                                                    }
                                                    int _next = Math.min(totalPages, currentPage + 1);
                                                
      out.write("\r\n");
      out.write("                                                <li class=\"");
      out.print( currentPage == totalPages ? "disabled" : "" );
      out.write("\"><a href=\"");
      out.print( _base + "&page=" + _next );
      out.write("\">&raquo;</a></li>\r\n");
      out.write("                                            </ul>\r\n");
      out.write("                                        </nav>\r\n");
      out.write("                                    </div>\r\n");
      out.write("                                </div>\r\n");
      out.write("                            </div>\r\n");
      out.write("                        </div>\r\n");
      out.write("                    </div>\r\n");
      out.write("                </div>\r\n");
      out.write("            </section>\r\n");
      out.write("        </aside>\r\n");
      out.write("    </div>\r\n");
      out.write("\r\n");
      out.write("    <!-- jQuery -->\r\n");
      out.write("    <script src=\"js/jquery.min.js\"></script>\r\n");
      out.write("    <!-- Bootstrap -->\r\n");
      out.write("    <script src=\"js/bootstrap.min.js\"></script>\r\n");
      out.write("    <!-- DataTables -->\r\n");
      out.write("    <script src=\"js/plugins/datatables/jquery.dataTables.js\" type=\"text/javascript\"></script>\r\n");
      out.write("    <script src=\"js/plugins/datatables/dataTables.bootstrap.js\" type=\"text/javascript\"></script>\r\n");
      out.write("    <!-- AdminLTE App -->\r\n");
      out.write("    <script src=\"js/AdminLTE/app.js\"></script>\r\n");
      out.write("\r\n");
      out.write("    <script>\r\n");
      out.write("        var tasksTable;\r\n");
      out.write("        \r\n");
      out.write("        // Toggle filter visibility\r\n");
      out.write("        function toggleFilters() {\r\n");
      out.write("            var content = document.getElementById('filterContent');\r\n");
      out.write("            var icon = document.getElementById('filterToggleIcon');\r\n");
      out.write("            if (content.classList.contains('show')) {\r\n");
      out.write("                content.classList.remove('show');\r\n");
      out.write("                icon.classList.remove('rotated');\r\n");
      out.write("            } else {\r\n");
      out.write("                content.classList.add('show');\r\n");
      out.write("                icon.classList.add('rotated');\r\n");
      out.write("            }\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        // Load filter state from localStorage\r\n");
      out.write("        function loadFilterState() {\r\n");
      out.write("            try {\r\n");
      out.write("                return localStorage.getItem('techStaffFilterExpanded') === 'true';\r\n");
      out.write("            } catch (e) {\r\n");
      out.write("                return false;\r\n");
      out.write("            }\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        // Save filter state to localStorage\r\n");
      out.write("        function saveFilterState(expanded) {\r\n");
      out.write("            try {\r\n");
      out.write("                localStorage.setItem('techStaffFilterExpanded', expanded ? 'true' : 'false');\r\n");
      out.write("            } catch (e) {\r\n");
      out.write("                // Ignore\r\n");
      out.write("            }\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        // Khi trang load lại: giữ trạng thái cũ\r\n");
      out.write("        document.addEventListener('DOMContentLoaded', function() {\r\n");
      out.write("            var content = document.getElementById('filterContent');\r\n");
      out.write("            var icon = document.getElementById('filterToggleIcon');\r\n");
      out.write("            if (loadFilterState()) {\r\n");
      out.write("                content.classList.add('show');\r\n");
      out.write("                icon.classList.add('rotated');\r\n");
      out.write("            } else {\r\n");
      out.write("                content.classList.remove('show');\r\n");
      out.write("                icon.classList.remove('rotated');\r\n");
      out.write("            }\r\n");
      out.write("        });\r\n");
      out.write("        \r\n");
      out.write("        // Update filter state when toggled\r\n");
      out.write("        var originalToggleFilters = toggleFilters;\r\n");
      out.write("        toggleFilters = function() {\r\n");
      out.write("            originalToggleFilters();\r\n");
      out.write("            var content = document.getElementById('filterContent');\r\n");
      out.write("            saveFilterState(content.classList.contains('show'));\r\n");
      out.write("        };\r\n");
      out.write("\r\n");
      out.write("        $(document).ready(function() {\r\n");
      out.write("            // Kiểm tra và hủy DataTable cũ nếu đã tồn tại\r\n");
      out.write("            if ($.fn.DataTable.isDataTable('#tasksTable')) {\r\n");
      out.write("                $('#tasksTable').DataTable().destroy();\r\n");
      out.write("            }\r\n");
      out.write("            \r\n");
      out.write("            tasksTable = $('#tasksTable').DataTable({\r\n");
      out.write("                \"language\": { \"url\": \"//cdn.datatables.net/plug-ins/1.10.25/i18n/Vietnamese.json\" },\r\n");
      out.write("                \"processing\": false,\r\n");
      out.write("                \"serverSide\": false,\r\n");
      out.write("                \"paging\": false,\r\n");
      out.write("                \"searching\": false,\r\n");
      out.write("                \"dom\": 'lrt',\r\n");
      out.write("                \"ordering\": true,\r\n");
      out.write("                \"info\": false,\r\n");
      out.write("                \"autoWidth\": false,\r\n");
      out.write("                \"responsive\": true,\r\n");
      out.write("                \"order\": [[0, \"desc\"]],\r\n");
      out.write("                \"retrieve\": true\r\n");
      out.write("            });\r\n");
      out.write("            // Safety: remove filter container if any existed from previous inits\r\n");
      out.write("            $('#tasksTable_filter').remove();\r\n");
      out.write("        });\r\n");
      out.write("    </script>\r\n");
      out.write("</body>\r\n");
      out.write("</html>\r\n");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
