/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.47
 * Generated at: 2025-10-21 02:47:26 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;

public final class support_005fmanagement_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write('\n');

    // Kiểm tra đăng nhập
    String username = (String) session.getAttribute("username");
    Boolean isLoggedIn = (Boolean) session.getAttribute("isLoggedIn");
    String userRole = (String) session.getAttribute("userRole");
    
    if (username == null || isLoggedIn == null || !isLoggedIn) {
        response.sendRedirect(request.getContextPath() + "/login.jsp");
        return;
    }
    
    // Kiểm tra quyền customer_support hoặc admin
    if (!"customer_support".equals(userRole) && !"admin".equals(userRole)) {
        response.sendRedirect(request.getContextPath() + "/index.jsp");
        return;
    }

      out.write("\n");
      out.write("<!DOCTYPE html>\n");
      out.write("<html>\n");
      out.write("<head>\n");
      out.write("    <meta charset=\"UTF-8\">\n");
      out.write("    <title>Quản Lý Yêu Cầu Hỗ Trợ | Bảng Điều Khiển</title>\n");
      out.write("    <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>\n");
      out.write("    \n");
      out.write("    <!-- bootstrap 3.0.2 -->\n");
      out.write("    <link href=\"css/bootstrap.min.css\" rel=\"stylesheet\" type=\"text/css\" />\n");
      out.write("    <!-- font Awesome -->\n");
      out.write("    <link href=\"css/font-awesome.min.css\" rel=\"stylesheet\" type=\"text/css\" />\n");
      out.write("    <!-- Ionicons -->\n");
      out.write("    <link href=\"css/ionicons.min.css\" rel=\"stylesheet\" type=\"text/css\" />\n");
      out.write("    <!-- DataTables -->\n");
      out.write("    <link href=\"css/datatables/dataTables.bootstrap.css\" rel=\"stylesheet\" type=\"text/css\" />\n");
      out.write("    <!-- Theme style -->\n");
      out.write("    <link href=\"css/style.css\" rel=\"stylesheet\" type=\"text/css\" />\n");
      out.write("\n");
      out.write("    <style>\n");
      out.write("         .filter-section {\n");
      out.write("             background: #f9f9f9;\n");
      out.write("            padding: 15px;\n");
      out.write("             margin-bottom: 20px;\n");
      out.write("            border-radius: 5px;\n");
      out.write("         }\n");
      out.write("         .ticket-priority-urgent { border-left: 4px solid #d9534f; }\n");
      out.write("         .ticket-priority-high { border-left: 4px solid #f0ad4e; }\n");
      out.write("         .ticket-priority-medium { border-left: 4px solid #5bc0de; }\n");
      out.write("         .ticket-priority-low { border-left: 4px solid #5cb85c; }\n");
      out.write("         \n");
      out.write("         /* Tối ưu cho tiếng Việt */\n");
      out.write("         #detailDescription {\n");
      out.write("             font-family: 'Segoe UI', Tahoma, Arial, sans-serif;\n");
      out.write("             line-height: 1.5;\n");
      out.write("             direction: ltr;\n");
      out.write("             unicode-bidi: embed;\n");
      out.write("         }\n");
      out.write("         \n");
      out.write("         /* Placeholder styling cho tiếng Việt */\n");
      out.write("         #detailDescription::placeholder {\n");
      out.write("             color: #999;\n");
      out.write("             font-style: italic;\n");
      out.write("         }\n");
      out.write("         \n");
      out.write("         /* Styling cho các trường bị khóa */\n");
      out.write("         input[readonly], textarea[readonly], select[disabled] {\n");
      out.write("             background-color: #f5f5f5;\n");
      out.write("             color: #666;\n");
      out.write("             cursor: not-allowed;\n");
      out.write("         }\n");
      out.write("         \n");
      out.write("         /* Styling cho các trường được phép chỉnh sửa */\n");
      out.write("         input:not([readonly]), textarea:not([readonly]), select:not([disabled]) {\n");
      out.write("             background-color: #fff;\n");
      out.write("             border-color: #5bc0de;\n");
      out.write("         }\n");
      out.write("         \n");
      out.write("         /* Label styling để phân biệt */\n");
      out.write("         .form-group label {\n");
      out.write("             font-weight: bold;\n");
      out.write("         }\n");
      out.write("         \n");
      out.write("         .form-group label:after {\n");
      out.write("             content: \" *\";\n");
      out.write("             color: #5bc0de;\n");
      out.write("             font-weight: normal;\n");
      out.write("         }\n");
      out.write("         \n");
      out.write("         /* Loại bỏ dấu * cho các trường readonly */\n");
      out.write("         input[readonly] + label:after,\n");
      out.write("         textarea[readonly] + label:after,\n");
      out.write("         select[disabled] + label:after {\n");
      out.write("             display: none;\n");
      out.write("         }\n");
      out.write("         \n");
      out.write("         /* Styling cho button chuyển tiếp */\n");
      out.write("         .btn-success.btn-xs {\n");
      out.write("             background-color: #5cb85c;\n");
      out.write("             border-color: #4cae4c;\n");
      out.write("         }\n");
      out.write("         \n");
      out.write("         .btn-success.btn-xs:hover {\n");
      out.write("             background-color: #449d44;\n");
      out.write("             border-color: #398439;\n");
      out.write("         }\n");
      out.write("         \n");
      out.write("         /* Modal chuyển tiếp */\n");
      out.write("         #forwardModal .modal-header {\n");
      out.write("             background-color: #5cb85c;\n");
      out.write("             color: white;\n");
      out.write("         }\n");
      out.write("         \n");
      out.write("         #forwardModal .modal-header .close {\n");
      out.write("             color: white;\n");
      out.write("             opacity: 0.8;\n");
      out.write("         }\n");
      out.write("         \n");
      out.write("         #forwardModal .modal-header .close:hover {\n");
      out.write("             opacity: 1;\n");
      out.write("        }\n");
      out.write("    </style>\n");
      out.write("</head>\n");
      out.write("<body class=\"skin-black\">\n");
      out.write("    <!-- header logo: style can be found in header.less -->\n");
      out.write("    <header class=\"header\">\n");
      out.write("        <a href=\"support_management.jsp\" class=\"logo\">\n");
      out.write("            Quản Lý Yêu Cầu Hỗ Trợ\n");
      out.write("        </a>\n");
      out.write("        <!-- Header Navbar: style can be found in header.less -->\n");
      out.write("        <nav class=\"navbar navbar-static-top\" role=\"navigation\">\n");
      out.write("            <!-- Sidebar toggle button-->\n");
      out.write("            <a href=\"#\" class=\"navbar-btn sidebar-toggle\" data-toggle=\"offcanvas\" role=\"button\">\n");
      out.write("                <span class=\"sr-only\">Toggle navigation</span>\n");
      out.write("                <span class=\"icon-bar\"></span>\n");
      out.write("                <span class=\"icon-bar\"></span>\n");
      out.write("                <span class=\"icon-bar\"></span>\n");
      out.write("            </a>\n");
      out.write("            <div class=\"navbar-right\">\n");
      out.write("                <ul class=\"nav navbar-nav\">\n");
      out.write("                    <!-- User Account: style can be found in dropdown.less -->\n");
      out.write("                    <li class=\"dropdown user user-menu\">\n");
      out.write("                        <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">\n");
      out.write("                            <i class=\"fa fa-user\"></i>\n");
      out.write("                            <span>");
      out.print( username );
      out.write(" <i class=\"caret\"></i></span>\n");
      out.write("                        </a>\n");
      out.write("                        <ul class=\"dropdown-menu dropdown-custom dropdown-menu-right\">\n");
      out.write("                            <li class=\"dropdown-header text-center\">Tài khoản</li>\n");
      out.write("                            <li>\n");
      out.write("                                <a href=\"profile.jsp\">\n");
      out.write("                                <i class=\"fa fa-user fa-fw pull-right\"></i>\n");
      out.write("                                    Hồ sơ\n");
      out.write("                                </a>\n");
      out.write("                                <a href=\"settings.jsp\">\n");
      out.write("                                <i class=\"fa fa-cog fa-fw pull-right\"></i>\n");
      out.write("                                    Cài đặt cá nhân\n");
      out.write("                                </a>\n");
      out.write("                            </li>\n");
      out.write("                            <li class=\"divider\"></li>\n");
      out.write("                            <li>\n");
      out.write("                                <a href=\"logout\"><i class=\"fa fa-ban fa-fw pull-right\"></i> Đăng xuất</a>\n");
      out.write("                            </li>\n");
      out.write("                        </ul>\n");
      out.write("                    </li>\n");
      out.write("                </ul>\n");
      out.write("            </div>\n");
      out.write("        </nav>\n");
      out.write("    </header>\n");
      out.write("    \n");
      out.write("    <div class=\"wrapper row-offcanvas row-offcanvas-left\">\n");
      out.write("        <!-- Left side column. contains the logo and sidebar -->\n");
      out.write("        <aside class=\"left-side sidebar-offcanvas\">\n");
      out.write("            <!-- sidebar: style can be found in sidebar.less -->\n");
      out.write("            <section class=\"sidebar\">\n");
      out.write("                <!-- Sidebar user panel -->\n");
      out.write("                <div class=\"user-panel\">\n");
      out.write("                    <div class=\"pull-left image\">\n");
      out.write("                        <img src=\"img/26115.jpg\" class=\"img-circle\" alt=\"User Image\" />\n");
      out.write("                    </div>\n");
      out.write("                    <div class=\"pull-left info\">\n");
      out.write("                        <p>Xin chào, ");
      out.print( username );
      out.write("</p>\n");
      out.write("                        <a href=\"#\"><i class=\"fa fa-circle text-success\"></i> Online</a>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("                <!-- sidebar menu: : style can be found in sidebar.less -->\n");
      out.write("                <ul class=\"sidebar-menu\">\n");
      out.write("                    <li>\n");
      out.write("                        <a href=\"customersupport.jsp\">\n");
      out.write("                            <i class=\"fa fa-dashboard\"></i> <span>Bảng điều khiển</span>\n");
      out.write("                        </a>\n");
      out.write("                    </li>\n");
      out.write("                    <li class=\"active\">\n");
      out.write("                        <a href=\"support_management.jsp\">\n");
      out.write("                            <i class=\"fa fa-life-ring\"></i> <span>Quản lý yêu cầu hỗ trợ</span>\n");
      out.write("                        </a>\n");
      out.write("                    </li>\n");
      out.write("                    <li>\n");
      out.write("                        <a href=\"contracts.jsp\">\n");
      out.write("                            <i class=\"fa fa-file-text\"></i> <span>Quản lý hợp đồng</span>\n");
      out.write("                        </a>\n");
      out.write("                    </li>\n");
      out.write("                </ul>\n");
      out.write("            </section>\n");
      out.write("            <!-- /.sidebar -->\n");
      out.write("        </aside>\n");
      out.write("\n");
      out.write("        <aside class=\"right-side\">\n");
      out.write("            <!-- Main content -->\n");
      out.write("            <section class=\"content\">\n");
      out.write("                <!-- Filter Section -->\n");
      out.write("                <div class=\"filter-section\">\n");
      out.write("                <div class=\"row\">\n");
      out.write("                        <div class=\"col-md-3\">\n");
      out.write("                            <label>Trạng thái:</label>\n");
      out.write("                            <select id=\"statusFilter\" class=\"form-control\">\n");
      out.write("                                            <option value=\"\">Tất cả</option>\n");
      out.write("                                <option value=\"open\">Đang chờ</option>\n");
      out.write("                                            <option value=\"in_progress\">Đang xử lý</option>\n");
      out.write("                                <option value=\"resolved\">Hoàn thành</option>\n");
      out.write("                                            <option value=\"closed\">Đã đóng</option>\n");
      out.write("                                        </select>\n");
      out.write("                                    </div>\n");
      out.write("                        <div class=\"col-md-3\">\n");
      out.write("                            <label>Độ ưu tiên:</label>\n");
      out.write("                            <select id=\"priorityFilter\" class=\"form-control\">\n");
      out.write("                                            <option value=\"\">Tất cả</option>\n");
      out.write("                                            <option value=\"urgent\">Khẩn cấp</option>\n");
      out.write("                                            <option value=\"high\">Cao</option>\n");
      out.write("                                            <option value=\"medium\">Trung bình</option>\n");
      out.write("                                            <option value=\"low\">Thấp</option>\n");
      out.write("                                        </select>\n");
      out.write("                                    </div>\n");
      out.write("                        <div class=\"col-md-3\">\n");
      out.write("                            <label>Danh mục:</label>\n");
      out.write("                            <select id=\"categoryFilter\" class=\"form-control\">\n");
      out.write("                                <option value=\"\">Tất cả</option>\n");
      out.write("                                <option value=\"technical\">Kỹ thuật</option>\n");
      out.write("                                <option value=\"billing\">Thanh toán</option>\n");
      out.write("                                <option value=\"general\">Chung</option>\n");
      out.write("                                <option value=\"complaint\">Khiếu nại</option>\n");
      out.write("                            </select>\n");
      out.write("                                    </div>\n");
      out.write("                        <div class=\"col-md-3\">\n");
      out.write("                            <label>&nbsp;</label><br>\n");
      out.write("                            <button type=\"button\" class=\"btn btn-primary\" onclick=\"applyFilters()\">\n");
      out.write("                                        <i class=\"fa fa-filter\"></i> Lọc\n");
      out.write("                                    </button>\n");
      out.write("                             <button type=\"button\" class=\"btn btn-default\" onclick=\"clearFilters()\">\n");
      out.write("                                 <i class=\"fa fa-refresh\"></i> Xóa bộ lọc\n");
      out.write("                                     </button>\n");
      out.write("                             <button type=\"button\" class=\"btn btn-info\" onclick=\"window.location.href='tech_support_management.jsp'\">\n");
      out.write("                                 <i class=\"fa fa-wrench\"></i> Xem ticket kỹ thuật\n");
      out.write("                                     </button>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("\n");
      out.write("                <!-- Tickets Table -->\n");
      out.write("                <div class=\"row\">\n");
      out.write("                    <div class=\"col-md-12\">\n");
      out.write("                        <section class=\"panel\">\n");
      out.write("                            <header class=\"panel-heading\">\n");
      out.write("                                <h3>Danh sách yêu cầu hỗ trợ</h3>\n");
      out.write("                            </header>\n");
      out.write("                            <div class=\"panel-body\">\n");
      out.write("                                <div class=\"table-responsive\">\n");
      out.write("                                    <table id=\"ticketsTable\" class=\"table table-striped table-bordered table-hover\">\n");
      out.write("                                    <thead>\n");
      out.write("                                        <tr>\n");
      out.write("                                                <th>ID</th>\n");
      out.write("                                                <th>Mã Ticket</th>\n");
      out.write("                                            <th>Khách hàng</th>\n");
      out.write("                                            <th>Tiêu đề</th>\n");
      out.write("                                                <th>Danh mục</th>\n");
      out.write("                                                <th>Độ ưu tiên</th>\n");
      out.write("                                                <th>Trạng thái</th>\n");
      out.write("                                                <th>Ngày tạo</th>\n");
      out.write("                                                <th>Thao tác</th>\n");
      out.write("                                        </tr>\n");
      out.write("                                    </thead>\n");
      out.write("                                    <tbody id=\"ticketsTableBody\">\n");
      out.write("                                        <tr>\n");
      out.write("                                                <td colspan=\"9\" class=\"text-center\">\n");
      out.write("                                                    <i class=\"fa fa-spinner fa-spin\"></i> Đang tải dữ liệu...\n");
      out.write("                                                </td>\n");
      out.write("                                        </tr>\n");
      out.write("                                    </tbody>\n");
      out.write("                                </table>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("            </section>\n");
      out.write("                            </div>\n");
      out.write("                        </div>\n");
      out.write("            </section><!-- /.content -->\n");
      out.write("        </aside><!-- /.right-side -->\n");
      out.write("    </div><!-- ./wrapper -->\n");
      out.write("\n");
      out.write("    <!-- jQuery 2.0.2 -->\n");
      out.write("    <script src=\"http://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js\"></script>\n");
      out.write("    <script src=\"js/jquery.min.js\" type=\"text/javascript\"></script>\n");
      out.write("    <!-- jQuery UI 1.10.3 -->\n");
      out.write("    <script src=\"js/jquery-ui-1.10.3.min.js\" type=\"text/javascript\"></script>\n");
      out.write("    <!-- Bootstrap -->\n");
      out.write("    <script src=\"js/bootstrap.min.js\" type=\"text/javascript\"></script>\n");
      out.write("    <!-- DataTables -->\n");
      out.write("    <script src=\"js/plugins/datatables/jquery.dataTables.js\" type=\"text/javascript\"></script>\n");
      out.write("    <script src=\"js/plugins/datatables/dataTables.bootstrap.js\" type=\"text/javascript\"></script>\n");
      out.write("    <!-- Director App -->\n");
      out.write("    <script src=\"js/Director/app.js\" type=\"text/javascript\"></script>\n");
      out.write("\n");
      out.write("    <script>\n");
      out.write("        var ticketsData = [];\n");
      out.write("        var dataTable;\n");
      out.write("        \n");
      out.write("        $(document).ready(function() {\n");
      out.write("            loadTickets();\n");
      out.write("        });\n");
      out.write("        \n");
      out.write("        function loadTickets() {\n");
      out.write("            $.ajax({\n");
      out.write("                url: 'api/support-stats?action=list',\n");
      out.write("                type: 'GET',\n");
      out.write("                dataType: 'json',\n");
      out.write("                success: function(response) {\n");
      out.write("                    if (response.success) {\n");
      out.write("                        ticketsData = response.data;\n");
      out.write("                        renderTicketsTable();\n");
      out.write("                        console.log('Đã tải ' + ticketsData.length + ' ticket');\n");
      out.write("                    } else {\n");
      out.write("                        console.error('Lỗi tải danh sách ticket:', response.message);\n");
      out.write("                        showError('Không thể tải danh sách yêu cầu hỗ trợ');\n");
      out.write("                    }\n");
      out.write("                },\n");
      out.write("                error: function(xhr, status, error) {\n");
      out.write("                    console.error('Không thể tải danh sách ticket:', error);\n");
      out.write("                    showError('Lỗi kết nối server');\n");
      out.write("                }\n");
      out.write("            });\n");
      out.write("        }\n");
      out.write("\n");
      out.write("        function renderTicketsTable() {\n");
      out.write("            var tbody = $('#ticketsTableBody');\n");
      out.write("            tbody.empty();\n");
      out.write("            \n");
      out.write("            if (ticketsData.length === 0) {\n");
      out.write("                tbody.append('<tr><td colspan=\"9\" class=\"text-center\">Chưa có yêu cầu hỗ trợ nào</td></tr>');\n");
      out.write("                return;\n");
      out.write("            }\n");
      out.write("            \n");
      out.write("            ticketsData.forEach(function(ticket) {\n");
      out.write("                var row = createTicketRow(ticket);\n");
      out.write("                tbody.append(row);\n");
      out.write("            });\n");
      out.write("            \n");
      out.write("            // Initialize DataTable if not already initialized\n");
      out.write("            if (!dataTable) {\n");
      out.write("                dataTable = $('#ticketsTable').DataTable({\n");
      out.write("                    \"language\": {\n");
      out.write("                        \"url\": \"//cdn.datatables.net/plug-ins/1.10.24/i18n/Vietnamese.json\"\n");
      out.write("                    },\n");
      out.write("                    \"pageLength\": 25,\n");
      out.write("                    \"order\": [[7, \"desc\"]] // Sort by created date desc\n");
      out.write("                });\n");
      out.write("            }\n");
      out.write("        }\n");
      out.write("\n");
      out.write("        function createTicketRow(ticket) {\n");
      out.write("            var categoryLabel = getCategoryLabel(ticket.category);\n");
      out.write("            var priorityLabel = getPriorityLabel(ticket.priority);\n");
      out.write("            var statusLabel = getStatusLabel(ticket.status);\n");
      out.write("            var createdDate = formatDate(ticket.createdAt);\n");
      out.write("            var priorityClass = 'ticket-priority-' + ticket.priority;\n");
      out.write("\n");
      out.write("            return '<tr class=\"' + priorityClass + '\">' +\n");
      out.write("                '<td>' + ticket.id + '</td>' +\n");
      out.write("                '<td><strong>#' + ticket.ticketNumber + '</strong></td>' +\n");
      out.write("                '<td>' + (ticket.customerName || 'N/A') + '</td>' +\n");
      out.write("                '<td>' + ticket.subject + '</td>' +\n");
      out.write("                '<td>' + categoryLabel + '</td>' +\n");
      out.write("                '<td>' + priorityLabel + '</td>' +\n");
      out.write("                '<td>' + statusLabel + '</td>' +\n");
      out.write("                '<td>' + createdDate + '</td>' +\n");
      out.write("                 '<td>' +\n");
      out.write("                     '<button class=\"btn btn-info btn-xs\" onclick=\"viewTicket(' + ticket.id + ')\" title=\"Xem chi tiết\">' +\n");
      out.write("                         '<i class=\"fa fa-eye\"></i> Xem' +\n");
      out.write("                     '</button> ' +\n");
      out.write("                     '<button class=\"btn btn-warning btn-xs\" onclick=\"editTicket(' + ticket.id + ')\" title=\"Chỉnh sửa\">' +\n");
      out.write("                         '<i class=\"fa fa-edit\"></i> Sửa' +\n");
      out.write("                     '</button> ' +\n");
      out.write("                     '<button class=\"btn btn-success btn-xs\" onclick=\"forwardTicket(' + ticket.id + ')\" title=\"Chuyển tiếp\">' +\n");
      out.write("                         '<i class=\"fa fa-forward\"></i> Chuyển tiếp' +\n");
      out.write("                     '</button> ' +\n");
      out.write("                     '<button class=\"btn btn-danger btn-xs\" onclick=\"deleteTicket(' + ticket.id + ')\" title=\"Xóa\">' +\n");
      out.write("                         '<i class=\"fa fa-trash\"></i> Xóa' +\n");
      out.write("                     '</button>' +\n");
      out.write("                 '</td>' +\n");
      out.write("            '</tr>';\n");
      out.write("        }\n");
      out.write("\n");
      out.write("        function getCategoryLabel(category) {\n");
      out.write("            var labels = {\n");
      out.write("                'technical': '<span class=\"label label-info\">Kỹ thuật</span>',\n");
      out.write("                'billing': '<span class=\"label label-success\">Thanh toán</span>',\n");
      out.write("                'general': '<span class=\"label label-default\">Chung</span>',\n");
      out.write("                'complaint': '<span class=\"label label-danger\">Khiếu nại</span>'\n");
      out.write("            };\n");
      out.write("            return labels[category] || '<span class=\"label label-default\">' + category + '</span>';\n");
      out.write("        }\n");
      out.write("\n");
      out.write("        function getPriorityLabel(priority) {\n");
      out.write("            var labels = {\n");
      out.write("                'low': '<span class=\"label label-info\">Thấp</span>',\n");
      out.write("                'medium': '<span class=\"label label-warning\">Trung bình</span>',\n");
      out.write("                'high': '<span class=\"label label-danger\">Cao</span>',\n");
      out.write("                'urgent': '<span class=\"label label-danger\">Khẩn cấp</span>'\n");
      out.write("            };\n");
      out.write("            return labels[priority] || '<span class=\"label label-default\">' + priority + '</span>';\n");
      out.write("        }\n");
      out.write("\n");
      out.write("        function getStatusLabel(status) {\n");
      out.write("            var labels = {\n");
      out.write("                'open': '<span class=\"label label-primary\">Đang chờ</span>',\n");
      out.write("                'in_progress': '<span class=\"label label-warning\">Đang xử lý</span>',\n");
      out.write("                'resolved': '<span class=\"label label-success\">Hoàn thành</span>',\n");
      out.write("                'closed': '<span class=\"label label-default\">Đã đóng</span>'\n");
      out.write("            };\n");
      out.write("            return labels[status] || '<span class=\"label label-default\">' + status + '</span>';\n");
      out.write("        }\n");
      out.write("\n");
      out.write("        function formatDate(dateString) {\n");
      out.write("            if (!dateString) return 'N/A';\n");
      out.write("            var date = new Date(dateString);\n");
      out.write("            return date.toLocaleDateString('vi-VN') + ' ' + date.toLocaleTimeString('vi-VN', {hour: '2-digit', minute: '2-digit'});\n");
      out.write("        }\n");
      out.write("\n");
      out.write("        function applyFilters() {\n");
      out.write("            var status = $('#statusFilter').val();\n");
      out.write("            var priority = $('#priorityFilter').val();\n");
      out.write("            var category = $('#categoryFilter').val();\n");
      out.write("\n");
      out.write("            var filteredData = ticketsData.filter(function(ticket) {\n");
      out.write("                return (!status || ticket.status === status) &&\n");
      out.write("                       (!priority || ticket.priority === priority) &&\n");
      out.write("                       (!category || ticket.category === category);\n");
      out.write("            });\n");
      out.write("\n");
      out.write("            // Re-render table with filtered data\n");
      out.write("            var originalData = ticketsData;\n");
      out.write("            ticketsData = filteredData;\n");
      out.write("            renderTicketsTable();\n");
      out.write("            ticketsData = originalData; // Restore original data\n");
      out.write("        }\n");
      out.write("\n");
      out.write("        function clearFilters() {\n");
      out.write("            $('#statusFilter').val('');\n");
      out.write("            $('#priorityFilter').val('');\n");
      out.write("            $('#categoryFilter').val('');\n");
      out.write("            renderTicketsTable();\n");
      out.write("        }\n");
      out.write("\n");
      out.write("        function viewTicket(ticketId) {\n");
      out.write("            // Tìm ticket trong danh sách\n");
      out.write("            var ticket = ticketsData.find(function(t) { return t.id == ticketId; });\n");
      out.write("            if (!ticket) {\n");
      out.write("                alert('Không tìm thấy ticket');\n");
      out.write("                return;\n");
      out.write("            }\n");
      out.write("            \n");
      out.write("            // Hiển thị modal chi tiết\n");
      out.write("            showTicketDetailModal(ticket);\n");
      out.write("        }\n");
      out.write("\n");
      out.write("        function editTicket(ticketId) {\n");
      out.write("            // Tìm ticket trong danh sách\n");
      out.write("            var ticket = ticketsData.find(function(t) { return t.id == ticketId; });\n");
      out.write("            if (!ticket) {\n");
      out.write("                alert('Không tìm thấy ticket');\n");
      out.write("                return;\n");
      out.write("            }\n");
      out.write("            \n");
      out.write("            // Hiển thị modal chỉnh sửa\n");
      out.write("            showTicketDetailModal(ticket, true);\n");
      out.write("        }\n");
      out.write("\n");
      out.write("        function showTicketDetailModal(ticket, isEditMode) {\n");
      out.write("            // Tạo modal HTML bằng cách nối chuỗi thay vì template literal\n");
      out.write("            var modalHtml = '<div class=\"modal fade\" id=\"ticketDetailModal\" tabindex=\"-1\" role=\"dialog\">' +\n");
      out.write("                '<div class=\"modal-dialog modal-lg\" role=\"document\">' +\n");
      out.write("                    '<div class=\"modal-content\">' +\n");
      out.write("                        '<div class=\"modal-header\">' +\n");
      out.write("                            '<h4 class=\"modal-title\">Chi tiết yêu cầu hỗ trợ</h4>' +\n");
      out.write("                            '<button type=\"button\" class=\"close\" data-dismiss=\"modal\">&times;</button>' +\n");
      out.write("                        '</div>' +\n");
      out.write("                        '<div class=\"modal-body\">' +\n");
      out.write("                            '<form id=\"ticketDetailForm\">' +\n");
      out.write("                                '<div class=\"row\">' +\n");
      out.write("                                    '<div class=\"col-md-6\">' +\n");
      out.write("                                        '<div class=\"form-group\">' +\n");
      out.write("                                            '<label>Mã Ticket:</label>' +\n");
      out.write("                                            '<input type=\"text\" class=\"form-control\" value=\"' + (ticket.ticketNumber || '') + '\" readonly>' +\n");
      out.write("                                        '</div>' +\n");
      out.write("                                    '</div>' +\n");
      out.write("                                    '<div class=\"col-md-6\">' +\n");
      out.write("                                        '<div class=\"form-group\">' +\n");
      out.write("                                            '<label>Khách hàng:</label>' +\n");
      out.write("                                            '<input type=\"text\" class=\"form-control\" value=\"' + (ticket.customerName || '') + '\" readonly>' +\n");
      out.write("                                        '</div>' +\n");
      out.write("                                    '</div>' +\n");
      out.write("                                '</div>' +\n");
      out.write("                                '<div class=\"row\">' +\n");
      out.write("                                    '<div class=\"col-md-6\">' +\n");
      out.write("                                        '<div class=\"form-group\">' +\n");
      out.write("                                            '<label>Email:</label>' +\n");
      out.write("                                            '<input type=\"email\" class=\"form-control\" value=\"' + (ticket.customerEmail || '') + '\" readonly>' +\n");
      out.write("                                        '</div>' +\n");
      out.write("                                    '</div>' +\n");
      out.write("                                    '<div class=\"col-md-6\">' +\n");
      out.write("                                        '<div class=\"form-group\">' +\n");
      out.write("                                            '<label>Ngày tạo:</label>' +\n");
      out.write("                                            '<input type=\"text\" class=\"form-control\" id=\"detailCreatedAt\" readonly>' +\n");
      out.write("                                        '</div>' +\n");
      out.write("                                    '</div>' +\n");
      out.write("                                '</div>' +\n");
      out.write("                                 '<div class=\"form-group\">' +\n");
      out.write("                                     '<label>Tiêu đề:</label>' +\n");
      out.write("                                     '<input type=\"text\" class=\"form-control\" id=\"detailSubject\" value=\"' + (ticket.subject || '') + '\" readonly>' +\n");
      out.write("                                 '</div>' +\n");
      out.write("                                 '<div class=\"form-group\">' +\n");
      out.write("                                     '<label>Mô tả vấn đề:</label>' +\n");
      out.write("                                     '<textarea class=\"form-control\" id=\"detailDescription\" rows=\"4\" lang=\"vi\" inputmode=\"text\" placeholder=\"Nhập mô tả vấn đề bằng tiếng Việt...\" readonly>' + (ticket.description || '') + '</textarea>' +\n");
      out.write("                                 '</div>' +\n");
      out.write("                                '<div class=\"row\">' +\n");
      out.write("                                     '<div class=\"col-md-4\">' +\n");
      out.write("                                         '<div class=\"form-group\">' +\n");
      out.write("                                             '<label>Danh mục:</label>' +\n");
      out.write("                                             '<select class=\"form-control\" id=\"detailCategory\" disabled>' +\n");
      out.write("                                                 '<option value=\"technical\"' + (ticket.category === 'technical' ? ' selected' : '') + '>Kỹ thuật</option>' +\n");
      out.write("                                                 '<option value=\"billing\"' + (ticket.category === 'billing' ? ' selected' : '') + '>Thanh toán</option>' +\n");
      out.write("                                                 '<option value=\"general\"' + (ticket.category === 'general' ? ' selected' : '') + '>Chung</option>' +\n");
      out.write("                                                 '<option value=\"complaint\"' + (ticket.category === 'complaint' ? ' selected' : '') + '>Khiếu nại</option>' +\n");
      out.write("                                             '</select>' +\n");
      out.write("                                         '</div>' +\n");
      out.write("                                     '</div>' +\n");
      out.write("                                     '<div class=\"col-md-4\">' +\n");
      out.write("                                         '<div class=\"form-group\">' +\n");
      out.write("                                             '<label>Độ ưu tiên:</label>' +\n");
      out.write("                                             '<select class=\"form-control\" id=\"detailPriority\" ' + (isEditMode ? '' : 'disabled') + '>' +\n");
      out.write("                                                 '<option value=\"low\"' + (ticket.priority === 'low' ? ' selected' : '') + '>Thấp</option>' +\n");
      out.write("                                                 '<option value=\"medium\"' + (ticket.priority === 'medium' ? ' selected' : '') + '>Trung bình</option>' +\n");
      out.write("                                                 '<option value=\"high\"' + (ticket.priority === 'high' ? ' selected' : '') + '>Cao</option>' +\n");
      out.write("                                                 '<option value=\"urgent\"' + (ticket.priority === 'urgent' ? ' selected' : '') + '>Khẩn cấp</option>' +\n");
      out.write("                                             '</select>' +\n");
      out.write("                                         '</div>' +\n");
      out.write("                                     '</div>' +\n");
      out.write("                                     '<div class=\"col-md-4\">' +\n");
      out.write("                                         '<div class=\"form-group\">' +\n");
      out.write("                                             '<label>Trạng thái:</label>' +\n");
      out.write("                                             '<select class=\"form-control\" id=\"detailStatus\" ' + (isEditMode ? '' : 'disabled') + '>' +\n");
      out.write("                                                 '<option value=\"open\"' + (ticket.status === 'open' ? ' selected' : '') + '>Đang chờ</option>' +\n");
      out.write("                                                 '<option value=\"in_progress\"' + (ticket.status === 'in_progress' ? ' selected' : '') + '>Đang xử lý</option>' +\n");
      out.write("                                                 '<option value=\"resolved\"' + (ticket.status === 'resolved' ? ' selected' : '') + '>Đã giải quyết</option>' +\n");
      out.write("                                                 '<option value=\"closed\"' + (ticket.status === 'closed' ? ' selected' : '') + '>Đã đóng</option>' +\n");
      out.write("                                             '</select>' +\n");
      out.write("                                         '</div>' +\n");
      out.write("                                     '</div>' +\n");
      out.write("                                '</div>' +\n");
      out.write("                                '<div class=\"form-group\">' +\n");
      out.write("                                    '<label>Giải pháp:</label>' +\n");
      out.write("                                    '<textarea class=\"form-control\" id=\"detailResolution\" rows=\"3\" ' + (isEditMode ? '' : 'readonly') + '>' + (ticket.resolution || '') + '</textarea>' +\n");
      out.write("                                '</div>' +\n");
      out.write("                                '<div class=\"form-group\">' +\n");
      out.write("                                    '<label>Ghi chú nội bộ:</label>' +\n");
      out.write("                                    '<textarea class=\"form-control\" id=\"detailInternalNotes\" rows=\"2\" ' + (isEditMode ? '' : 'readonly') + ' placeholder=\"Ghi chú cho nhân viên\">' + (ticket.internalNotes || '') + '</textarea>' +\n");
      out.write("                                '</div>' +\n");
      out.write("                            '</form>' +\n");
      out.write("                        '</div>' +\n");
      out.write("                        '<div class=\"modal-footer\">' +\n");
      out.write("                            (isEditMode ? \n");
      out.write("                                '<button type=\"button\" class=\"btn btn-primary\" onclick=\"saveTicketChanges(' + ticket.id + ')\">Lưu thay đổi</button>' : \n");
      out.write("                                '<button type=\"button\" class=\"btn btn-warning\" onclick=\"editTicket(' + ticket.id + ')\">Chỉnh sửa</button>'\n");
      out.write("                            ) +\n");
      out.write("                            '<button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Đóng</button>' +\n");
      out.write("                        '</div>' +\n");
      out.write("                    '</div>' +\n");
      out.write("                '</div>' +\n");
      out.write("            '</div>';\n");
      out.write("            \n");
      out.write("            // Xóa modal cũ nếu có\n");
      out.write("            $('#ticketDetailModal').remove();\n");
      out.write("            \n");
      out.write("            // Thêm modal mới vào body\n");
      out.write("            $('body').append(modalHtml);\n");
      out.write("            \n");
      out.write("             // Hiển thị modal\n");
      out.write("             $('#ticketDetailModal').modal('show');\n");
      out.write("             \n");
      out.write("             // Set giá trị ngày tạo sau khi modal hiển thị\n");
      out.write("             setTimeout(function() {\n");
      out.write("                 $('#detailCreatedAt').val(formatDate(ticket.createdAt));\n");
      out.write("                 setupVietnameseInput();\n");
      out.write("             }, 300);\n");
      out.write("         }\n");
      out.write("         \n");
      out.write("         function setupVietnameseInput() {\n");
      out.write("             var descriptionField = $('#detailDescription');\n");
      out.write("             if (descriptionField.length > 0) {\n");
      out.write("                 // Thêm event listener để kiểm tra input\n");
      out.write("                 descriptionField.on('input', function() {\n");
      out.write("                     var value = $(this).val();\n");
      out.write("                     // Cho phép tiếng Việt, số, dấu câu và khoảng trắng\n");
      out.write("                     var vietnameseRegex = /^[a-zA-ZàáạảãâầấậẩẫăằắặẳẵèéẹẻẽêềếệểễìíịỉĩòóọỏõôồốộổỗơờớợởỡùúụủũưừứựửữỳýỵỷỹđĐ0-9\\s.,!?;:'\"()-]+$/;\n");
      out.write("                     \n");
      out.write("                     if (value && !vietnameseRegex.test(value)) {\n");
      out.write("                         // Thông báo lỗi nếu có ký tự không hợp lệ\n");
      out.write("                         $(this).addClass('error');\n");
      out.write("                         if (!$(this).next('.error-message').length) {\n");
      out.write("                             $(this).after('<div class=\"error-message text-danger\" style=\"font-size: 12px; margin-top: 5px;\">Chỉ được nhập tiếng Việt, số và dấu câu cơ bản</div>');\n");
      out.write("                         }\n");
      out.write("                     } else {\n");
      out.write("                         $(this).removeClass('error');\n");
      out.write("                         $(this).next('.error-message').remove();\n");
      out.write("                     }\n");
      out.write("                 });\n");
      out.write("                 \n");
      out.write("                 // Thêm CSS cho trạng thái lỗi\n");
      out.write("                 if (!$('#vietnamese-input-styles').length) {\n");
      out.write("                     $('head').append('<style id=\"vietnamese-input-styles\">' +\n");
      out.write("                         '#detailDescription.error { border-color: #d9534f; box-shadow: 0 0 5px rgba(217, 83, 79, 0.3); }' +\n");
      out.write("                         '</style>');\n");
      out.write("                 }\n");
      out.write("             }\n");
      out.write("         }\n");
      out.write("        \n");
      out.write("         function saveTicketChanges(ticketId) {\n");
      out.write("             // Chỉ lấy các trường được phép chỉnh sửa\n");
      out.write("             var formData = {\n");
      out.write("                action: 'update',\n");
      out.write("                 id: ticketId,\n");
      out.write("                 priority: $('#detailPriority').val(),\n");
      out.write("                 status: $('#detailStatus').val(),\n");
      out.write("                 resolution: $('#detailResolution').val(),\n");
      out.write("                 internalNotes: $('#detailInternalNotes').val()\n");
      out.write("            };\n");
      out.write("            \n");
      out.write("            $.ajax({\n");
      out.write("                url: 'api/support-stats',\n");
      out.write("                type: 'POST',\n");
      out.write("                data: formData,\n");
      out.write("                dataType: 'json',\n");
      out.write("                success: function(response) {\n");
      out.write("                    if (response.success) {\n");
      out.write("                        alert('Cập nhật ticket thành công!');\n");
      out.write("                        $('#ticketDetailModal').modal('hide');\n");
      out.write("                        loadTickets(); // Reload danh sách\n");
      out.write("                    } else {\n");
      out.write("                        alert('Lỗi: ' + response.message);\n");
      out.write("                    }\n");
      out.write("                },\n");
      out.write("                error: function(xhr, status, error) {\n");
      out.write("                    alert('Lỗi kết nối server: ' + error);\n");
      out.write("                }\n");
      out.write("            });\n");
      out.write("        }\n");
      out.write("        \n");
      out.write("         function forwardTicket(ticketId) {\n");
      out.write("             // Tìm ticket trong danh sách\n");
      out.write("             var ticket = ticketsData.find(function(t) { return t.id == ticketId; });\n");
      out.write("             if (!ticket) {\n");
      out.write("                 alert('Không tìm thấy ticket');\n");
      out.write("                 return;\n");
      out.write("             }\n");
      out.write("             \n");
      out.write("             // Hiển thị modal chuyển tiếp\n");
      out.write("             showForwardModal(ticket);\n");
      out.write("         }\n");
      out.write("         \n");
      out.write("         function showForwardModal(ticket) {\n");
      out.write("             var modalHtml = '<div class=\"modal fade\" id=\"forwardModal\" tabindex=\"-1\" role=\"dialog\">' +\n");
      out.write("                 '<div class=\"modal-dialog\" role=\"document\">' +\n");
      out.write("                     '<div class=\"modal-content\">' +\n");
      out.write("                         '<div class=\"modal-header\">' +\n");
      out.write("                             '<h4 class=\"modal-title\">Chuyển tiếp yêu cầu hỗ trợ</h4>' +\n");
      out.write("                             '<button type=\"button\" class=\"close\" data-dismiss=\"modal\">&times;</button>' +\n");
      out.write("                         '</div>' +\n");
      out.write("                         '<div class=\"modal-body\">' +\n");
      out.write("                             '<form id=\"forwardForm\">' +\n");
      out.write("                                 '<div class=\"form-group\">' +\n");
      out.write("                                     '<label>Ticket #' + ticket.ticketNumber + '</label>' +\n");
      out.write("                                     '<p class=\"form-control-static\">' + ticket.subject + '</p>' +\n");
      out.write("                                 '</div>' +\n");
      out.write("                                 '<div class=\"form-group\">' +\n");
      out.write("                                     '<label>Chuyển đến bộ phận:</label>' +\n");
      out.write("                                     '<select class=\"form-control\" id=\"forwardDepartment\" required>' +\n");
      out.write("                                         '<option value=\"\">-- Chọn bộ phận --</option>' +\n");
      out.write("                                         '<option value=\"head_technical\">Trưởng phòng Kỹ thuật</option>' +\n");
      out.write("                                     '</select>' +\n");
      out.write("                                 '</div>' +\n");
      out.write("                                 '<div class=\"form-group\">' +\n");
      out.write("                                     '<label>Ghi chú chuyển tiếp:</label>' +\n");
      out.write("                                     '<textarea class=\"form-control\" id=\"forwardNote\" rows=\"3\" placeholder=\"Lý do chuyển tiếp và hướng dẫn xử lý...\"></textarea>' +\n");
      out.write("                                 '</div>' +\n");
      out.write("                                 '<div class=\"form-group\">' +\n");
      out.write("                                     '<label>Độ ưu tiên mới:</label>' +\n");
      out.write("                                     '<select class=\"form-control\" id=\"forwardPriority\">' +\n");
      out.write("                                         '<option value=\"' + ticket.priority + '\">Giữ nguyên (' + getPriorityLabel(ticket.priority) + ')</option>' +\n");
      out.write("                                         '<option value=\"low\">Thấp</option>' +\n");
      out.write("                                         '<option value=\"medium\">Trung bình</option>' +\n");
      out.write("                                         '<option value=\"high\">Cao</option>' +\n");
      out.write("                                         '<option value=\"urgent\">Khẩn cấp</option>' +\n");
      out.write("                                     '</select>' +\n");
      out.write("                                 '</div>' +\n");
      out.write("                             '</form>' +\n");
      out.write("                         '</div>' +\n");
      out.write("                         '<div class=\"modal-footer\">' +\n");
      out.write("                             '<button type=\"button\" class=\"btn btn-primary\" onclick=\"confirmForward(' + ticket.id + ')\">Chuyển tiếp</button>' +\n");
      out.write("                             '<button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Hủy</button>' +\n");
      out.write("                         '</div>' +\n");
      out.write("                     '</div>' +\n");
      out.write("                 '</div>' +\n");
      out.write("             '</div>';\n");
      out.write("             \n");
      out.write("             // Xóa modal cũ nếu có\n");
      out.write("             $('#forwardModal').remove();\n");
      out.write("             \n");
      out.write("             // Thêm modal mới vào body\n");
      out.write("             $('body').append(modalHtml);\n");
      out.write("             \n");
      out.write("             // Hiển thị modal\n");
      out.write("             $('#forwardModal').modal('show');\n");
      out.write("         }\n");
      out.write("         \n");
      out.write("         function confirmForward(ticketId) {\n");
      out.write("             var department = $('#forwardDepartment').val();\n");
      out.write("             var forwardNote = $('#forwardNote').val();\n");
      out.write("             var forwardPriority = $('#forwardPriority').val();\n");
      out.write("             \n");
      out.write("             if (!department) {\n");
      out.write("                 alert('Vui lòng chọn bộ phận chuyển tiếp!');\n");
      out.write("                return;\n");
      out.write("            }\n");
      out.write("            \n");
      out.write("             if (confirm('Bạn có chắc chắn muốn chuyển tiếp ticket này?')) {\n");
      out.write("                 // Gửi request chuyển tiếp\n");
      out.write("                 $.ajax({\n");
      out.write("                     url: 'api/support-stats',\n");
      out.write("                     type: 'POST',\n");
      out.write("                     data: {\n");
      out.write("                         action: 'forward',\n");
      out.write("                         id: ticketId,\n");
      out.write("                         department: department,\n");
      out.write("                         forwardNote: forwardNote,\n");
      out.write("                         forwardPriority: forwardPriority\n");
      out.write("                     },\n");
      out.write("                     dataType: 'json',\n");
      out.write("                     success: function(response) {\n");
      out.write("                         if (response.success) {\n");
      out.write("                             alert('Chuyển tiếp ticket thành công! Ticket đã được chuyển đến Trưởng phòng Kỹ thuật.');\n");
      out.write("                             $('#forwardModal').modal('hide');\n");
      out.write("                             loadTickets(); // Reload danh sách\n");
      out.write("                             \n");
      out.write("                             // Redirect đến trang tech_support_management.jsp sau 2 giây\n");
      out.write("                             setTimeout(function() {\n");
      out.write("                                 window.location.href = 'tech_support_management.jsp';\n");
      out.write("                             }, 2000);\n");
      out.write("            } else {\n");
      out.write("                             alert('Lỗi: ' + response.message);\n");
      out.write("                         }\n");
      out.write("                     },\n");
      out.write("                     error: function(xhr, status, error) {\n");
      out.write("                         alert('Lỗi kết nối server: ' + error);\n");
      out.write("                     }\n");
      out.write("                 });\n");
      out.write("             }\n");
      out.write("         }\n");
      out.write("         \n");
      out.write("         function deleteTicket(ticketId) {\n");
      out.write("             if (confirm('Bạn có chắc chắn muốn xóa ticket #' + ticketId + '?')) {\n");
      out.write("                 // TODO: Implement delete functionality\n");
      out.write("                 alert('Xóa ticket #' + ticketId);\n");
      out.write("             }\n");
      out.write("         }\n");
      out.write("\n");
      out.write("        function showError(message) {\n");
      out.write("            $('#ticketsTableBody').html('<tr><td colspan=\"9\" class=\"text-center text-danger\">' + message + '</td></tr>');\n");
      out.write("        }\n");
      out.write("    </script>\n");
      out.write("</body>\n");
      out.write("</html>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
