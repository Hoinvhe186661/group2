/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.47
 * Generated at: 2025-11-10 13:04:57 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;

public final class feedback_005fmanagement_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");

    // Kiểm tra đăng nhập
    String username = (String) session.getAttribute("username");
    Boolean isLoggedIn = (Boolean) session.getAttribute("isLoggedIn");
    String userRole = (String) session.getAttribute("userRole");
    
    if (username == null || isLoggedIn == null || !isLoggedIn) {
        response.sendRedirect(request.getContextPath() + "/login.jsp");
        return;
    }
    
    // Kiểm tra quyền customer_support hoặc admin
    if (!"customer_support".equals(userRole) && !"admin".equals(userRole)) {
        response.sendRedirect(request.getContextPath() + "/index.jsp");
        return;
    }

      out.write("\r\n");
      out.write("<!DOCTYPE html>\r\n");
      out.write("<html>\r\n");
      out.write("<head>\r\n");
      out.write("    <meta charset=\"UTF-8\">\r\n");
      out.write("    <title>Quản Lý Feedback | Bảng Điều Khiển</title>\r\n");
      out.write("    <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>\r\n");
      out.write("    \r\n");
      out.write("    <!-- bootstrap 3.0.2 -->\r\n");
      out.write("    <link href=\"css/bootstrap.min.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n");
      out.write("    <!-- font Awesome -->\r\n");
      out.write("    <link href=\"css/font-awesome.min.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n");
      out.write("    <!-- Ionicons -->\r\n");
      out.write("    <link href=\"css/ionicons.min.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n");
      out.write("    <!-- DataTables -->\r\n");
      out.write("    <link href=\"css/datatables/dataTables.bootstrap.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n");
      out.write("    <!-- Theme style -->\r\n");
      out.write("    <link href=\"css/style.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n");
      out.write("\r\n");
      out.write("    <style>\r\n");
      out.write("        .filter-section {\r\n");
      out.write("            background: #f9f9f9;\r\n");
      out.write("            padding: 15px;\r\n");
      out.write("            margin-bottom: 20px;\r\n");
      out.write("            border-radius: 5px;\r\n");
      out.write("        }\r\n");
      out.write("        .rating-stars {\r\n");
      out.write("            font-size: 18px;\r\n");
      out.write("            color: #ffc107;\r\n");
      out.write("        }\r\n");
      out.write("        .feedback-image {\r\n");
      out.write("            max-width: 300px;\r\n");
      out.write("            max-height: 300px;\r\n");
      out.write("            border-radius: 5px;\r\n");
      out.write("            border: 1px solid #ddd;\r\n");
      out.write("            margin-top: 10px;\r\n");
      out.write("            cursor: pointer;\r\n");
      out.write("        }\r\n");
      out.write("        .detail-section {\r\n");
      out.write("            margin-bottom: 20px;\r\n");
      out.write("            padding: 15px;\r\n");
      out.write("            border: 1px solid #ddd;\r\n");
      out.write("            border-radius: 5px;\r\n");
      out.write("        }\r\n");
      out.write("        .detail-section h4 {\r\n");
      out.write("            margin-top: 0;\r\n");
      out.write("            color: #3c8dbc;\r\n");
      out.write("            border-bottom: 2px solid #3c8dbc;\r\n");
      out.write("            padding-bottom: 10px;\r\n");
      out.write("        }\r\n");
      out.write("        /* Ẩn phần \"records per page\" của DataTables */\r\n");
      out.write("        .dataTables_length {\r\n");
      out.write("            display: none !important;\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        /* Styling cho phân trang - Giống template work_orders.jsp */\r\n");
      out.write("        .dataTables_wrapper .dataTables_paginate {\r\n");
      out.write("            margin-top: 15px;\r\n");
      out.write("            text-align: center;\r\n");
      out.write("            float: none !important;\r\n");
      out.write("            display: block !important;\r\n");
      out.write("            visibility: visible !important;\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        .dataTables_wrapper .dataTables_paginate .paginate_button {\r\n");
      out.write("            padding: 6px 12px;\r\n");
      out.write("            margin: 0 2px;\r\n");
      out.write("            border: 1px solid #ddd;\r\n");
      out.write("            border-radius: 4px;\r\n");
      out.write("            background: #fff;\r\n");
      out.write("            color: #333 !important;\r\n");
      out.write("            cursor: pointer;\r\n");
      out.write("            display: inline-block !important;\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {\r\n");
      out.write("            background: #f5f5f5;\r\n");
      out.write("            border-color: #999;\r\n");
      out.write("            color: #333 !important;\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        .dataTables_wrapper .dataTables_paginate .paginate_button.current {\r\n");
      out.write("            background: #3c8dbc !important;\r\n");
      out.write("            color: #fff !important;\r\n");
      out.write("            border-color: #3c8dbc !important;\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {\r\n");
      out.write("            background: #357abd !important;\r\n");
      out.write("            color: #fff !important;\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        .dataTables_wrapper .dataTables_paginate .paginate_button.disabled {\r\n");
      out.write("            opacity: 0.5;\r\n");
      out.write("            cursor: not-allowed;\r\n");
      out.write("            background: #f5f5f5 !important;\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        .dataTables_wrapper .dataTables_paginate .paginate_button.disabled:hover {\r\n");
      out.write("            background: #f5f5f5 !important;\r\n");
      out.write("            color: #333 !important;\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        .dataTables_wrapper .dataTables_info {\r\n");
      out.write("            margin-top: 15px;\r\n");
      out.write("            padding-top: 8px;\r\n");
      out.write("            float: left;\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        /* Đảm bảo wrapper hiển thị đúng */\r\n");
      out.write("        .dataTables_wrapper::after {\r\n");
      out.write("            content: \"\";\r\n");
      out.write("            display: table;\r\n");
      out.write("            clear: both;\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        /* Đảm bảo phân trang luôn hiển thị, kể cả khi chỉ có ít bản ghi */\r\n");
      out.write("        .dataTables_wrapper .dataTables_paginate.paging_full_numbers {\r\n");
      out.write("            display: block !important;\r\n");
      out.write("            visibility: visible !important;\r\n");
      out.write("            opacity: 1 !important;\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        /* Đảm bảo không có CSS nào ẩn phân trang */\r\n");
      out.write("        .dataTables_wrapper .dataTables_paginate[style*=\"display: none\"] {\r\n");
      out.write("            display: block !important;\r\n");
      out.write("        }\r\n");
      out.write("    </style>\r\n");
      out.write("</head>\r\n");
      out.write("<body class=\"skin-black\">\r\n");
      out.write("    <!-- header logo: style can be found in header.less -->\r\n");
      out.write("    <header class=\"header\">\r\n");
      out.write("        <a href=\"feedback_management.jsp\" class=\"logo\">\r\n");
      out.write("            Quản Lý Feedback Khách Hàng\r\n");
      out.write("        </a>\r\n");
      out.write("        <!-- Header Navbar: style can be found in header.less -->\r\n");
      out.write("        <nav class=\"navbar navbar-static-top\" role=\"navigation\">\r\n");
      out.write("            <!-- Sidebar toggle button-->\r\n");
      out.write("            <a href=\"#\" class=\"navbar-btn sidebar-toggle\" data-toggle=\"offcanvas\" role=\"button\">\r\n");
      out.write("                <span class=\"sr-only\">Toggle navigation</span>\r\n");
      out.write("                <span class=\"icon-bar\"></span>\r\n");
      out.write("                <span class=\"icon-bar\"></span>\r\n");
      out.write("                <span class=\"icon-bar\"></span>\r\n");
      out.write("            </a>\r\n");
      out.write("            <div class=\"navbar-right\">\r\n");
      out.write("                <ul class=\"nav navbar-nav\">\r\n");
      out.write("                    <!-- User Account: style can be found in dropdown.less -->\r\n");
      out.write("                    <li class=\"dropdown user user-menu\">\r\n");
      out.write("                        <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">\r\n");
      out.write("                            <i class=\"fa fa-user\"></i>\r\n");
      out.write("                            <span>");
      out.print( username );
      out.write(" <i class=\"caret\"></i></span>\r\n");
      out.write("                        </a>\r\n");
      out.write("                        <ul class=\"dropdown-menu dropdown-custom dropdown-menu-right\">\r\n");
      out.write("                            <li class=\"dropdown-header text-center\">Tài khoản</li>\r\n");
      out.write("                            <li>\r\n");
      out.write("                                <a href=\"profile.jsp\">\r\n");
      out.write("                                <i class=\"fa fa-user fa-fw pull-right\"></i>\r\n");
      out.write("                                    Hồ sơ\r\n");
      out.write("                                </a>\r\n");
      out.write("                                <a href=\"settings.jsp\">\r\n");
      out.write("                                <i class=\"fa fa-cog fa-fw pull-right\"></i>\r\n");
      out.write("                                    Cài đặt cá nhân\r\n");
      out.write("                                </a>\r\n");
      out.write("                            </li>\r\n");
      out.write("                            <li class=\"divider\"></li>\r\n");
      out.write("                            <li>\r\n");
      out.write("                                <a href=\"logout\"><i class=\"fa fa-ban fa-fw pull-right\"></i> Đăng xuất</a>\r\n");
      out.write("                            </li>\r\n");
      out.write("                        </ul>\r\n");
      out.write("                    </li>\r\n");
      out.write("                </ul>\r\n");
      out.write("            </div>\r\n");
      out.write("        </nav>\r\n");
      out.write("    </header>\r\n");
      out.write("    \r\n");
      out.write("    <div class=\"wrapper row-offcanvas row-offcanvas-left\">\r\n");
      out.write("        <!-- Left side column. contains the logo and sidebar -->\r\n");
      out.write("        <aside class=\"left-side sidebar-offcanvas\">\r\n");
      out.write("            <!-- sidebar: style can be found in sidebar.less -->\r\n");
      out.write("            <section class=\"sidebar\">\r\n");
      out.write("                <!-- Sidebar user panel -->\r\n");
      out.write("                <div class=\"user-panel\">\r\n");
      out.write("                    <div class=\"pull-left image\">\r\n");
      out.write("                        <img src=\"img/26115.jpg\" class=\"img-circle\" alt=\"User Image\" />\r\n");
      out.write("                    </div>\r\n");
      out.write("                    <div class=\"pull-left info\">\r\n");
      out.write("                        <p>Xin chào, ");
      out.print( username );
      out.write("</p>\r\n");
      out.write("                        <a href=\"#\"><i class=\"fa fa-circle text-success\"></i> Online</a>\r\n");
      out.write("                    </div>\r\n");
      out.write("                </div>\r\n");
      out.write("                <!-- sidebar menu: : style can be found in sidebar.less -->\r\n");
      out.write("                <ul class=\"sidebar-menu\">\r\n");
      out.write("                    <li>\r\n");
      out.write("                        <a href=\"customersupport.jsp\">\r\n");
      out.write("                            <i class=\"fa fa-dashboard\"></i> <span>Bảng điều khiển</span>\r\n");
      out.write("                        </a>\r\n");
      out.write("                    </li>\r\n");
      out.write("                    <li>\r\n");
      out.write("                        <a href=\"support-management\">\r\n");
      out.write("                            <i class=\"fa fa-ticket\"></i> <span>Quản lý yêu cầu hỗ trợ</span>\r\n");
      out.write("                            <small class=\"badge pull-right bg-red\" id=\"openTickets\">0</small>\r\n");
      out.write("                        </a>\r\n");
      out.write("                    </li>\r\n");
      out.write("                    <li>\r\n");
      out.write("                        <a href=\"feedback_management.jsp\">\r\n");
      out.write("                            <i class=\"fa fa-star\"></i> <span>Quản lý Feedback</span>\r\n");
      out.write("                        </a>\r\n");
      out.write("                    </li>\r\n");
      out.write("                    <li>\r\n");
      out.write("                        <a href=\"contracts.jsp\">\r\n");
      out.write("                            <i class=\"fa fa-file-text\"></i> <span>Hợp đồng khách hàng</span>\r\n");
      out.write("                        </a>\r\n");
      out.write("                    </li>\r\n");
      out.write("                    <li>\r\n");
      out.write("                        <a href=\"contact-management\">\r\n");
      out.write("                            <i class=\"fa fa-envelope\"></i> <span>Quản lý liên hệ</span>\r\n");
      out.write("                            <small class=\"badge pull-right bg-blue\" id=\"unreadContacts\">0</small>\r\n");
      out.write("                        </a>\r\n");
      out.write("                    </li>\r\n");
      out.write("                    <li class=\"active\">\r\n");
      out.write("                        <a href=\"customers\">\r\n");
      out.write("                            <i class=\"fa fa-users\"></i> <span>Quản lý khách hàng</span>\r\n");
      out.write("                        </a>\r\n");
      out.write("                    </li>\r\n");
      out.write("                </ul>\r\n");
      out.write("            </section>\r\n");
      out.write("            <!-- /.sidebar -->\r\n");
      out.write("        </aside>\r\n");
      out.write("\r\n");
      out.write("        <aside class=\"right-side\">\r\n");
      out.write("            <!-- Main content -->\r\n");
      out.write("            <section class=\"content\">\r\n");
      out.write("                <div class=\"row\">\r\n");
      out.write("                    <div class=\"col-xs-12\">\r\n");
      out.write("                        <div class=\"box\">\r\n");
      out.write("                            <div class=\"box-header\">\r\n");
      out.write("                                <h3 class=\"box-title\">\r\n");
      out.write("                                    <i class=\"fa fa-star\"></i> Danh sách Feedback từ Khách Hàng\r\n");
      out.write("                                </h3>\r\n");
      out.write("                            </div>\r\n");
      out.write("                            <!-- /.box-header -->\r\n");
      out.write("                            <div class=\"box-body\">\r\n");
      out.write("                                <!-- Filter Section -->\r\n");
      out.write("                                <div class=\"filter-section\">\r\n");
      out.write("                                    <div class=\"row\">\r\n");
      out.write("                                        <div class=\"col-md-3\">\r\n");
      out.write("                                            <label>Tên khách hàng:</label>\r\n");
      out.write("                                            <input type=\"text\" id=\"filterCustomerName\" class=\"form-control\" placeholder=\"Nhập tên khách hàng...\">\r\n");
      out.write("                                        </div>\r\n");
      out.write("                                        <div class=\"col-md-3\">\r\n");
      out.write("                                            <label>Mã Ticket:</label>\r\n");
      out.write("                                            <input type=\"text\" id=\"filterTicketNumber\" class=\"form-control\" placeholder=\"Nhập mã ticket...\">\r\n");
      out.write("                                        </div>\r\n");
      out.write("                                        <div class=\"col-md-3\">\r\n");
      out.write("                                            <label>Đánh giá:</label>\r\n");
      out.write("                                            <select id=\"filterRating\" class=\"form-control\">\r\n");
      out.write("                                                <option value=\"\">Tất cả</option>\r\n");
      out.write("                                                <option value=\"5\">5 sao - Rất hài lòng</option>\r\n");
      out.write("                                                <option value=\"4\">4 sao - Hài lòng</option>\r\n");
      out.write("                                                <option value=\"3\">3 sao - Bình thường</option>\r\n");
      out.write("                                                <option value=\"2\">2 sao - Không hài lòng</option>\r\n");
      out.write("                                                <option value=\"1\">1 sao - Rất không hài lòng</option>\r\n");
      out.write("                                            </select>\r\n");
      out.write("                                        </div>\r\n");
      out.write("                                        <div class=\"col-md-3\">\r\n");
      out.write("                                            <label>Danh mục ticket:</label>\r\n");
      out.write("                                            <select id=\"filterCategory\" class=\"form-control\">\r\n");
      out.write("                                                <option value=\"\">Tất cả</option>\r\n");
      out.write("                                                <option value=\"technical\">Kỹ thuật</option>\r\n");
      out.write("                                                <option value=\"billing\">Thanh toán</option>\r\n");
      out.write("                                                <option value=\"general\">Chung</option>\r\n");
      out.write("                                                <option value=\"complaint\">Khiếu nại</option>\r\n");
      out.write("                                            </select>\r\n");
      out.write("                                        </div>\r\n");
      out.write("                                    </div>\r\n");
      out.write("                                    <div class=\"row\" style=\"margin-top: 10px;\">\r\n");
      out.write("                                        <div class=\"col-md-12 text-right\">\r\n");
      out.write("                                            <button type=\"button\" class=\"btn btn-primary\" id=\"filterBtn\" onclick=\"applyFilters()\">\r\n");
      out.write("                                                <i class=\"fa fa-filter\"></i> Lọc\r\n");
      out.write("                                            </button>\r\n");
      out.write("                                            <button type=\"button\" class=\"btn btn-default\" id=\"resetFilterBtn\" onclick=\"resetFilters()\">\r\n");
      out.write("                                                <i class=\"fa fa-refresh\"></i> Xóa bộ lọc\r\n");
      out.write("                                            </button>\r\n");
      out.write("                                        </div>\r\n");
      out.write("                                    </div>\r\n");
      out.write("                                </div>\r\n");
      out.write("                                \r\n");
      out.write("                                <!-- Feedback Table -->\r\n");
      out.write("                                <div class=\"table-responsive\">\r\n");
      out.write("                                    <table id=\"feedbacksTable\" class=\"table table-striped table-bordered table-hover\">\r\n");
      out.write("                                        <thead>\r\n");
      out.write("                                            <tr>\r\n");
      out.write("                                                <th>ID</th>\r\n");
      out.write("                                                <th>Mã Ticket</th>\r\n");
      out.write("                                                <th>Khách hàng</th>\r\n");
      out.write("                                                <th>Danh mục</th>\r\n");
      out.write("                                                <th>Sao</th>\r\n");
      out.write("                                                <th>Thao tác</th>\r\n");
      out.write("                                            </tr>\r\n");
      out.write("                                        </thead>\r\n");
      out.write("                                        <tbody id=\"feedbacksTableBody\">\r\n");
      out.write("                                            <tr>\r\n");
      out.write("                                                <td colspan=\"6\" class=\"text-center\">\r\n");
      out.write("                                                    <i class=\"fa fa-spinner fa-spin\"></i> Đang tải dữ liệu...\r\n");
      out.write("                                                </td>\r\n");
      out.write("                                            </tr>\r\n");
      out.write("                                        </tbody>\r\n");
      out.write("                                    </table>\r\n");
      out.write("                                </div>\r\n");
      out.write("                            </div>\r\n");
      out.write("                            <!-- /.box-body -->\r\n");
      out.write("                        </div>\r\n");
      out.write("                        <!-- /.box -->\r\n");
      out.write("                    </div>\r\n");
      out.write("                    <!-- /.col -->\r\n");
      out.write("                </div>\r\n");
      out.write("                <!-- /.row -->\r\n");
      out.write("            </section>\r\n");
      out.write("            <!-- /.content -->\r\n");
      out.write("        </aside>\r\n");
      out.write("        <!-- /.right-side -->\r\n");
      out.write("    </div>\r\n");
      out.write("    <!-- ./wrapper -->\r\n");
      out.write("\r\n");
      out.write("    <!-- Modal Xem Chi Tiết Feedback -->\r\n");
      out.write("    <div class=\"modal fade\" id=\"viewFeedbackModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"viewFeedbackModalLabel\">\r\n");
      out.write("        <div class=\"modal-dialog modal-lg\" role=\"document\">\r\n");
      out.write("            <div class=\"modal-content\">\r\n");
      out.write("                <div class=\"modal-header\" style=\"background-color: #3c8dbc; color: white;\">\r\n");
      out.write("                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\" style=\"color: white; opacity: 0.8;\">\r\n");
      out.write("                        <span aria-hidden=\"true\">&times;</span>\r\n");
      out.write("                    </button>\r\n");
      out.write("                    <h4 class=\"modal-title\" id=\"viewFeedbackModalLabel\">\r\n");
      out.write("                        <i class=\"fa fa-star\"></i> Chi Tiết Feedback\r\n");
      out.write("                    </h4>\r\n");
      out.write("                </div>\r\n");
      out.write("                <div class=\"modal-body\" id=\"feedbackDetailContent\">\r\n");
      out.write("                    <div class=\"text-center\">\r\n");
      out.write("                        <i class=\"fa fa-spinner fa-spin fa-3x\"></i>\r\n");
      out.write("                        <p>Đang tải dữ liệu...</p>\r\n");
      out.write("                    </div>\r\n");
      out.write("                </div>\r\n");
      out.write("                <div class=\"modal-footer\">\r\n");
      out.write("                    <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">\r\n");
      out.write("                        <i class=\"fa fa-times\"></i> Đóng\r\n");
      out.write("                    </button>\r\n");
      out.write("                </div>\r\n");
      out.write("            </div>\r\n");
      out.write("        </div>\r\n");
      out.write("    </div>\r\n");
      out.write("\r\n");
      out.write("    <!-- Modal Xem Ảnh -->\r\n");
      out.write("    <div class=\"modal fade\" id=\"imageModal\" tabindex=\"-1\" role=\"dialog\">\r\n");
      out.write("        <div class=\"modal-dialog modal-lg\" role=\"document\">\r\n");
      out.write("            <div class=\"modal-content\">\r\n");
      out.write("                <div class=\"modal-header\">\r\n");
      out.write("                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\">&times;</button>\r\n");
      out.write("                    <h4 class=\"modal-title\">Ảnh Feedback</h4>\r\n");
      out.write("                </div>\r\n");
      out.write("                <div class=\"modal-body text-center\">\r\n");
      out.write("                    <img id=\"modalImage\" src=\"\" style=\"max-width: 100%; height: auto;\">\r\n");
      out.write("                </div>\r\n");
      out.write("            </div>\r\n");
      out.write("        </div>\r\n");
      out.write("    </div>\r\n");
      out.write("\r\n");
      out.write("    <!-- jQuery 2.0.2 -->\r\n");
      out.write("    <script src=\"js/jquery.min.js\"></script>\r\n");
      out.write("    <!-- Bootstrap -->\r\n");
      out.write("    <script src=\"js/bootstrap.min.js\" type=\"text/javascript\"></script>\r\n");
      out.write("    <!-- DataTables -->\r\n");
      out.write("    <script src=\"js/plugins/datatables/jquery.dataTables.js\" type=\"text/javascript\"></script>\r\n");
      out.write("    <script src=\"js/plugins/datatables/dataTables.bootstrap.js\" type=\"text/javascript\"></script>\r\n");
      out.write("    <!-- AdminLTE App -->\r\n");
      out.write("    <script src=\"js/AdminLTE/app.js\" type=\"text/javascript\"></script>\r\n");
      out.write("\r\n");
      out.write("    <script>\r\n");
      out.write("        var allFeedbacks = [];\r\n");
      out.write("        var dataTable;\r\n");
      out.write("        var ctx = '");
      out.print( request.getContextPath() );
      out.write("';\r\n");
      out.write("        \r\n");
      out.write("        // Helper function to check if DataTables is available\r\n");
      out.write("        function isDataTableAvailable() {\r\n");
      out.write("            return typeof $.fn.dataTable !== 'undefined' && \r\n");
      out.write("                   typeof $.fn.dataTable.isDataTable === 'function';\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        // Helper function to check if table is initialized\r\n");
      out.write("        function isTableInitialized() {\r\n");
      out.write("            if (!isDataTableAvailable()) {\r\n");
      out.write("                return false;\r\n");
      out.write("            }\r\n");
      out.write("            try {\r\n");
      out.write("                return $.fn.dataTable.isDataTable('#feedbacksTable');\r\n");
      out.write("            } catch(e) {\r\n");
      out.write("                return false;\r\n");
      out.write("            }\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        // Load feedbacks on page load\r\n");
      out.write("        $(document).ready(function() {\r\n");
      out.write("            loadFeedbacks();\r\n");
      out.write("            \r\n");
      out.write("            // Allow Enter key to trigger filter\r\n");
      out.write("            $('#filterCustomerName, #filterTicketNumber').on('keypress', function(e) {\r\n");
      out.write("                if (e.which === 13) { // Enter key\r\n");
      out.write("                    applyFilters();\r\n");
      out.write("                }\r\n");
      out.write("            });\r\n");
      out.write("        });\r\n");
      out.write("        \r\n");
      out.write("        function loadFeedbacks() {\r\n");
      out.write("            loadFeedbacksWithFilters();\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        function loadFeedbacksWithFilters() {\r\n");
      out.write("            // Build URL with filter parameters\r\n");
      out.write("            var url = ctx + '/api/feedback?action=list';\r\n");
      out.write("            var params = [];\r\n");
      out.write("            \r\n");
      out.write("            var customerName = $('#filterCustomerName').val().trim();\r\n");
      out.write("            var ticketNumber = $('#filterTicketNumber').val().trim();\r\n");
      out.write("            var rating = $('#filterRating').val();\r\n");
      out.write("            var category = $('#filterCategory').val();\r\n");
      out.write("            \r\n");
      out.write("            if (customerName) {\r\n");
      out.write("                params.push('customerName=' + encodeURIComponent(customerName));\r\n");
      out.write("            }\r\n");
      out.write("            if (ticketNumber) {\r\n");
      out.write("                params.push('ticketNumber=' + encodeURIComponent(ticketNumber));\r\n");
      out.write("            }\r\n");
      out.write("            if (rating) {\r\n");
      out.write("                params.push('rating=' + encodeURIComponent(rating));\r\n");
      out.write("            }\r\n");
      out.write("            if (category) {\r\n");
      out.write("                params.push('category=' + encodeURIComponent(category));\r\n");
      out.write("            }\r\n");
      out.write("            \r\n");
      out.write("            if (params.length > 0) {\r\n");
      out.write("                url += '&' + params.join('&');\r\n");
      out.write("            }\r\n");
      out.write("            \r\n");
      out.write("            $.ajax({\r\n");
      out.write("                url: url,\r\n");
      out.write("                type: 'GET',\r\n");
      out.write("                dataType: 'json',\r\n");
      out.write("                success: function(response) {\r\n");
      out.write("                    console.log('Feedback response:', response);\r\n");
      out.write("                    if (response && response.success) {\r\n");
      out.write("                        if (response.data && Array.isArray(response.data)) {\r\n");
      out.write("                            allFeedbacks = response.data;\r\n");
      out.write("                            console.log('Loaded feedbacks:', allFeedbacks.length);\r\n");
      out.write("                            renderFeedbacks();\r\n");
      out.write("                        } else {\r\n");
      out.write("                            allFeedbacks = [];\r\n");
      out.write("                            console.log('No feedback data');\r\n");
      out.write("                            $('#feedbacksTableBody').html('<tr><td colspan=\"6\" class=\"text-center\"><i class=\"fa fa-info-circle\"></i> Không có feedback nào</td></tr>');\r\n");
      out.write("                            renderFeedbacks();\r\n");
      out.write("                        }\r\n");
      out.write("                    } else {\r\n");
      out.write("                        allFeedbacks = [];\r\n");
      out.write("                        console.error('Response error:', response);\r\n");
      out.write("                        $('#feedbacksTableBody').html('<tr><td colspan=\"6\" class=\"text-center text-danger\"><i class=\"fa fa-times-circle\"></i> ' + (response && response.message ? response.message : 'Lỗi khi tải dữ liệu') + '</td></tr>');\r\n");
      out.write("                        renderFeedbacks();\r\n");
      out.write("                    }\r\n");
      out.write("                },\r\n");
      out.write("                error: function(xhr, status, error) {\r\n");
      out.write("                    console.error('Error loading feedbacks:', error);\r\n");
      out.write("                    console.error('XHR:', xhr);\r\n");
      out.write("                    console.error('Status:', status);\r\n");
      out.write("                    allFeedbacks = [];\r\n");
      out.write("                    $('#feedbacksTableBody').html('<tr><td colspan=\"6\" class=\"text-center text-danger\"><i class=\"fa fa-times-circle\"></i> Lỗi khi tải dữ liệu: ' + error + '</td></tr>');\r\n");
      out.write("                    renderFeedbacks();\r\n");
      out.write("                }\r\n");
      out.write("            });\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        function applyFilters() {\r\n");
      out.write("            loadFeedbacksWithFilters();\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        function resetFilters() {\r\n");
      out.write("            $('#filterCustomerName').val('');\r\n");
      out.write("            $('#filterTicketNumber').val('');\r\n");
      out.write("            $('#filterRating').val('');\r\n");
      out.write("            $('#filterCategory').val('');\r\n");
      out.write("            loadFeedbacksWithFilters();\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        function renderFeedbacks() {\r\n");
      out.write("            // Data is already filtered from backend, just render it\r\n");
      out.write("            var html = '';\r\n");
      out.write("            \r\n");
      out.write("            if (allFeedbacks.length === 0) {\r\n");
      out.write("                // Empty state - show message\r\n");
      out.write("                html = '<tr><td colspan=\"6\" class=\"text-center\"><i class=\"fa fa-info-circle\"></i> Không có feedback nào</td></tr>';\r\n");
      out.write("            } else {\r\n");
      out.write("                allFeedbacks.forEach(function(fb, index) {\r\n");
      out.write("                    html += '<tr>';\r\n");
      out.write("                    // Hiển thị số thứ tự bắt đầu từ 1\r\n");
      out.write("                    html += '<td>' + (index + 1) + '</td>';\r\n");
      out.write("                    html += '<td><strong>#' + escapeHtml(fb.ticketNumber || 'N/A') + '</strong></td>';\r\n");
      out.write("                    html += '<td>' + escapeHtml(fb.customerName || 'N/A') + '</td>';\r\n");
      out.write("                    // Danh mục với badge\r\n");
      out.write("                    html += '<td>' + getCategoryBadge(fb.ticketCategory) + '</td>';\r\n");
      out.write("                    html += '<td><span class=\"rating-stars\">' + escapeHtml(fb.ratingStars || '') + '</span></td>';\r\n");
      out.write("                    html += '<td>';\r\n");
      out.write("                    html += '<button class=\"btn btn-info btn-xs view-feedback-btn\" data-feedback-id=\"' + fb.id + '\" title=\"Xem chi tiết\">';\r\n");
      out.write("                    html += '<i class=\"fa fa-eye\"></i> Xem';\r\n");
      out.write("                    html += '</button>';\r\n");
      out.write("                    html += '</td>';\r\n");
      out.write("                    html += '</tr>';\r\n");
      out.write("                });\r\n");
      out.write("            }\r\n");
      out.write("            \r\n");
      out.write("            $('#feedbacksTableBody').html(html);\r\n");
      out.write("            \r\n");
      out.write("            // Destroy DataTable if it exists\r\n");
      out.write("            if (isTableInitialized()) {\r\n");
      out.write("                try {\r\n");
      out.write("                    $('#feedbacksTable').DataTable().destroy();\r\n");
      out.write("                } catch(e) {\r\n");
      out.write("                    console.log('Error destroying DataTable:', e);\r\n");
      out.write("                }\r\n");
      out.write("            }\r\n");
      out.write("            dataTable = null;\r\n");
      out.write("            \r\n");
      out.write("            // Only initialize DataTable if we have data rows (not empty state)\r\n");
      out.write("            if (allFeedbacks.length > 0) {\r\n");
      out.write("                // Small delay to ensure DOM is updated and DataTables is loaded\r\n");
      out.write("                setTimeout(function() {\r\n");
      out.write("                    // Check if DataTables is available\r\n");
      out.write("                    if (!isDataTableAvailable()) {\r\n");
      out.write("                        console.error('DataTables library is not loaded');\r\n");
      out.write("                        return;\r\n");
      out.write("                    }\r\n");
      out.write("                    \r\n");
      out.write("                    // Check again to make sure it's not already initialized\r\n");
      out.write("                    if (!isTableInitialized()) {\r\n");
      out.write("                        try {\r\n");
      out.write("                            dataTable = $('#feedbacksTable').DataTable({\r\n");
      out.write("                                \"language\": {\r\n");
      out.write("                                    \"url\": \"//cdn.datatables.net/plug-ins/1.10.24/i18n/Vietnamese.json\"\r\n");
      out.write("                                },\r\n");
      out.write("                                \"pageLength\": 10, // Hiển thị 10 bản ghi mỗi trang\r\n");
      out.write("                                \"lengthChange\": false, // Ẩn dropdown \"records per page\"\r\n");
      out.write("                                \"paging\": true, // Bật phân trang\r\n");
      out.write("                                \"pagingType\": \"full_numbers\", // Hiển thị số trang đầy đủ (Previous, 1, 2, 3, ..., Next)\r\n");
      out.write("                                \"info\": true, // Hiển thị thông tin \"Showing X to Y of Z entries\"\r\n");
      out.write("                                \"order\": [[0, \"desc\"]], // Sắp xếp theo ID giảm dần\r\n");
      out.write("                                \"dom\": '<\"top\"lf>rt<\"bottom\"ip><\"clear\">', // Cấu trúc DOM: top (length, filter), table, bottom (info, pagination)\r\n");
      out.write("                                \"columnDefs\": [\r\n");
      out.write("                                    { \r\n");
      out.write("                                        \"targets\": 0, // Cột ID (cột đầu tiên)\r\n");
      out.write("                                        \"render\": function (data, type, row, meta) {\r\n");
      out.write("                                            // Hiển thị số thứ tự bắt đầu từ 1, tính cả pagination\r\n");
      out.write("                                            return meta.settings._iDisplayStart + meta.row + 1;\r\n");
      out.write("                                        }\r\n");
      out.write("                                    },\r\n");
      out.write("                                    { \"orderable\": false, \"targets\": 5 } // Không sort cột Thao tác (cột cuối cùng)\r\n");
      out.write("                                ],\r\n");
      out.write("                                \"destroy\": true,\r\n");
      out.write("                                \"drawCallback\": function(settings) {\r\n");
      out.write("                                    // Đảm bảo phân trang luôn hiển thị\r\n");
      out.write("                                    var wrapper = $(this).closest('.dataTables_wrapper');\r\n");
      out.write("                                    var paginate = wrapper.find('.dataTables_paginate');\r\n");
      out.write("                                    if (paginate.length) {\r\n");
      out.write("                                        paginate.css({\r\n");
      out.write("                                            'display': 'block',\r\n");
      out.write("                                            'visibility': 'visible',\r\n");
      out.write("                                            'opacity': '1'\r\n");
      out.write("                                        }).show();\r\n");
      out.write("                                        \r\n");
      out.write("                                        // Đảm bảo tất cả các nút phân trang đều hiển thị\r\n");
      out.write("                                        paginate.find('.paginate_button').each(function() {\r\n");
      out.write("                                            $(this).css({\r\n");
      out.write("                                                'display': 'inline-block',\r\n");
      out.write("                                                'visibility': 'visible'\r\n");
      out.write("                                            }).show();\r\n");
      out.write("                                        });\r\n");
      out.write("                                    }\r\n");
      out.write("                                },\r\n");
      out.write("                                \"initComplete\": function(settings, json) {\r\n");
      out.write("                                    // Sau khi khởi tạo xong, đảm bảo phân trang hiển thị\r\n");
      out.write("                                    var wrapper = $(this).closest('.dataTables_wrapper');\r\n");
      out.write("                                    var paginate = wrapper.find('.dataTables_paginate');\r\n");
      out.write("                                    if (paginate.length) {\r\n");
      out.write("                                        paginate.removeAttr('style');\r\n");
      out.write("                                        paginate.css({\r\n");
      out.write("                                            'display': 'block',\r\n");
      out.write("                                            'visibility': 'visible',\r\n");
      out.write("                                            'opacity': '1'\r\n");
      out.write("                                        }).show();\r\n");
      out.write("                                        \r\n");
      out.write("                                        // Đảm bảo tất cả các nút phân trang đều hiển thị\r\n");
      out.write("                                        paginate.find('.paginate_button').each(function() {\r\n");
      out.write("                                            $(this).css({\r\n");
      out.write("                                                'display': 'inline-block',\r\n");
      out.write("                                                'visibility': 'visible'\r\n");
      out.write("                                            }).show();\r\n");
      out.write("                                        });\r\n");
      out.write("                                    }\r\n");
      out.write("                                    \r\n");
      out.write("                                    // Force show pagination after a short delay\r\n");
      out.write("                                    setTimeout(function() {\r\n");
      out.write("                                        var paginate = wrapper.find('.dataTables_paginate');\r\n");
      out.write("                                        if (paginate.length) {\r\n");
      out.write("                                            paginate.removeAttr('style');\r\n");
      out.write("                                            paginate.css({\r\n");
      out.write("                                                'display': 'block',\r\n");
      out.write("                                                'visibility': 'visible',\r\n");
      out.write("                                                'opacity': '1'\r\n");
      out.write("                                            }).show();\r\n");
      out.write("                                            \r\n");
      out.write("                                            // Force show all pagination buttons\r\n");
      out.write("                                            paginate.find('.paginate_button').each(function() {\r\n");
      out.write("                                                $(this).css({\r\n");
      out.write("                                                    'display': 'inline-block',\r\n");
      out.write("                                                    'visibility': 'visible'\r\n");
      out.write("                                                }).show();\r\n");
      out.write("                                            });\r\n");
      out.write("                                        }\r\n");
      out.write("                                    }, 100);\r\n");
      out.write("                                }\r\n");
      out.write("                            });\r\n");
      out.write("                            console.log('DataTable initialized successfully');\r\n");
      out.write("                        } catch(e) {\r\n");
      out.write("                            console.error('Error initializing DataTable:', e);\r\n");
      out.write("                        }\r\n");
      out.write("                    } else {\r\n");
      out.write("                        // If already initialized, just get the instance\r\n");
      out.write("                        try {\r\n");
      out.write("                            dataTable = $('#feedbacksTable').DataTable();\r\n");
      out.write("                        } catch(e) {\r\n");
      out.write("                            console.error('Error getting DataTable instance:', e);\r\n");
      out.write("                        }\r\n");
      out.write("                    }\r\n");
      out.write("                }, 100);\r\n");
      out.write("            } else {\r\n");
      out.write("                console.log('No feedbacks to display, skipping DataTable initialization');\r\n");
      out.write("            }\r\n");
      out.write("            \r\n");
      out.write("            // Attach event handlers - always attach, regardless of DataTables status\r\n");
      out.write("            $(document).off('click', '.view-feedback-btn').on('click', '.view-feedback-btn', function(e) {\r\n");
      out.write("                e.preventDefault();\r\n");
      out.write("                e.stopPropagation();\r\n");
      out.write("                var feedbackId = $(this).data('feedback-id');\r\n");
      out.write("                console.log('View feedback clicked, ID:', feedbackId);\r\n");
      out.write("                if (feedbackId) {\r\n");
      out.write("                    viewFeedbackDetail(feedbackId);\r\n");
      out.write("                } else {\r\n");
      out.write("                    console.error('No feedback ID found');\r\n");
      out.write("                    alert('Không tìm thấy ID feedback');\r\n");
      out.write("                }\r\n");
      out.write("            });\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        \r\n");
      out.write("        function viewFeedbackDetail(feedbackId) {\r\n");
      out.write("            console.log('viewFeedbackDetail called with ID:', feedbackId);\r\n");
      out.write("            console.log('All feedbacks:', allFeedbacks);\r\n");
      out.write("            \r\n");
      out.write("            // Find feedback in array - try both string and number comparison\r\n");
      out.write("            var feedback = allFeedbacks.find(function(fb) {\r\n");
      out.write("                return fb.id == feedbackId || fb.id == parseInt(feedbackId);\r\n");
      out.write("            });\r\n");
      out.write("            \r\n");
      out.write("            if (!feedback) {\r\n");
      out.write("                console.error('Feedback not found. ID:', feedbackId, 'Available IDs:', allFeedbacks.map(f => f.id));\r\n");
      out.write("                alert('Không tìm thấy feedback với ID: ' + feedbackId);\r\n");
      out.write("                return;\r\n");
      out.write("            }\r\n");
      out.write("            \r\n");
      out.write("            console.log('Found feedback:', feedback);\r\n");
      out.write("            \r\n");
      out.write("            // Build detail HTML\r\n");
      out.write("            var html = '';\r\n");
      out.write("            \r\n");
      out.write("            // Feedback Information\r\n");
      out.write("            html += '<div class=\"detail-section\">';\r\n");
      out.write("            html += '<h4><i class=\"fa fa-star\"></i> Thông tin Feedback</h4>';\r\n");
      out.write("            html += '<div class=\"row\">';\r\n");
      out.write("            html += '<div class=\"col-md-6\">';\r\n");
      out.write("            html += '<p><strong>ID Feedback:</strong> ' + escapeHtml(feedback.id || 'N/A') + '</p>';\r\n");
      out.write("            html += '<p><strong>Đánh giá:</strong> <span class=\"rating-stars\">' + escapeHtml(feedback.ratingStars || '') + '</span> ' + escapeHtml(feedback.ratingDisplay || '') + '</p>';\r\n");
      out.write("            html += '<p><strong>Ngày feedback:</strong> ' + formatDate(feedback.createdAt) + '</p>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '<div class=\"col-md-6\">';\r\n");
      out.write("            if (feedback.updatedAt && feedback.updatedAt !== feedback.createdAt) {\r\n");
      out.write("                html += '<p><strong>Ngày cập nhật:</strong> ' + formatDate(feedback.updatedAt) + '</p>';\r\n");
      out.write("            }\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            if (feedback.comment) {\r\n");
      out.write("                html += '<div style=\"margin-top: 15px;\">';\r\n");
      out.write("                html += '<strong>Nhận xét:</strong>';\r\n");
      out.write("                html += '<p style=\"white-space: pre-wrap; word-wrap: break-word; background: #f9f9f9; padding: 10px; border-radius: 3px; margin-top: 5px;\">';\r\n");
      out.write("                html += escapeHtml(feedback.comment);\r\n");
      out.write("                html += '</p>';\r\n");
      out.write("                html += '</div>';\r\n");
      out.write("            }\r\n");
      out.write("            if (feedback.imagePath) {\r\n");
      out.write("                html += '<div style=\"margin-top: 15px;\">';\r\n");
      out.write("                html += '<strong>Ảnh minh chứng:</strong><br>';\r\n");
      out.write("                html += '<img src=\"' + ctx + '/' + escapeHtml(feedback.imagePath) + '\" class=\"feedback-image\" alt=\"Feedback image\" onclick=\"showImageModal(\\'' + ctx + '/' + escapeHtml(feedback.imagePath) + '\\')\">';\r\n");
      out.write("                html += '</div>';\r\n");
      out.write("            }\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            \r\n");
      out.write("            // Ticket Information\r\n");
      out.write("            html += '<div class=\"detail-section\">';\r\n");
      out.write("            html += '<h4><i class=\"fa fa-ticket\"></i> Thông tin Ticket</h4>';\r\n");
      out.write("            html += '<div class=\"row\">';\r\n");
      out.write("            html += '<div class=\"col-md-6\">';\r\n");
      out.write("            html += '<p><strong>Mã ticket:</strong> ' + escapeHtml(feedback.ticketNumber || 'N/A') + '</p>';\r\n");
      out.write("            html += '<p><strong>Tiêu đề:</strong> ' + escapeHtml(feedback.ticketSubject || 'N/A') + '</p>';\r\n");
      out.write("            html += '<p><strong>Danh mục:</strong> ' + getCategoryBadge(feedback.ticketCategory) + '</p>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '<div class=\"col-md-6\">';\r\n");
      out.write("            html += '<p><strong>Trạng thái:</strong> ' + getStatusBadge(feedback.ticketStatus) + '</p>';\r\n");
      out.write("            if (feedback.ticketPriority) {\r\n");
      out.write("                html += '<p><strong>Độ ưu tiên:</strong> ' + getPriorityBadge(feedback.ticketPriority) + '</p>';\r\n");
      out.write("            }\r\n");
      out.write("            if (feedback.ticketCreatedAt) {\r\n");
      out.write("                html += '<p><strong>Ngày tạo ticket:</strong> ' + formatDate(feedback.ticketCreatedAt) + '</p>';\r\n");
      out.write("            }\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            if (feedback.ticketDescription) {\r\n");
      out.write("                html += '<div style=\"margin-top: 15px;\">';\r\n");
      out.write("                html += '<strong>Mô tả:</strong>';\r\n");
      out.write("                html += '<p style=\"white-space: pre-wrap; word-wrap: break-word; background: #f9f9f9; padding: 10px; border-radius: 3px; margin-top: 5px;\">';\r\n");
      out.write("                html += escapeHtml(feedback.ticketDescription);\r\n");
      out.write("                html += '</p>';\r\n");
      out.write("                html += '</div>';\r\n");
      out.write("            }\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            \r\n");
      out.write("            // Customer Information\r\n");
      out.write("            html += '<div class=\"detail-section\">';\r\n");
      out.write("            html += '<h4><i class=\"fa fa-user\"></i> Thông tin Khách Hàng</h4>';\r\n");
      out.write("            html += '<div class=\"row\">';\r\n");
      out.write("            html += '<div class=\"col-md-6\">';\r\n");
      out.write("            html += '<p><strong>Tên:</strong> ' + escapeHtml(feedback.customerName || 'N/A') + '</p>';\r\n");
      out.write("            if (feedback.customerCompany) {\r\n");
      out.write("                html += '<p><strong>Công ty:</strong> ' + escapeHtml(feedback.customerCompany) + '</p>';\r\n");
      out.write("            }\r\n");
      out.write("            html += '<p><strong>Email:</strong> ' + escapeHtml(feedback.customerEmail || 'N/A') + '</p>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '<div class=\"col-md-6\">';\r\n");
      out.write("            if (feedback.customerPhone) {\r\n");
      out.write("                html += '<p><strong>Điện thoại:</strong> ' + escapeHtml(feedback.customerPhone) + '</p>';\r\n");
      out.write("            }\r\n");
      out.write("            if (feedback.customerAddress) {\r\n");
      out.write("                html += '<p><strong>Địa chỉ:</strong> ' + escapeHtml(feedback.customerAddress) + '</p>';\r\n");
      out.write("            }\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            \r\n");
      out.write("            $('#feedbackDetailContent').html(html);\r\n");
      out.write("            $('#viewFeedbackModal').modal('show');\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        function showImageModal(imageSrc) {\r\n");
      out.write("            $('#modalImage').attr('src', imageSrc);\r\n");
      out.write("            $('#imageModal').modal('show');\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        function formatDate(dateStr) {\r\n");
      out.write("            if (!dateStr) return 'N/A';\r\n");
      out.write("            try {\r\n");
      out.write("                var date = new Date(dateStr);\r\n");
      out.write("                return date.toLocaleDateString('vi-VN') + ' ' + date.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });\r\n");
      out.write("            } catch(e) {\r\n");
      out.write("                return dateStr;\r\n");
      out.write("            }\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        function escapeHtml(text) {\r\n");
      out.write("            if (!text) return '';\r\n");
      out.write("            var map = {\r\n");
      out.write("                '&': '&amp;',\r\n");
      out.write("                '<': '&lt;',\r\n");
      out.write("                '>': '&gt;',\r\n");
      out.write("                '\"': '&quot;',\r\n");
      out.write("                \"'\": '&#039;'\r\n");
      out.write("            };\r\n");
      out.write("            return text.toString().replace(/[&<>\"']/g, function(m) { return map[m]; });\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        function getCategoryBadge(category) {\r\n");
      out.write("            var badges = {\r\n");
      out.write("                'technical': '<span class=\"label label-info\">Kỹ thuật</span>',\r\n");
      out.write("                'billing': '<span class=\"label label-success\">Thanh toán</span>',\r\n");
      out.write("                'general': '<span class=\"label label-default\">Chung</span>',\r\n");
      out.write("                'complaint': '<span class=\"label label-danger\">Khiếu nại</span>'\r\n");
      out.write("            };\r\n");
      out.write("            return badges[category] || '<span class=\"label label-default\">' + (category || 'N/A') + '</span>';\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        function getStatusBadge(status) {\r\n");
      out.write("            var badges = {\r\n");
      out.write("                'open': '<span class=\"label label-primary\">Đang chờ</span>',\r\n");
      out.write("                'pending': '<span class=\"label label-primary\">Đang chờ</span>',\r\n");
      out.write("                'in_progress': '<span class=\"label label-warning\">Đang xử lý</span>',\r\n");
      out.write("                'resolved': '<span class=\"label label-success\">Hoàn thành</span>',\r\n");
      out.write("                'closed': '<span class=\"label label-default\">Đã đóng</span>',\r\n");
      out.write("                'cancelled': '<span class=\"label label-danger\">Đã hủy</span>'\r\n");
      out.write("            };\r\n");
      out.write("            return badges[status] || '<span class=\"label label-default\">' + (status || 'N/A') + '</span>';\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        function getPriorityBadge(priority) {\r\n");
      out.write("            var badges = {\r\n");
      out.write("                'urgent': '<span class=\"label label-danger\">Khẩn cấp</span>',\r\n");
      out.write("                'high': '<span class=\"label label-danger\">Cao</span>',\r\n");
      out.write("                'medium': '<span class=\"label label-warning\">Trung bình</span>',\r\n");
      out.write("                'low': '<span class=\"label label-info\">Thấp</span>'\r\n");
      out.write("            };\r\n");
      out.write("            return badges[priority] || '<span class=\"label label-default\">' + (priority || 'N/A') + '</span>';\r\n");
      out.write("        }\r\n");
      out.write("    </script>\r\n");
      out.write("</body>\r\n");
      out.write("</html>\r\n");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
