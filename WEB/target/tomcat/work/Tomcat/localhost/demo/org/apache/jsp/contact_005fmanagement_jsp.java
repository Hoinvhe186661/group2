/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.47
 * Generated at: 2025-11-14 10:30:07 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import java.util.Set;

public final class contact_005fmanagement_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

private static org.apache.jasper.runtime.ProtectedFunctionMapper _jspx_fnmap_0;
private static org.apache.jasper.runtime.ProtectedFunctionMapper _jspx_fnmap_1;

static {
  _jspx_fnmap_0= org.apache.jasper.runtime.ProtectedFunctionMapper.getMapForFunction("fn:length", org.apache.taglibs.standard.functions.Functions.class, "length", new Class[] {java.lang.Object.class});
  _jspx_fnmap_1= org.apache.jasper.runtime.ProtectedFunctionMapper.getMapForFunction("fn:substring", org.apache.taglibs.standard.functions.Functions.class, "substring", new Class[] {java.lang.String.class, int.class, int.class});
}

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private org.apache.jasper.runtime.TagHandlerPool _005fjspx_005ftagPool_005fc_005fchoose;
  private org.apache.jasper.runtime.TagHandlerPool _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest;
  private org.apache.jasper.runtime.TagHandlerPool _005fjspx_005ftagPool_005fc_005fforEach_0026_005fvar_005fitems;
  private org.apache.jasper.runtime.TagHandlerPool _005fjspx_005ftagPool_005fc_005fotherwise;
  private org.apache.jasper.runtime.TagHandlerPool _005fjspx_005ftagPool_005ffmt_005fformatDate_0026_005fvalue_005fpattern_005fnobody;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _005fjspx_005ftagPool_005fc_005fchoose = org.apache.jasper.runtime.TagHandlerPool.getTagHandlerPool(getServletConfig());
    _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest = org.apache.jasper.runtime.TagHandlerPool.getTagHandlerPool(getServletConfig());
    _005fjspx_005ftagPool_005fc_005fforEach_0026_005fvar_005fitems = org.apache.jasper.runtime.TagHandlerPool.getTagHandlerPool(getServletConfig());
    _005fjspx_005ftagPool_005fc_005fotherwise = org.apache.jasper.runtime.TagHandlerPool.getTagHandlerPool(getServletConfig());
    _005fjspx_005ftagPool_005ffmt_005fformatDate_0026_005fvalue_005fpattern_005fnobody = org.apache.jasper.runtime.TagHandlerPool.getTagHandlerPool(getServletConfig());
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
    _005fjspx_005ftagPool_005fc_005fchoose.release();
    _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.release();
    _005fjspx_005ftagPool_005fc_005fforEach_0026_005fvar_005fitems.release();
    _005fjspx_005ftagPool_005fc_005fotherwise.release();
    _005fjspx_005ftagPool_005ffmt_005fformatDate_0026_005fvalue_005fpattern_005fnobody.release();
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("\r\n");

    // Kiểm tra đăng nhập
    String username = (String) session.getAttribute("username");
    Boolean isLoggedIn = (Boolean) session.getAttribute("isLoggedIn");
    String userRole = (String) session.getAttribute("userRole");
    
    if (username == null || isLoggedIn == null || !isLoggedIn) {
        response.sendRedirect(request.getContextPath() + "/login.jsp");
        return;
    }
    
    // Kiểm tra quyền: chỉ người có quyền manage_contacts mới truy cập được
    @SuppressWarnings("unchecked")
    Set<String> userPermissions = (Set<String>) session.getAttribute("userPermissions");
    if (userPermissions == null || !userPermissions.contains("manage_contacts")) {
        response.sendRedirect(request.getContextPath() + "/error/403.jsp");
        return;
    }

      out.write("\r\n");
      out.write("<!DOCTYPE html>\r\n");
      out.write("<html>\r\n");
      out.write("<head>\r\n");
      out.write("    <meta charset=\"UTF-8\">\r\n");
      out.write("    <title>Quản Lý Liên Hệ | Bảng Điều Khiển</title>\r\n");
      out.write("    <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>\r\n");
      out.write("    \r\n");
      out.write("    <!-- bootstrap 3.0.2 -->\r\n");
      out.write("    <link href=\"css/bootstrap.min.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n");
      out.write("    <!-- font Awesome -->\r\n");
      out.write("    <link href=\"css/font-awesome.min.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n");
      out.write("    <!-- Ionicons -->\r\n");
      out.write("    <link href=\"css/ionicons.min.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n");
      out.write("    <!-- DataTables -->\r\n");
      out.write("    <link href=\"css/datatables/dataTables.bootstrap.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n");
      out.write("    <!-- Theme style -->\r\n");
      out.write("    <link href=\"css/style.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n");
      out.write("\r\n");
      out.write("    <style>\r\n");
      out.write("        .filter-section {\r\n");
      out.write("            background: #f9f9f9;\r\n");
      out.write("            padding: 15px;\r\n");
      out.write("            margin-bottom: 20px;\r\n");
      out.write("            border-radius: 5px;\r\n");
      out.write("        }\r\n");
      out.write("        .message-status-new { border-left: 4px solid #d9534f; }\r\n");
      out.write("        .message-status-replied { border-left: 4px solid #5cb85c; }\r\n");
      out.write("        .message-status-read { border-left: 4px solid #5bc0de; }\r\n");
      out.write("        .message-status-converted { border-left: 4px solid #9c27b0; }\r\n");
      out.write("        \r\n");
      out.write("        .message-detail {\r\n");
      out.write("            white-space: pre-wrap;\r\n");
      out.write("            word-wrap: break-word;\r\n");
      out.write("            font-family: 'Segoe UI', Tahoma, Arial, sans-serif;\r\n");
      out.write("            line-height: 1.6;\r\n");
      out.write("        }\r\n");
      out.write("    </style>\r\n");
      out.write("</head>\r\n");
      out.write("<body class=\"skin-black\">\r\n");
      out.write("    <!-- header logo: style can be found in header.less -->\r\n");
      out.write("    <header class=\"header\">\r\n");
      out.write("        <a href=\"contact-management\" class=\"logo\">\r\n");
      out.write("            Quản Lý Liên Hệ\r\n");
      out.write("        </a>\r\n");
      out.write("        <!-- Header Navbar: style can be found in header.less -->\r\n");
      out.write("        <nav class=\"navbar navbar-static-top\" role=\"navigation\">\r\n");
      out.write("            <!-- Sidebar toggle button-->\r\n");
      out.write("            <a href=\"#\" class=\"navbar-btn sidebar-toggle\" data-toggle=\"offcanvas\" role=\"button\">\r\n");
      out.write("                <span class=\"sr-only\">Toggle navigation</span>\r\n");
      out.write("                <span class=\"icon-bar\"></span>\r\n");
      out.write("                <span class=\"icon-bar\"></span>\r\n");
      out.write("                <span class=\"icon-bar\"></span>\r\n");
      out.write("            </a>\r\n");
      out.write("            <div class=\"navbar-right\">\r\n");
      out.write("                <ul class=\"nav navbar-nav\">\r\n");
      out.write("                    <!-- User Account: style can be found in dropdown.less -->\r\n");
      out.write("                    <li class=\"dropdown user user-menu\">\r\n");
      out.write("                        <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">\r\n");
      out.write("                            <i class=\"fa fa-user\"></i>\r\n");
      out.write("                            <span>");
      out.print( username );
      out.write(" <i class=\"caret\"></i></span>\r\n");
      out.write("                        </a>\r\n");
      out.write("                        <ul class=\"dropdown-menu dropdown-custom dropdown-menu-right\">\r\n");
      out.write("                            <li class=\"dropdown-header text-center\">Tài khoản</li>\r\n");
      out.write("                            <li>\r\n");
      out.write("                                <a href=\"profile.jsp\">\r\n");
      out.write("                                <i class=\"fa fa-user fa-fw pull-right\"></i>\r\n");
      out.write("                                    Hồ sơ\r\n");
      out.write("                                </a>\r\n");
      out.write("                                <a href=\"settings.jsp\">\r\n");
      out.write("                                <i class=\"fa fa-cog fa-fw pull-right\"></i>\r\n");
      out.write("                                    Cài đặt cá nhân\r\n");
      out.write("                                </a>\r\n");
      out.write("                            </li>\r\n");
      out.write("                            <li class=\"divider\"></li>\r\n");
      out.write("                            <li>\r\n");
      out.write("                                <a href=\"logout\"><i class=\"fa fa-ban fa-fw pull-right\"></i> Đăng xuất</a>\r\n");
      out.write("                            </li>\r\n");
      out.write("                        </ul>\r\n");
      out.write("                    </li>\r\n");
      out.write("                </ul>\r\n");
      out.write("            </div>\r\n");
      out.write("        </nav>\r\n");
      out.write("    </header>\r\n");
      out.write("    \r\n");
      out.write("    <div class=\"wrapper row-offcanvas row-offcanvas-left\">\r\n");
      out.write("        <!-- Left side column. contains the logo and sidebar -->\r\n");
      out.write("\t\t");
      org.apache.jasper.runtime.JspRuntimeLibrary.include(request, response, "partials/sidebar.jsp", out, false);
      out.write("\r\n");
      out.write("\r\n");
      out.write("        <aside class=\"right-side\">\r\n");
      out.write("            <!-- Main content -->\r\n");
      out.write("            <section class=\"content\">\r\n");
      out.write("                <!-- Filter Section -->\r\n");
      out.write("                <div class=\"filter-section\">\r\n");
      out.write("                    <form method=\"GET\" action=\"contact-management\">\r\n");
      out.write("                        <div class=\"row\">\r\n");
      out.write("                            <div class=\"col-md-2\">\r\n");
      out.write("                                <label>Trạng thái:</label>\r\n");
      out.write("                                <select name=\"status\" class=\"form-control\">\r\n");
      out.write("                                    <option value=\"\">Tất cả</option>\r\n");
      out.write("                                    <option value=\"new\" ");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${param.status == 'new' ? 'selected' : ''}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write(">Mới</option>\r\n");
      out.write("                                    <option value=\"read\" ");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${param.status == 'read' ? 'selected' : ''}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write(">Đã đọc</option>\r\n");
      out.write("                                    <option value=\"replied\" ");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${param.status == 'replied' ? 'selected' : ''}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write(">Đã liên hệ</option>\r\n");
      out.write("                                    <option value=\"converted\" ");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${param.status == 'converted' ? 'selected' : ''}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write(">Đã chuyển đổi</option>\r\n");
      out.write("                                </select>\r\n");
      out.write("                            </div>\r\n");
      out.write("                            <div class=\"col-md-3\">\r\n");
      out.write("                                <label>Tìm kiếm:</label>\r\n");
      out.write("                                <input type=\"text\" class=\"form-control\" name=\"q\" placeholder=\"ID, tên, email, SĐT, tin nhắn\" value=\"");
      out.print( request.getParameter("q") != null ? request.getParameter("q") : "" );
      out.write("\">\r\n");
      out.write("                            </div>\r\n");
      out.write("                            <div class=\"col-md-2\">\r\n");
      out.write("                                <label>Từ ngày:</label>\r\n");
      out.write("                                <input type=\"date\" name=\"startDate\" class=\"form-control\" value=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${param.startDate}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("\">\r\n");
      out.write("                            </div>\r\n");
      out.write("                            <div class=\"col-md-2\">\r\n");
      out.write("                                <label>Đến ngày:</label>\r\n");
      out.write("                                <input type=\"date\" name=\"endDate\" class=\"form-control\" value=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${param.endDate}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("\">\r\n");
      out.write("                            </div>\r\n");
      out.write("                            <div class=\"col-md-1\">\r\n");
      out.write("                                <label>Hiển thị:</label>\r\n");
      out.write("                                ");

                                    int _sz = 10;
                                    try { 
                                        String sp = request.getParameter("size"); 
                                        if (sp != null) _sz = Integer.parseInt(sp); 
                                    } catch (Exception ignored) {}
                                
      out.write("\r\n");
      out.write("                                <select name=\"size\" class=\"form-control\" onchange=\"this.form.submit()\">\r\n");
      out.write("                                    <option value=\"5\" ");
      out.print( _sz == 5 ? "selected" : "" );
      out.write(">5</option>\r\n");
      out.write("                                    <option value=\"10\" ");
      out.print( _sz == 10 ? "selected" : "" );
      out.write(">10</option>\r\n");
      out.write("                                    <option value=\"25\" ");
      out.print( _sz == 25 ? "selected" : "" );
      out.write(">25</option>\r\n");
      out.write("                                    <option value=\"50\" ");
      out.print( _sz == 50 ? "selected" : "" );
      out.write(">50</option>\r\n");
      out.write("                                    <option value=\"100\" ");
      out.print( _sz == 100 ? "selected" : "" );
      out.write(">100</option>\r\n");
      out.write("                                </select>\r\n");
      out.write("                            </div>\r\n");
      out.write("                            <div class=\"col-md-2\">\r\n");
      out.write("                                <label>&nbsp;</label><br>\r\n");
      out.write("                                <button type=\"submit\" class=\"btn btn-primary\">\r\n");
      out.write("                                    <i class=\"fa fa-filter\"></i> Lọc\r\n");
      out.write("                                </button>\r\n");
      out.write("                                <a href=\"contact-management\" class=\"btn btn-default\">\r\n");
      out.write("                                    <i class=\"fa fa-refresh\"></i> Xóa bộ lọc\r\n");
      out.write("                                </a>\r\n");
      out.write("                            </div>\r\n");
      out.write("                        </div>\r\n");
      out.write("                        <div class=\"row\" style=\"margin-top: 5px;\">\r\n");
      out.write("                            <div class=\"col-md-12 text-right\">\r\n");
      out.write("                                <span class=\"text-muted\">Tổng số: <strong>");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${totalMessages}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</strong> tin nhắn</span>\r\n");
      out.write("                            </div>\r\n");
      out.write("                        </div>\r\n");
      out.write("                        <input type=\"hidden\" name=\"page\" value=\"1\">\r\n");
      out.write("                    </form>\r\n");
      out.write("                </div>\r\n");
      out.write("\r\n");
      out.write("                <!-- Messages Table -->\r\n");
      out.write("                <div class=\"row\">\r\n");
      out.write("                    <div class=\"col-md-12\">\r\n");
      out.write("                        <section class=\"panel\">\r\n");
      out.write("                            <header class=\"panel-heading\">\r\n");
      out.write("                                <h3>Danh sách liên hệ</h3>\r\n");
      out.write("                            </header>\r\n");
      out.write("                            <div class=\"panel-body\">\r\n");
      out.write("                                <div class=\"table-responsive\">\r\n");
      out.write("                                    <table id=\"messagesTable\" class=\"table table-striped table-bordered table-hover\">\r\n");
      out.write("                                        <thead>\r\n");
      out.write("                                            <tr>\r\n");
      out.write("                                                <th class=\"sortable\" data-sort=\"id\" style=\"cursor: pointer;\">\r\n");
      out.write("                                                    ID <i class=\"fa fa-sort sort-icon\" style=\"color: #ccc; margin-left: 5px;\"></i>\r\n");
      out.write("                                                </th>\r\n");
      out.write("                                                <th class=\"sortable\" data-sort=\"full_name\" style=\"cursor: pointer;\">\r\n");
      out.write("                                                    Họ tên <i class=\"fa fa-sort sort-icon\" style=\"color: #ccc; margin-left: 5px;\"></i>\r\n");
      out.write("                                                </th>\r\n");
      out.write("                                                <th class=\"sortable\" data-sort=\"email\" style=\"cursor: pointer;\">\r\n");
      out.write("                                                    Email <i class=\"fa fa-sort sort-icon\" style=\"color: #ccc; margin-left: 5px;\"></i>\r\n");
      out.write("                                                </th>\r\n");
      out.write("                                                <th class=\"sortable\" data-sort=\"phone\" style=\"cursor: pointer;\">\r\n");
      out.write("                                                    Số điện thoại <i class=\"fa fa-sort sort-icon\" style=\"color: #ccc; margin-left: 5px;\"></i>\r\n");
      out.write("                                                </th>\r\n");
      out.write("                                                <th class=\"sortable\" data-sort=\"message\" style=\"cursor: pointer;\">\r\n");
      out.write("                                                    Tin nhắn <i class=\"fa fa-sort sort-icon\" style=\"color: #ccc; margin-left: 5px;\"></i>\r\n");
      out.write("                                                </th>\r\n");
      out.write("                                                <th class=\"sortable\" data-sort=\"status\" style=\"cursor: pointer;\">\r\n");
      out.write("                                                    Trạng thái <i class=\"fa fa-sort sort-icon\" style=\"color: #ccc; margin-left: 5px;\"></i>\r\n");
      out.write("                                                </th>\r\n");
      out.write("                                                <th class=\"sortable\" data-sort=\"created_at\" style=\"cursor: pointer;\">\r\n");
      out.write("                                                    Ngày gửi <i class=\"fa fa-sort sort-icon\" style=\"color: #ccc; margin-left: 5px;\"></i>\r\n");
      out.write("                                                </th>\r\n");
      out.write("                                                <th class=\"sortable\" data-sort=\"replied_at\" style=\"cursor: pointer;\">\r\n");
      out.write("                                                    Ngày phản hồi <i class=\"fa fa-sort sort-icon\" style=\"color: #ccc; margin-left: 5px;\"></i>\r\n");
      out.write("                                                </th>\r\n");
      out.write("                                                <th>Thao tác</th>\r\n");
      out.write("                                            </tr>\r\n");
      out.write("                                        </thead>\r\n");
      out.write("                                        <tbody>\r\n");
      out.write("                                            ");
      if (_jspx_meth_c_005fchoose_005f0(_jspx_page_context))
        return;
      out.write("\r\n");
      out.write("                                        </tbody>\r\n");
      out.write("                                    </table>\r\n");
      out.write("                                </div>\r\n");
      out.write("                                \r\n");
      out.write("                                <!-- Phân trang -->\r\n");
      out.write("                                <div class=\"row\" style=\"margin-top: 10px;\">\r\n");
      out.write("                                    <div class=\"col-md-6\">\r\n");
      out.write("                                        <div class=\"text-muted\" style=\"line-height: 34px;\">\r\n");
      out.write("                                            ");

                                                int _currentPage = (Integer) request.getAttribute("currentPage");
                                                int _pageSize = (Integer) request.getAttribute("pageSize");
                                                int _total = (Integer) request.getAttribute("totalMessages");
                                                int _startIdx = (_currentPage - 1) * _pageSize + 1;
                                                int _endIdx = Math.min(_currentPage * _pageSize, _total);
                                                if (_total == 0) { 
                                                    _startIdx = 0; 
                                                    _endIdx = 0; 
                                                }
                                            
      out.write("\r\n");
      out.write("                                            Hiển thị ");
      out.print( _startIdx );
      out.write(' ');
      out.write('-');
      out.write(' ');
      out.print( _endIdx );
      out.write(" của ");
      out.print( _total );
      out.write(" tin nhắn\r\n");
      out.write("                                        </div>\r\n");
      out.write("                                    </div>\r\n");
      out.write("                                    <div class=\"col-md-6\">\r\n");
      out.write("                                        <nav aria-label=\"Phân trang tin nhắn\" class=\"pull-right\">\r\n");
      out.write("                                            <ul class=\"pagination pagination-sm\" style=\"margin: 0;\">\r\n");
      out.write("                                                ");

                                                    // Xây base query giữ nguyên filter
                                                    java.util.List<String> _p = new java.util.ArrayList<String>();
                                                    try { 
                                                        String v = request.getParameter("status"); 
                                                        if (v != null && !v.isEmpty()) 
                                                            _p.add("status=" + java.net.URLEncoder.encode(v, "UTF-8")); 
                                                    } catch (Exception ignored) {}
                                                    try { 
                                                        String v = request.getParameter("q"); 
                                                        if (v != null && !v.isEmpty()) 
                                                            _p.add("q=" + java.net.URLEncoder.encode(v, "UTF-8")); 
                                                    } catch (Exception ignored) {}
                                                    try { 
                                                        String v = request.getParameter("startDate"); 
                                                        if (v != null && !v.isEmpty()) 
                                                            _p.add("startDate=" + java.net.URLEncoder.encode(v, "UTF-8")); 
                                                    } catch (Exception ignored) {}
                                                    try { 
                                                        String v = request.getParameter("endDate"); 
                                                        if (v != null && !v.isEmpty()) 
                                                            _p.add("endDate=" + java.net.URLEncoder.encode(v, "UTF-8")); 
                                                    } catch (Exception ignored) {}
                                                    _p.add("size=" + _pageSize);
                                                    String _base = "contact-management" + (_p.isEmpty() ? "" : ("?" + String.join("&", _p)));
                                                    
                                                    int _totalPages = (Integer) request.getAttribute("totalPages");
                                                    
                                                    // Nút prev
                                                    int _prev = Math.max(1, _currentPage - 1);
                                                
      out.write("\r\n");
      out.write("                                                <li class=\"");
      out.print( _currentPage == 1 ? "disabled" : "" );
      out.write("\">\r\n");
      out.write("                                                    <a href=\"");
      out.print( _base + "&page=" + _prev );
      out.write("\">&laquo;</a>\r\n");
      out.write("                                                </li>\r\n");
      out.write("                                                ");

                                                    int _s = Math.max(1, _currentPage - 2);
                                                    int _e = Math.min(_totalPages, _currentPage + 2);
                                                    if (_s > 1) {
                                                
      out.write("\r\n");
      out.write("                                                <li><a href=\"");
      out.print( _base + "&page=1" );
      out.write("\">1</a></li>\r\n");
      out.write("                                                ");
      out.print( (_s > 2) ? "<li class=\"disabled\"><span>...</span></li>" : "" );
      out.write("\r\n");
      out.write("                                                ");

                                                    }
                                                    for (int i = _s; i <= _e; i++) {
                                                
      out.write("\r\n");
      out.write("                                                <li class=\"");
      out.print( i == _currentPage ? "active" : "" );
      out.write("\">\r\n");
      out.write("                                                    <a href=\"");
      out.print( _base + "&page=" + i );
      out.write('"');
      out.write('>');
      out.print( i );
      out.write("</a>\r\n");
      out.write("                                                </li>\r\n");
      out.write("                                                ");

                                                    }
                                                    if (_e < _totalPages) {
                                                
      out.write("\r\n");
      out.write("                                                ");
      out.print( (_e < _totalPages - 1) ? "<li class=\"disabled\"><span>...</span></li>" : "" );
      out.write("\r\n");
      out.write("                                                <li><a href=\"");
      out.print( _base + "&page=" + _totalPages );
      out.write('"');
      out.write('>');
      out.print( _totalPages );
      out.write("</a></li>\r\n");
      out.write("                                                ");

                                                    }
                                                    int _next = Math.min(_totalPages, _currentPage + 1);
                                                
      out.write("\r\n");
      out.write("                                                <li class=\"");
      out.print( _currentPage == _totalPages ? "disabled" : "" );
      out.write("\">\r\n");
      out.write("                                                    <a href=\"");
      out.print( _base + "&page=" + _next );
      out.write("\">&raquo;</a>\r\n");
      out.write("                                                </li>\r\n");
      out.write("                                            </ul>\r\n");
      out.write("                                        </nav>\r\n");
      out.write("                                    </div>\r\n");
      out.write("                                </div>\r\n");
      out.write("                            </div>\r\n");
      out.write("                        </section>\r\n");
      out.write("                    </div>\r\n");
      out.write("                </div>\r\n");
      out.write("            </section><!-- /.content -->\r\n");
      out.write("            <div class=\"footer-main\">\r\n");
      out.write("                Copyright &copy Hệ thống hỗ trợ khách hàng - HL Generator, 2025\r\n");
      out.write("            </div>\r\n");
      out.write("        </aside><!-- /.right-side -->\r\n");
      out.write("    </div><!-- ./wrapper -->\r\n");
      out.write("\r\n");
      out.write("    <!-- Modal xem chi tiết tin nhắn -->\r\n");
      out.write("    <div class=\"modal fade\" id=\"viewMessageModal\" tabindex=\"-1\" role=\"dialog\">\r\n");
      out.write("        <div class=\"modal-dialog modal-lg\" role=\"document\">\r\n");
      out.write("            <div class=\"modal-content\">\r\n");
      out.write("                <div class=\"modal-header\">\r\n");
      out.write("                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n");
      out.write("                        <span aria-hidden=\"true\">&times;</span>\r\n");
      out.write("                    </button>\r\n");
      out.write("                    <h4 class=\"modal-title\">Chi tiết  liên hệ</h4>\r\n");
      out.write("                </div>\r\n");
      out.write("                <div class=\"modal-body\" id=\"messageDetailContent\">\r\n");
      out.write("                    <!-- Nội dung sẽ được load bằng JavaScript -->\r\n");
      out.write("                </div>\r\n");
      out.write("                <div class=\"modal-footer\">\r\n");
      out.write("                    <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Đóng</button>\r\n");
      out.write("                    <button type=\"button\" class=\"btn btn-primary\" id=\"btnMarkAsReplied\">Đánh dấu đã liên hệ</button>\r\n");
      out.write("                </div>\r\n");
      out.write("            </div>\r\n");
      out.write("        </div>\r\n");
      out.write("    </div>\r\n");
      out.write("\r\n");
      out.write("    <!-- Modal đánh dấu đã liên hệ -->\r\n");
      out.write("    <div class=\"modal fade\" id=\"markContactedModal\" tabindex=\"-1\" role=\"dialog\">\r\n");
      out.write("        <div class=\"modal-dialog modal-lg\" role=\"document\">\r\n");
      out.write("            <div class=\"modal-content\">\r\n");
      out.write("                <div class=\"modal-header\">\r\n");
      out.write("                    <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n");
      out.write("                        <span aria-hidden=\"true\">&times;</span>\r\n");
      out.write("                    </button>\r\n");
      out.write("                    <h4 class=\"modal-title\">Đánh dấu đã liên hệ</h4>\r\n");
      out.write("                </div>\r\n");
      out.write("                <div class=\"modal-body\" id=\"markContactedContent\">\r\n");
      out.write("                    <!-- Nội dung sẽ được load bằng JavaScript -->\r\n");
      out.write("                </div>\r\n");
      out.write("                <div class=\"modal-footer\">\r\n");
      out.write("                    <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Hủy</button>\r\n");
      out.write("                    <button type=\"button\" class=\"btn btn-primary\" id=\"btnConfirmContacted\">Xác nhận</button>\r\n");
      out.write("                </div>\r\n");
      out.write("            </div>\r\n");
      out.write("        </div>\r\n");
      out.write("    </div>\r\n");
      out.write("\r\n");
      out.write("    <!-- jQuery 2.0.2 -->\r\n");
      out.write("    <script src=\"http://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js\"></script>\r\n");
      out.write("    <script src=\"js/jquery.min.js\" type=\"text/javascript\"></script>\r\n");
      out.write("    <!-- jQuery UI 1.10.3 -->\r\n");
      out.write("    <script src=\"js/jquery-ui-1.10.3.min.js\" type=\"text/javascript\"></script>\r\n");
      out.write("    <!-- Bootstrap -->\r\n");
      out.write("    <script src=\"js/bootstrap.min.js\" type=\"text/javascript\"></script>\r\n");
      out.write("    <!-- DataTables -->\r\n");
      out.write("    <script src=\"js/plugins/datatables/jquery.dataTables.js\" type=\"text/javascript\"></script>\r\n");
      out.write("    <script src=\"js/plugins/datatables/dataTables.bootstrap.js\" type=\"text/javascript\"></script>\r\n");
      out.write("    <!-- Director App -->\r\n");
      out.write("    <script src=\"js/Director/app.js\" type=\"text/javascript\"></script>\r\n");
      out.write("\r\n");
      out.write("    <script>\r\n");
      out.write("        var currentMessageId = null;\r\n");
      out.write("        var shouldReloadAfterModalClose = false;\r\n");
      out.write("        var currentSortColumn = null;\r\n");
      out.write("        var currentSortOrder = 'asc';\r\n");
      out.write("        \r\n");
      out.write("        // Đảm bảo jQuery đã sẵn sàng\r\n");
      out.write("        $(document).ready(function() {\r\n");
      out.write("            console.log('Contact management script loaded');\r\n");
      out.write("            \r\n");
      out.write("            // Xử lý sắp xếp tĩnh\r\n");
      out.write("            $('.sortable').on('click', function() {\r\n");
      out.write("                var column = $(this).data('sort');\r\n");
      out.write("                var $icon = $(this).find('.sort-icon');\r\n");
      out.write("                \r\n");
      out.write("                if (currentSortColumn === column) {\r\n");
      out.write("                    currentSortOrder = currentSortOrder === 'asc' ? 'desc' : 'asc';\r\n");
      out.write("                } else {\r\n");
      out.write("                    currentSortColumn = column;\r\n");
      out.write("                    currentSortOrder = 'asc';\r\n");
      out.write("                }\r\n");
      out.write("                \r\n");
      out.write("                $('.sortable .sort-icon').removeClass('fa-sort-asc fa-sort-desc').addClass('fa-sort').css('color', '#ccc');\r\n");
      out.write("                \r\n");
      out.write("                if (currentSortOrder === 'asc') {\r\n");
      out.write("                    $icon.removeClass('fa-sort fa-sort-desc').addClass('fa-sort-asc').css('color', '#3498db');\r\n");
      out.write("                } else {\r\n");
      out.write("                    $icon.removeClass('fa-sort fa-sort-asc').addClass('fa-sort-desc').css('color', '#3498db');\r\n");
      out.write("                }\r\n");
      out.write("                \r\n");
      out.write("                sortMessagesTable(column, currentSortOrder);\r\n");
      out.write("            });\r\n");
      out.write("            \r\n");
      out.write("            // Xử lý click button xem chi tiết\r\n");
      out.write("            $(document).on('click', '.view-message-btn', function(e) {\r\n");
      out.write("                e.preventDefault();\r\n");
      out.write("                e.stopPropagation();\r\n");
      out.write("                console.log('View button clicked');\r\n");
      out.write("                var $btn = $(this);\r\n");
      out.write("                var messageId = $btn.data('message-id');\r\n");
      out.write("                console.log('Message ID:', messageId, 'Button:', $btn);\r\n");
      out.write("                if (messageId) {\r\n");
      out.write("                    viewMessage(messageId, $btn);\r\n");
      out.write("                } else {\r\n");
      out.write("                    console.error('Message ID not found');\r\n");
      out.write("                    alert('Không tìm thấy ID tin nhắn');\r\n");
      out.write("                }\r\n");
      out.write("                return false;\r\n");
      out.write("            });\r\n");
      out.write("            \r\n");
      out.write("            // Xử lý click button đánh dấu đã đọc\r\n");
      out.write("            $(document).on('click', '.mark-read-btn', function(e) {\r\n");
      out.write("                e.preventDefault();\r\n");
      out.write("                e.stopPropagation();\r\n");
      out.write("                var messageId = $(this).data('message-id');\r\n");
      out.write("                updateStatus(messageId, 'read');\r\n");
      out.write("                return false;\r\n");
      out.write("            });\r\n");
      out.write("            \r\n");
      out.write("            // Xử lý click button đánh dấu đã liên hệ\r\n");
      out.write("            $(document).on('click', '.mark-replied-btn', function(e) {\r\n");
      out.write("                e.preventDefault();\r\n");
      out.write("                e.stopPropagation();\r\n");
      out.write("                var messageId = $(this).data('message-id');\r\n");
      out.write("                showMarkContactedModal(messageId);\r\n");
      out.write("                return false;\r\n");
      out.write("            });\r\n");
      out.write("            \r\n");
      out.write("            // Xác nhận đánh dấu đã liên hệ - sử dụng event delegation\r\n");
      out.write("            $(document).on('click', '#btnConfirmContacted', function(e) {\r\n");
      out.write("                e.preventDefault();\r\n");
      out.write("                e.stopPropagation();\r\n");
      out.write("                console.log('Confirm button clicked');\r\n");
      out.write("                \r\n");
      out.write("                var contactMethod = $('#contactMethod').val();\r\n");
      out.write("                var customerType = $('#customerType').val();\r\n");
      out.write("                var address = $('#address').val();\r\n");
      out.write("                var companyName = $('#companyName').val();\r\n");
      out.write("                var taxCode = $('#taxCode').val();\r\n");
      out.write("                var contactContent = $('#contactContent').val();\r\n");
      out.write("                \r\n");
      out.write("                // Validation: Kiểm tra phương thức liên hệ\r\n");
      out.write("                if (!contactMethod || contactMethod.trim() === '') {\r\n");
      out.write("                    alert('Vui lòng chọn phương thức liên hệ!');\r\n");
      out.write("                    return false;\r\n");
      out.write("                }\r\n");
      out.write("                \r\n");
      out.write("                // Nếu chọn \"Khác\", lấy giá trị từ input\r\n");
      out.write("                if (contactMethod === 'Khác') {\r\n");
      out.write("                    var otherMethod = $('#otherMethod').val();\r\n");
      out.write("                    if (!otherMethod || otherMethod.trim() === '') {\r\n");
      out.write("                        alert('Vui lòng nhập phương thức liên hệ!');\r\n");
      out.write("                        return false;\r\n");
      out.write("                    }\r\n");
      out.write("                    contactMethod = otherMethod.trim();\r\n");
      out.write("                }\r\n");
      out.write("                \r\n");
      out.write("                // Validation: Kiểm tra loại khách hàng\r\n");
      out.write("                if (!customerType || customerType.trim() === '') {\r\n");
      out.write("                    alert('Vui lòng chọn loại khách hàng!');\r\n");
      out.write("                    $('#customerType').focus();\r\n");
      out.write("                    return false;\r\n");
      out.write("                }\r\n");
      out.write("                \r\n");
      out.write("                // Validation: Nếu là doanh nghiệp, kiểm tra tên công ty\r\n");
      out.write("                if (customerType === 'company') {\r\n");
      out.write("                    if (!companyName || companyName.trim() === '') {\r\n");
      out.write("                        alert('Vui lòng nhập tên công ty!');\r\n");
      out.write("                        $('#companyName').focus();\r\n");
      out.write("                        return false;\r\n");
      out.write("                    }\r\n");
      out.write("                }\r\n");
      out.write("                \r\n");
      out.write("                // Gửi request cập nhật\r\n");
      out.write("                $.ajax({\r\n");
      out.write("                    url: 'contact-management',\r\n");
      out.write("                    type: 'POST',\r\n");
      out.write("                    data: {\r\n");
      out.write("                        action: 'updateStatus',\r\n");
      out.write("                        id: currentMessageId,\r\n");
      out.write("                        status: 'replied',\r\n");
      out.write("                        contactMethod: contactMethod,\r\n");
      out.write("                        address: address ? address.trim() : '',\r\n");
      out.write("                        customerType: customerType,\r\n");
      out.write("                        companyName: companyName ? companyName.trim() : '',\r\n");
      out.write("                        taxCode: taxCode ? taxCode.trim() : '',\r\n");
      out.write("                        contactContent: contactContent ? contactContent.trim() : ''\r\n");
      out.write("                    },\r\n");
      out.write("                    dataType: 'json',\r\n");
      out.write("                    success: function(response) {\r\n");
      out.write("                        if (response.success) {\r\n");
      out.write("                            alert('✓ ' + response.message);\r\n");
      out.write("                            $('#markContactedModal').modal('hide');\r\n");
      out.write("                            location.reload();\r\n");
      out.write("                        } else {\r\n");
      out.write("                            alert('✗ ' + response.message);\r\n");
      out.write("                        }\r\n");
      out.write("                    },\r\n");
      out.write("                    error: function() {\r\n");
      out.write("                        alert('✗ Không thể cập nhật. Vui lòng thử lại!');\r\n");
      out.write("                    }\r\n");
      out.write("                });\r\n");
      out.write("                \r\n");
      out.write("                return false;\r\n");
      out.write("            });\r\n");
      out.write("        });\r\n");
      out.write("        \r\n");
      out.write("        // Xem chi tiết tin nhắn\r\n");
      out.write("        function viewMessage(messageId, $button) {\r\n");
      out.write("            console.log('viewMessage called with messageId:', messageId, 'button:', $button);\r\n");
      out.write("            currentMessageId = messageId;\r\n");
      out.write("            \r\n");
      out.write("            // Nếu không có button, tìm lại từ messageId\r\n");
      out.write("            if (!$button || $button.length === 0) {\r\n");
      out.write("                $button = $('.view-message-btn[data-message-id=\"' + messageId + '\"]');\r\n");
      out.write("                console.log('Button found by ID:', $button.length);\r\n");
      out.write("            }\r\n");
      out.write("            \r\n");
      out.write("            // Tìm dòng trong bảng - ưu tiên sử dụng closest từ button\r\n");
      out.write("            var row = null;\r\n");
      out.write("            if ($button && $button.length > 0) {\r\n");
      out.write("                row = $button.closest('tr');\r\n");
      out.write("                console.log('Row found by closest:', row.length);\r\n");
      out.write("            }\r\n");
      out.write("            \r\n");
      out.write("            // Nếu không tìm được bằng cách trên, thử tìm bằng ID\r\n");
      out.write("            if (!row || row.length === 0) {\r\n");
      out.write("                row = $('#messagesTable tbody tr').filter(function() {\r\n");
      out.write("                    var firstTdText = $(this).find('td:first').text().trim();\r\n");
      out.write("                    var match = firstTdText == messageId || parseInt(firstTdText) == messageId;\r\n");
      out.write("                    if (match) console.log('Row found by ID filter:', $(this).find('td:first').text());\r\n");
      out.write("                    return match;\r\n");
      out.write("                });\r\n");
      out.write("                console.log('Row found by ID filter:', row.length);\r\n");
      out.write("            }\r\n");
      out.write("            \r\n");
      out.write("            // Nếu vẫn không tìm được, thử tìm bằng data attribute\r\n");
      out.write("            if (!row || row.length === 0) {\r\n");
      out.write("                row = $('#messagesTable tbody tr').has('.view-message-btn[data-message-id=\"' + messageId + '\"]');\r\n");
      out.write("                console.log('Row found by has selector:', row.length);\r\n");
      out.write("            }\r\n");
      out.write("            \r\n");
      out.write("            if (!row || row.length === 0) {\r\n");
      out.write("                console.error('Không tìm thấy dòng cho messageId:', messageId);\r\n");
      out.write("                console.error('Total rows in table:', $('#messagesTable tbody tr').length);\r\n");
      out.write("                alert('Không tìm thấy tin nhắn với ID: ' + messageId);\r\n");
      out.write("                return;\r\n");
      out.write("            }\r\n");
      out.write("            \r\n");
      out.write("            console.log('Row found successfully, columns:', row.find('td').length);\r\n");
      out.write("            \r\n");
      out.write("            // Lấy thông tin từ bảng\r\n");
      out.write("            var fullName = row.find('td:eq(1)').text().trim();\r\n");
      out.write("            var email = row.find('td:eq(2)').text().trim();\r\n");
      out.write("            var phone = row.find('td:eq(3)').text().trim();\r\n");
      out.write("            var message = row.find('td:eq(4)').text().trim();\r\n");
      out.write("            var status = row.find('td:eq(5) span').text().trim();\r\n");
      out.write("            var createdAt = row.find('td:eq(6)').text().trim();\r\n");
      out.write("            var repliedAt = row.find('td:eq(7)').text().trim();\r\n");
      out.write("            \r\n");
      out.write("            // Lấy các thông tin bổ sung từ data attribute của button (ưu tiên button được click)\r\n");
      out.write("            var $viewBtn = $button && $button.length > 0 ? $button : row.find('.view-message-btn');\r\n");
      out.write("            var contactMethod = String($viewBtn.data('contact-method') || '');\r\n");
      out.write("            var address = String($viewBtn.data('address') || '');\r\n");
      out.write("            var customerType = String($viewBtn.data('customer-type') || '');\r\n");
      out.write("            var companyName = String($viewBtn.data('company-name') || '');\r\n");
      out.write("            var taxCode = String($viewBtn.data('tax-code') || '');\r\n");
      out.write("            var contactContent = String($viewBtn.data('contact-content') || '');\r\n");
      out.write("            \r\n");
      out.write("            // Lấy toàn bộ nội dung tin nhắn (có thể cần gọi API)\r\n");
      out.write("            // Tạm thời dùng nội dung từ bảng\r\n");
      out.write("            var html = '<div class=\"row\">';\r\n");
      out.write("            html += '<div class=\"col-md-12\">';\r\n");
      out.write("            html += '<h5 style=\"margin-top: 0; margin-bottom: 20px; color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px;\">Thông tin liên hệ</h5>';\r\n");
      out.write("            html += '<div class=\"row\">';\r\n");
      out.write("            // Họ tên - cột 1\r\n");
      out.write("            html += '<div class=\"col-md-6 col-sm-6\">';\r\n");
      out.write("            html += '<div class=\"form-group\" style=\"margin-bottom: 15px;\">';\r\n");
      out.write("            html += '<p class=\"form-control-static\" style=\"margin-bottom: 0;\"><strong>Họ tên:</strong> ' + escapeHtml(fullName) + '</p>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            // Email - cột 2\r\n");
      out.write("            html += '<div class=\"col-md-6 col-sm-6\">';\r\n");
      out.write("            html += '<div class=\"form-group\" style=\"margin-bottom: 15px;\">';\r\n");
      out.write("            html += '<p class=\"form-control-static\" style=\"margin-bottom: 0;\"><strong>Email:</strong> <a href=\"mailto:' + escapeHtml(email) + '\">' + escapeHtml(email) + '</a></p>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '<div class=\"row\">';\r\n");
      out.write("            // Số điện thoại - cột 1\r\n");
      out.write("            html += '<div class=\"col-md-6 col-sm-6\">';\r\n");
      out.write("            html += '<div class=\"form-group\" style=\"margin-bottom: 15px;\">';\r\n");
      out.write("            html += '<p class=\"form-control-static\" style=\"margin-bottom: 0;\"><strong>Số điện thoại:</strong> <a href=\"tel:' + escapeHtml(phone) + '\">' + escapeHtml(phone) + '</a></p>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            // Ngày gửi - cột 2\r\n");
      out.write("            html += '<div class=\"col-md-6 col-sm-6\">';\r\n");
      out.write("            html += '<div class=\"form-group\" style=\"margin-bottom: 15px;\">';\r\n");
      out.write("            html += '<p class=\"form-control-static\" style=\"margin-bottom: 0;\"><strong>Ngày gửi:</strong> ' + escapeHtml(createdAt) + '</p>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            // Nội dung tin nhắn - full width (sau số điện thoại)\r\n");
      out.write("            html += '<div class=\"form-group\" style=\"margin-bottom: 15px;\">';\r\n");
      out.write("            html += '<label><strong>Nội dung tin nhắn:</strong></label>';\r\n");
      out.write("            html += '<div class=\"message-detail\" style=\"background: #f9f9f9; padding: 15px; border-radius: 5px; border: 1px solid #ddd; white-space: pre-wrap; word-wrap: break-word;\">';\r\n");
      out.write("            html += escapeHtml(message);\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            // Địa chỉ (nếu có) - full width\r\n");
      out.write("            if (address && String(address).trim() !== '') {\r\n");
      out.write("                html += '<div class=\"form-group\" style=\"margin-bottom: 15px;\">';\r\n");
      out.write("                html += '<p class=\"form-control-static\" style=\"margin-bottom: 0;\"><strong>Địa chỉ:</strong> ' + escapeHtml(String(address)) + '</p>';\r\n");
      out.write("                html += '</div>';\r\n");
      out.write("            }\r\n");
      out.write("            // Trạng thái và Ngày phản hồi - hàng ngang\r\n");
      out.write("            html += '<div class=\"row\">';\r\n");
      out.write("            html += '<div class=\"col-md-6 col-sm-6\">';\r\n");
      out.write("            html += '<div class=\"form-group\" style=\"margin-bottom: 15px;\">';\r\n");
      out.write("            html += '<p class=\"form-control-static\" style=\"margin-bottom: 0;\"><strong>Trạng thái:</strong> ';\r\n");
      out.write("            var statusLabelClass = 'info';\r\n");
      out.write("            if (status === 'Mới') {\r\n");
      out.write("                statusLabelClass = 'danger';\r\n");
      out.write("            } else if (status === 'Đã liên hệ') {\r\n");
      out.write("                statusLabelClass = 'success';\r\n");
      out.write("            } else if (status === 'Đã chuyển đổi') {\r\n");
      out.write("                statusLabelClass = 'primary';\r\n");
      out.write("            }\r\n");
      out.write("            html += '<span class=\"label label-' + statusLabelClass + '\">' + escapeHtml(status) + '</span></p>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            // Ngày phản hồi - cột 2\r\n");
      out.write("            if (repliedAt && repliedAt !== '-') {\r\n");
      out.write("                html += '<div class=\"col-md-6 col-sm-6\">';\r\n");
      out.write("                html += '<div class=\"form-group\" style=\"margin-bottom: 15px;\">';\r\n");
      out.write("                html += '<p class=\"form-control-static\" style=\"margin-bottom: 0;\"><strong>Ngày phản hồi:</strong> ' + escapeHtml(repliedAt) + '</p>';\r\n");
      out.write("                html += '</div>';\r\n");
      out.write("                html += '</div>';\r\n");
      out.write("            }\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            // Phương thức liên hệ (nếu có) - full width\r\n");
      out.write("            if (contactMethod && String(contactMethod).trim() !== '') {\r\n");
      out.write("                html += '<div class=\"form-group\" style=\"margin-bottom: 15px;\">';\r\n");
      out.write("                html += '<p class=\"form-control-static\" style=\"margin-bottom: 0;\"><strong>Phương thức liên hệ:</strong> <span class=\"label label-info\">' + escapeHtml(String(contactMethod)) + '</span></p>';\r\n");
      out.write("                html += '</div>';\r\n");
      out.write("            }\r\n");
      out.write("            html += '<hr>';\r\n");
      out.write("           // html += '<h5 style=\"margin-top: 0; margin-bottom: 20px; color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px;\">Thông tin khách hàng</h5>';\r\n");
      out.write("            // Sắp xếp thông tin khách hàng theo dạng ngang\r\n");
      out.write("            if (customerType && String(customerType).trim() !== '') {\r\n");
      out.write("                var customerTypeLabel = String(customerType) === 'company' ? 'Doanh nghiệp' : 'Cá nhân';\r\n");
      out.write("                if (companyName && String(companyName).trim() !== '') {\r\n");
      out.write("                    // Loại khách hàng và Tên công ty - hàng ngang\r\n");
      out.write("                    html += '<div class=\"row\">';\r\n");
      out.write("                    html += '<div class=\"col-md-6 col-sm-6\">';\r\n");
      out.write("                    html += '<div class=\"form-group\" style=\"margin-bottom: 15px;\">';\r\n");
      out.write("                    html += '<p class=\"form-control-static\" style=\"margin-bottom: 0;\"><strong>Loại khách hàng:</strong> <span class=\"label label-primary\">' + escapeHtml(customerTypeLabel) + '</span></p>';\r\n");
      out.write("                    html += '</div>';\r\n");
      out.write("                    html += '</div>';\r\n");
      out.write("                    html += '<div class=\"col-md-6 col-sm-6\">';\r\n");
      out.write("                    html += '<div class=\"form-group\" style=\"margin-bottom: 15px;\">';\r\n");
      out.write("                    html += '<p class=\"form-control-static\" style=\"margin-bottom: 0;\"><strong>Tên công ty:</strong> ' + escapeHtml(String(companyName)) + '</p>';\r\n");
      out.write("                    html += '</div>';\r\n");
      out.write("                    html += '</div>';\r\n");
      out.write("                    html += '</div>';\r\n");
      out.write("                } else {\r\n");
      out.write("                    // Chỉ có Loại khách hàng\r\n");
      out.write("                    html += '<div class=\"form-group\" style=\"margin-bottom: 15px;\">';\r\n");
      out.write("                    html += '<p class=\"form-control-static\" style=\"margin-bottom: 0;\"><strong>Loại khách hàng:</strong> <span class=\"label label-primary\">' + escapeHtml(customerTypeLabel) + '</span></p>';\r\n");
      out.write("                    html += '</div>';\r\n");
      out.write("                }\r\n");
      out.write("            } else if (companyName && String(companyName).trim() !== '') {\r\n");
      out.write("                // Chỉ có Tên công ty\r\n");
      out.write("                html += '<div class=\"form-group\" style=\"margin-bottom: 15px;\">';\r\n");
      out.write("                html += '<p class=\"form-control-static\" style=\"margin-bottom: 0;\"><strong>Tên công ty:</strong> ' + escapeHtml(String(companyName)) + '</p>';\r\n");
      out.write("                html += '</div>';\r\n");
      out.write("            }\r\n");
      out.write("            // Mã số thuế (nếu có) - full width\r\n");
      out.write("            if (taxCode && String(taxCode).trim() !== '') {\r\n");
      out.write("                html += '<div class=\"form-group\" style=\"margin-bottom: 15px;\">';\r\n");
      out.write("                html += '<p class=\"form-control-static\" style=\"margin-bottom: 0;\"><strong>Mã số thuế:</strong> ' + escapeHtml(String(taxCode)) + '</p>';\r\n");
      out.write("                html += '</div>';\r\n");
      out.write("            }\r\n");
      out.write("            // Nội dung liên hệ (nếu có) - full width (sau mã số thuế)\r\n");
      out.write("            if (contactContent && String(contactContent).trim() !== '') {\r\n");
      out.write("                html += '<div class=\"form-group\" style=\"margin-bottom: 15px;\">';\r\n");
      out.write("                html += '<label><strong>Nội dung liên hệ:</strong></label>';\r\n");
      out.write("                html += '<div class=\"message-detail\" style=\"background: #f9f9f9; padding: 15px; border-radius: 5px; border: 1px solid #ddd; white-space: pre-wrap; word-wrap: break-word;\">';\r\n");
      out.write("                html += escapeHtml(String(contactContent));\r\n");
      out.write("                html += '</div>';\r\n");
      out.write("                html += '</div>';\r\n");
      out.write("            }\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            \r\n");
      out.write("            $('#messageDetailContent').html(html);\r\n");
      out.write("            \r\n");
      out.write("            // Ẩn nút \"Đánh dấu đã liên hệ\" nếu trạng thái là \"Đã liên hệ\" hoặc \"Đã chuyển đổi\"\r\n");
      out.write("            if (status === 'Đã liên hệ' || status === 'Đã chuyển đổi') {\r\n");
      out.write("                $('#btnMarkAsReplied').hide();\r\n");
      out.write("            } else {\r\n");
      out.write("                $('#btnMarkAsReplied').show();\r\n");
      out.write("            }\r\n");
      out.write("            \r\n");
      out.write("            // Nếu chưa đọc, tự động đánh dấu đã đọc sau khi modal hiển thị\r\n");
      out.write("            var isNewMessage = (status === 'Mới');\r\n");
      out.write("            \r\n");
      out.write("            // Đăng ký event một lần để xử lý cập nhật trạng thái\r\n");
      out.write("            $('#viewMessageModal').off('shown.bs.modal.viewMessage').on('shown.bs.modal.viewMessage', function() {\r\n");
      out.write("                if (isNewMessage) {\r\n");
      out.write("                    updateStatus(messageId, 'read', false, false);\r\n");
      out.write("                }\r\n");
      out.write("            });\r\n");
      out.write("            \r\n");
      out.write("            // Hiển thị modal\r\n");
      out.write("            $('#viewMessageModal').modal('show');\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        // Cập nhật trạng thái\r\n");
      out.write("        function updateStatus(messageId, status, showAlert, reload) {\r\n");
      out.write("            if (showAlert === undefined) showAlert = true;\r\n");
      out.write("            if (reload === undefined) reload = true;\r\n");
      out.write("            \r\n");
      out.write("            if (showAlert && !confirm('Bạn có chắc muốn cập nhật trạng thái?')) {\r\n");
      out.write("                return;\r\n");
      out.write("            }\r\n");
      out.write("            \r\n");
      out.write("            $.ajax({\r\n");
      out.write("                url: 'contact-management',\r\n");
      out.write("                type: 'POST',\r\n");
      out.write("                data: {\r\n");
      out.write("                    action: 'updateStatus',\r\n");
      out.write("                    id: messageId,\r\n");
      out.write("                    status: status\r\n");
      out.write("                },\r\n");
      out.write("                dataType: 'json',\r\n");
      out.write("                success: function(response) {\r\n");
      out.write("                    if (response.success) {\r\n");
      out.write("                        if (showAlert) {\r\n");
      out.write("                            alert('✓ ' + response.message);\r\n");
      out.write("                        }\r\n");
      out.write("                        // Chỉ reload nếu được yêu cầu\r\n");
      out.write("                        if (reload) {\r\n");
      out.write("                            location.reload();\r\n");
      out.write("                        } else {\r\n");
      out.write("                            // Nếu đang mở modal, đánh dấu để reload sau khi đóng\r\n");
      out.write("                            if ($('#viewMessageModal').hasClass('in') || $('#viewMessageModal').is(':visible')) {\r\n");
      out.write("                                shouldReloadAfterModalClose = true;\r\n");
      out.write("                            } else {\r\n");
      out.write("                                location.reload();\r\n");
      out.write("                            }\r\n");
      out.write("                        }\r\n");
      out.write("                    } else {\r\n");
      out.write("                        alert('✗ ' + response.message);\r\n");
      out.write("                    }\r\n");
      out.write("                },\r\n");
      out.write("                error: function() {\r\n");
      out.write("                    alert('✗ Không thể cập nhật. Vui lòng thử lại!');\r\n");
      out.write("                }\r\n");
      out.write("            });\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        // Đánh dấu đã phản hồi từ modal xem chi tiết\r\n");
      out.write("        $('#btnMarkAsReplied').click(function() {\r\n");
      out.write("            if (currentMessageId) {\r\n");
      out.write("                $('#viewMessageModal').modal('hide');\r\n");
      out.write("                showMarkContactedModal(currentMessageId);\r\n");
      out.write("            }\r\n");
      out.write("        });\r\n");
      out.write("        \r\n");
      out.write("        // Hiển thị modal đánh dấu đã liên hệ\r\n");
      out.write("        function showMarkContactedModal(messageId) {\r\n");
      out.write("            currentMessageId = messageId;\r\n");
      out.write("            \r\n");
      out.write("            // Tìm dòng trong bảng\r\n");
      out.write("            var row = $('#messagesTable tbody tr').filter(function() {\r\n");
      out.write("                return $(this).find('td:first').text() == messageId;\r\n");
      out.write("            });\r\n");
      out.write("            \r\n");
      out.write("            if (row.length === 0) {\r\n");
      out.write("                alert('Không tìm thấy tin nhắn');\r\n");
      out.write("                return;\r\n");
      out.write("            }\r\n");
      out.write("            \r\n");
      out.write("            // Lấy thông tin từ bảng\r\n");
      out.write("            var fullName = row.find('td:eq(1)').text().trim();\r\n");
      out.write("            var email = row.find('td:eq(2)').text().trim();\r\n");
      out.write("            var phone = row.find('td:eq(3)').text().trim();\r\n");
      out.write("            var message = row.find('td:eq(4)').text().trim();\r\n");
      out.write("            var status = row.find('td:eq(5) span').text().trim();\r\n");
      out.write("            var createdAt = row.find('td:eq(6)').text().trim();\r\n");
      out.write("            \r\n");
      out.write("            // Tạo HTML với thông tin đầy đủ và form\r\n");
      out.write("            var html = '<div class=\"row\">';\r\n");
      out.write("            html += '<div class=\"col-md-12\">';\r\n");
      out.write("            html += '<h5 style=\"margin-top: 0; margin-bottom: 20px; color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px;\">Thông tin liên hệ</h5>';\r\n");
      out.write("            html += '<div class=\"row\">';\r\n");
      out.write("            // Họ tên - cột 1\r\n");
      out.write("            html += '<div class=\"col-md-6 col-sm-6\">';\r\n");
      out.write("            html += '<div class=\"form-group\" style=\"margin-bottom: 15px;\">';\r\n");
      out.write("            html += '<p class=\"form-control-static\" style=\"margin-bottom: 0;\"><strong>Họ tên:</strong> ' + escapeHtml(fullName) + '</p>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            // Email - cột 2\r\n");
      out.write("            html += '<div class=\"col-md-6 col-sm-6\">';\r\n");
      out.write("            html += '<div class=\"form-group\" style=\"margin-bottom: 15px;\">';\r\n");
      out.write("            html += '<p class=\"form-control-static\" style=\"margin-bottom: 0;\"><strong>Email:</strong> <a href=\"mailto:' + escapeHtml(email) + '\">' + escapeHtml(email) + '</a></p>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '<div class=\"row\">';\r\n");
      out.write("            // Số điện thoại - cột 1\r\n");
      out.write("            html += '<div class=\"col-md-6 col-sm-6\">';\r\n");
      out.write("            html += '<div class=\"form-group\" style=\"margin-bottom: 15px;\">';\r\n");
      out.write("            html += '<p class=\"form-control-static\" style=\"margin-bottom: 0;\"><strong>Số điện thoại:</strong> <a href=\"tel:' + escapeHtml(phone) + '\">' + escapeHtml(phone) + '</a></p>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            // Ngày gửi - cột 2\r\n");
      out.write("            html += '<div class=\"col-md-6 col-sm-6\">';\r\n");
      out.write("            html += '<div class=\"form-group\" style=\"margin-bottom: 15px;\">';\r\n");
      out.write("            html += '<p class=\"form-control-static\" style=\"margin-bottom: 0;\"><strong>Ngày gửi:</strong> ' + escapeHtml(createdAt) + '</p>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            // Nội dung tin nhắn - full width\r\n");
      out.write("            html += '<div class=\"form-group\">';\r\n");
      out.write("            html += '<label>Nội dung tin nhắn:</label>';\r\n");
      out.write("            html += '<div class=\"message-detail\" style=\"background: #f9f9f9; padding: 15px; border-radius: 5px; border: 1px solid #ddd; max-height: 150px; overflow-y: auto;\">';\r\n");
      out.write("            html += escapeHtml(message);\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '<hr>';\r\n");
      out.write("            html += '<h5 style=\"margin-top: 0; margin-bottom: 20px; color: #333;\">Thông tin bổ sung</h5>';\r\n");
      out.write("            html += '<div class=\"form-group\">';\r\n");
      out.write("            html += '<label for=\"address\">Địa chỉ:</label>';\r\n");
      out.write("            html += '<input type=\"text\" class=\"form-control\" id=\"address\" placeholder=\"Nhập địa chỉ\" maxlength=\"500\">';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '<div class=\"form-group\">';\r\n");
      out.write("            html += '<label for=\"customerType\">Loại khách hàng: <span style=\"color: red;\">*</span></label>';\r\n");
      out.write("            html += '<select class=\"form-control\" id=\"customerType\" required>';\r\n");
      out.write("            html += '<option value=\"\">-- Chọn loại khách hàng --</option>';\r\n");
      out.write("            html += '<option value=\"individual\">Cá nhân</option>';\r\n");
      out.write("            html += '<option value=\"company\">Doanh nghiệp</option>';\r\n");
      out.write("            html += '</select>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '<div class=\"form-group\" id=\"companyFieldsGroup\" style=\"display: none;\">';\r\n");
      out.write("            html += '<label for=\"companyName\">Tên công ty: <span style=\"color: red;\">*</span></label>';\r\n");
      out.write("            html += '<input type=\"text\" class=\"form-control\" id=\"companyName\" placeholder=\"Nhập tên công ty\" maxlength=\"255\">';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '<div class=\"form-group\" id=\"taxCodeFieldsGroup\" style=\"display: none;\">';\r\n");
      out.write("            html += '<label for=\"taxCode\">Mã số thuế:</label>';\r\n");
      out.write("            html += '<input type=\"text\" class=\"form-control\" id=\"taxCode\" placeholder=\"Nhập mã số thuế\" maxlength=\"50\">';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '<hr>';\r\n");
      out.write("            html += '<div class=\"form-group\">';\r\n");
      out.write("            html += '<label for=\"contactMethod\">Đã liên hệ bằng gì? <span style=\"color: red;\">*</span></label>';\r\n");
      out.write("            html += '<select class=\"form-control\" id=\"contactMethod\" required>';\r\n");
      out.write("            html += '<option value=\"\">-- Chọn phương thức liên hệ --</option>';\r\n");
      out.write("            html += '<option value=\"Email\">Email</option>';\r\n");
      out.write("            html += '<option value=\"Điện thoại\">Điện thoại</option>';\r\n");
      out.write("            html += '<option value=\"Tin nhắn\">Tin nhắn</option>';\r\n");
      out.write("            html += '<option value=\"Trực tiếp\">Trực tiếp</option>';\r\n");
      out.write("            html += '<option value=\"Khác\">Khác</option>';\r\n");
      out.write("            html += '</select>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '<div class=\"form-group\" id=\"otherMethodGroup\" style=\"display: none;\">';\r\n");
      out.write("            html += '<label for=\"otherMethod\">Mô tả phương thức khác:</label>';\r\n");
      out.write("            html += '<input type=\"text\" class=\"form-control\" id=\"otherMethod\" placeholder=\"Nhập phương thức liên hệ\">';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '<div class=\"form-group\">';\r\n");
      out.write("            html += '<label for=\"contactContent\">Nội dung liên hệ:</label>';\r\n");
      out.write("            html += '<textarea class=\"form-control\" id=\"contactContent\" rows=\"4\" placeholder=\"Nhập nội dung liên hệ\" maxlength=\"1000\"></textarea>';\r\n");
      out.write("            html += '<small class=\"help-block text-muted\">Tối đa 1000 ký tự. Đã nhập: <span id=\"contactContentCount\">0</span>/1000</small>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            html += '</div>';\r\n");
      out.write("            \r\n");
      out.write("            $('#markContactedContent').html(html);\r\n");
      out.write("            \r\n");
      out.write("            // Xử lý khi chọn loại khách hàng - sử dụng off để tránh đăng ký nhiều lần\r\n");
      out.write("            $('#customerType').off('change').on('change', function() {\r\n");
      out.write("                var customerType = $(this).val();\r\n");
      out.write("                if (customerType === 'company') {\r\n");
      out.write("                    $('#companyFieldsGroup').show();\r\n");
      out.write("                    $('#taxCodeFieldsGroup').show();\r\n");
      out.write("                    $('#companyName').prop('required', true);\r\n");
      out.write("                } else {\r\n");
      out.write("                    $('#companyFieldsGroup').hide();\r\n");
      out.write("                    $('#taxCodeFieldsGroup').hide();\r\n");
      out.write("                    $('#companyName').prop('required', false);\r\n");
      out.write("                    $('#taxCode').prop('required', false);\r\n");
      out.write("                    $('#companyName').val('');\r\n");
      out.write("                    $('#taxCode').val('');\r\n");
      out.write("                }\r\n");
      out.write("            });\r\n");
      out.write("            \r\n");
      out.write("            // Xử lý khi chọn \"Khác\" - sử dụng off để tránh đăng ký nhiều lần\r\n");
      out.write("            $('#contactMethod').off('change').on('change', function() {\r\n");
      out.write("                if ($(this).val() === 'Khác') {\r\n");
      out.write("                    $('#otherMethodGroup').show();\r\n");
      out.write("                    $('#otherMethod').prop('required', true);\r\n");
      out.write("                } else {\r\n");
      out.write("                    $('#otherMethodGroup').hide();\r\n");
      out.write("                    $('#otherMethod').prop('required', false);\r\n");
      out.write("                    $('#otherMethod').val('');\r\n");
      out.write("                }\r\n");
      out.write("            });\r\n");
      out.write("            \r\n");
      out.write("            // Đếm số ký tự trong textarea nội dung liên hệ\r\n");
      out.write("            $('#contactContent').off('input keyup').on('input keyup', function() {\r\n");
      out.write("                var length = $(this).val().length;\r\n");
      out.write("                $('#contactContentCount').text(length);\r\n");
      out.write("                if (length > 1000) {\r\n");
      out.write("                    $('#contactContentCount').css('color', 'red');\r\n");
      out.write("                } else {\r\n");
      out.write("                    $('#contactContentCount').css('color', '');\r\n");
      out.write("                }\r\n");
      out.write("            });\r\n");
      out.write("            \r\n");
      out.write("            // Khởi tạo counter khi modal mở\r\n");
      out.write("            $('#contactContentCount').text($('#contactContent').val().length);\r\n");
      out.write("            \r\n");
      out.write("            // Hiển thị modal\r\n");
      out.write("            $('#markContactedModal').modal('show');\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        // Sắp xếp bảng tin nhắn\r\n");
      out.write("        function sortMessagesTable(column, order) {\r\n");
      out.write("            var columnMap = { 'id': 0, 'full_name': 1, 'email': 2, 'phone': 3, 'message': 4, 'status': 5, 'created_at': 6, 'replied_at': 7 };\r\n");
      out.write("            var colIdx = columnMap[column];\r\n");
      out.write("            if (colIdx === undefined) return;\r\n");
      out.write("            \r\n");
      out.write("            var $rows = $('#messagesTable tbody tr').toArray();\r\n");
      out.write("            $rows.sort(function(a, b) {\r\n");
      out.write("                var aVal = $(a).find('td').eq(colIdx).text().trim();\r\n");
      out.write("                var bVal = $(b).find('td').eq(colIdx).text().trim();\r\n");
      out.write("                \r\n");
      out.write("                if (column === 'id') {\r\n");
      out.write("                    return order === 'asc' ? (parseInt(aVal) || 0) - (parseInt(bVal) || 0) : (parseInt(bVal) || 0) - (parseInt(aVal) || 0);\r\n");
      out.write("                }\r\n");
      out.write("                if (column === 'phone') {\r\n");
      out.write("                    var aNum = aVal.replace(/\\D/g, ''), bNum = bVal.replace(/\\D/g, '');\r\n");
      out.write("                    if (aNum && bNum) return order === 'asc' ? aNum.localeCompare(bNum) : bNum.localeCompare(aNum);\r\n");
      out.write("                }\r\n");
      out.write("                if (column === 'created_at' || column === 'replied_at') {\r\n");
      out.write("                    // So sánh ngày tháng (format: dd/MM/yyyy HH:mm)\r\n");
      out.write("                    var aDate = parseDate(aVal);\r\n");
      out.write("                    var bDate = parseDate(bVal);\r\n");
      out.write("                    if (aDate && bDate) {\r\n");
      out.write("                        return order === 'asc' ? aDate - bDate : bDate - aDate;\r\n");
      out.write("                    }\r\n");
      out.write("                }\r\n");
      out.write("                var cmp = aVal.localeCompare(bVal, 'vi', { sensitivity: 'base' });\r\n");
      out.write("                return order === 'asc' ? cmp : -cmp;\r\n");
      out.write("            });\r\n");
      out.write("            $('#messagesTable tbody').empty().append($rows);\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        // Parse date từ format dd/MM/yyyy HH:mm\r\n");
      out.write("        function parseDate(dateStr) {\r\n");
      out.write("            if (!dateStr || dateStr === '-') return null;\r\n");
      out.write("            try {\r\n");
      out.write("                var parts = dateStr.split(' ');\r\n");
      out.write("                if (parts.length < 2) return null;\r\n");
      out.write("                var datePart = parts[0].split('/');\r\n");
      out.write("                var timePart = parts[1].split(':');\r\n");
      out.write("                if (datePart.length !== 3 || timePart.length < 2) return null;\r\n");
      out.write("                return new Date(datePart[2], datePart[1] - 1, datePart[0], timePart[0], timePart[1] || 0).getTime();\r\n");
      out.write("            } catch (e) {\r\n");
      out.write("                return null;\r\n");
      out.write("            }\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        // Hàm escape HTML\r\n");
      out.write("        function escapeHtml(text) {\r\n");
      out.write("            var map = {\r\n");
      out.write("                '&': '&amp;',\r\n");
      out.write("                '<': '&lt;',\r\n");
      out.write("                '>': '&gt;',\r\n");
      out.write("                '\"': '&quot;',\r\n");
      out.write("                \"'\": '&#039;'\r\n");
      out.write("            };\r\n");
      out.write("            return text.replace(/[&<>\"']/g, function(m) { return map[m]; });\r\n");
      out.write("        }\r\n");
      out.write("    </script>\r\n");
      out.write("</body>\r\n");
      out.write("</html>\r\n");
      out.write("\r\n");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }

  private boolean _jspx_meth_c_005fchoose_005f0(javax.servlet.jsp.PageContext _jspx_page_context)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:choose
    org.apache.taglibs.standard.tag.common.core.ChooseTag _jspx_th_c_005fchoose_005f0 = (org.apache.taglibs.standard.tag.common.core.ChooseTag) _005fjspx_005ftagPool_005fc_005fchoose.get(org.apache.taglibs.standard.tag.common.core.ChooseTag.class);
    _jspx_th_c_005fchoose_005f0.setPageContext(_jspx_page_context);
    _jspx_th_c_005fchoose_005f0.setParent(null);
    int _jspx_eval_c_005fchoose_005f0 = _jspx_th_c_005fchoose_005f0.doStartTag();
    if (_jspx_eval_c_005fchoose_005f0 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
      do {
        out.write("\r\n");
        out.write("                                                ");
        if (_jspx_meth_c_005fwhen_005f0(_jspx_th_c_005fchoose_005f0, _jspx_page_context))
          return true;
        out.write("\r\n");
        out.write("                                                ");
        if (_jspx_meth_c_005fotherwise_005f4(_jspx_th_c_005fchoose_005f0, _jspx_page_context))
          return true;
        out.write("\r\n");
        out.write("                                            ");
        int evalDoAfterBody = _jspx_th_c_005fchoose_005f0.doAfterBody();
        if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
          break;
      } while (true);
    }
    if (_jspx_th_c_005fchoose_005f0.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005fc_005fchoose.reuse(_jspx_th_c_005fchoose_005f0);
      return true;
    }
    _005fjspx_005ftagPool_005fc_005fchoose.reuse(_jspx_th_c_005fchoose_005f0);
    return false;
  }

  private boolean _jspx_meth_c_005fwhen_005f0(javax.servlet.jsp.tagext.JspTag _jspx_th_c_005fchoose_005f0, javax.servlet.jsp.PageContext _jspx_page_context)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:when
    org.apache.taglibs.standard.tag.rt.core.WhenTag _jspx_th_c_005fwhen_005f0 = (org.apache.taglibs.standard.tag.rt.core.WhenTag) _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.get(org.apache.taglibs.standard.tag.rt.core.WhenTag.class);
    _jspx_th_c_005fwhen_005f0.setPageContext(_jspx_page_context);
    _jspx_th_c_005fwhen_005f0.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_c_005fchoose_005f0);
    // /contact_management.jsp(219,48) name = test type = boolean reqTime = true required = true fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
    _jspx_th_c_005fwhen_005f0.setTest(((java.lang.Boolean) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${not empty messages}", java.lang.Boolean.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false)).booleanValue());
    int _jspx_eval_c_005fwhen_005f0 = _jspx_th_c_005fwhen_005f0.doStartTag();
    if (_jspx_eval_c_005fwhen_005f0 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
      do {
        out.write("\r\n");
        out.write("                                                    ");
        if (_jspx_meth_c_005fforEach_005f0(_jspx_th_c_005fwhen_005f0, _jspx_page_context))
          return true;
        out.write("\r\n");
        out.write("                                                ");
        int evalDoAfterBody = _jspx_th_c_005fwhen_005f0.doAfterBody();
        if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
          break;
      } while (true);
    }
    if (_jspx_th_c_005fwhen_005f0.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.reuse(_jspx_th_c_005fwhen_005f0);
      return true;
    }
    _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.reuse(_jspx_th_c_005fwhen_005f0);
    return false;
  }

  private boolean _jspx_meth_c_005fforEach_005f0(javax.servlet.jsp.tagext.JspTag _jspx_th_c_005fwhen_005f0, javax.servlet.jsp.PageContext _jspx_page_context)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:forEach
    org.apache.taglibs.standard.tag.rt.core.ForEachTag _jspx_th_c_005fforEach_005f0 = (org.apache.taglibs.standard.tag.rt.core.ForEachTag) _005fjspx_005ftagPool_005fc_005fforEach_0026_005fvar_005fitems.get(org.apache.taglibs.standard.tag.rt.core.ForEachTag.class);
    _jspx_th_c_005fforEach_005f0.setPageContext(_jspx_page_context);
    _jspx_th_c_005fforEach_005f0.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_c_005fwhen_005f0);
    // /contact_management.jsp(220,52) name = var type = java.lang.String reqTime = false required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
    _jspx_th_c_005fforEach_005f0.setVar("message");
    // /contact_management.jsp(220,52) name = items type = javax.el.ValueExpression reqTime = true required = false fragment = false deferredValue = true expectedTypeName = java.lang.Object deferredMethod = false methodSignature = null
    _jspx_th_c_005fforEach_005f0.setItems(new org.apache.jasper.el.JspValueExpression("/contact_management.jsp(220,52) '${messages}'",_el_expressionfactory.createValueExpression(_jspx_page_context.getELContext(),"${messages}",java.lang.Object.class)).getValue(_jspx_page_context.getELContext()));
    int[] _jspx_push_body_count_c_005fforEach_005f0 = new int[] { 0 };
    try {
      int _jspx_eval_c_005fforEach_005f0 = _jspx_th_c_005fforEach_005f0.doStartTag();
      if (_jspx_eval_c_005fforEach_005f0 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
        do {
          out.write("\r\n");
          out.write("                                                        <tr class=\"message-status-");
          out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.status}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
          out.write("\">\r\n");
          out.write("                                                            <td>");
          out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.id}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
          out.write("</td>\r\n");
          out.write("                                                            <td><strong>");
          out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.fullName}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
          out.write("</strong></td>\r\n");
          out.write("                                                            <td>");
          out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.email}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
          out.write("</td>\r\n");
          out.write("                                                            <td>");
          out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.phone}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
          out.write("</td>\r\n");
          out.write("                                                            <td>\r\n");
          out.write("                                                                ");
          if (_jspx_meth_c_005fchoose_005f1(_jspx_th_c_005fforEach_005f0, _jspx_page_context, _jspx_push_body_count_c_005fforEach_005f0))
            return true;
          out.write("\r\n");
          out.write("                                                            </td>\r\n");
          out.write("                                                            <td>\r\n");
          out.write("                                                                ");
          if (_jspx_meth_c_005fchoose_005f2(_jspx_th_c_005fforEach_005f0, _jspx_page_context, _jspx_push_body_count_c_005fforEach_005f0))
            return true;
          out.write("\r\n");
          out.write("                                                            </td>\r\n");
          out.write("                                                            <td>\r\n");
          out.write("                                                                ");
          if (_jspx_meth_fmt_005fformatDate_005f0(_jspx_th_c_005fforEach_005f0, _jspx_page_context, _jspx_push_body_count_c_005fforEach_005f0))
            return true;
          out.write("\r\n");
          out.write("                                                            </td>\r\n");
          out.write("                                                            <td>\r\n");
          out.write("                                                                ");
          if (_jspx_meth_c_005fchoose_005f3(_jspx_th_c_005fforEach_005f0, _jspx_page_context, _jspx_push_body_count_c_005fforEach_005f0))
            return true;
          out.write("\r\n");
          out.write("                                                            </td>\r\n");
          out.write("                                                            <td>\r\n");
          out.write("                                                                <button class=\"btn btn-info btn-xs view-message-btn\" \r\n");
          out.write("                                                                        data-message-id=\"");
          out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.id}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
          out.write("\" \r\n");
          out.write("                                                                        data-contact-method=\"");
          out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.contactMethod != null ? message.contactMethod : ''}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
          out.write("\"\r\n");
          out.write("                                                                        data-address=\"");
          out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.address != null ? message.address : ''}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
          out.write("\"\r\n");
          out.write("                                                                        data-customer-type=\"");
          out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.customerType != null ? message.customerType : ''}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
          out.write("\"\r\n");
          out.write("                                                                        data-company-name=\"");
          out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.companyName != null ? message.companyName : ''}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
          out.write("\"\r\n");
          out.write("                                                                        data-tax-code=\"");
          out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.taxCode != null ? message.taxCode : ''}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
          out.write("\"\r\n");
          out.write("                                                                        data-contact-content=\"");
          out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.contactContent != null ? message.contactContent : ''}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
          out.write("\"\r\n");
          out.write("                                                                        title=\"Xem chi tiết\">\r\n");
          out.write("                                                                    <i class=\"fa fa-eye\"></i> Xem\r\n");
          out.write("                                                                </button>\r\n");
          out.write("                                                                ");
          if (_jspx_meth_c_005fchoose_005f4(_jspx_th_c_005fforEach_005f0, _jspx_page_context, _jspx_push_body_count_c_005fforEach_005f0))
            return true;
          out.write("\r\n");
          out.write("                                                            </td>\r\n");
          out.write("                                                        </tr>\r\n");
          out.write("                                                    ");
          int evalDoAfterBody = _jspx_th_c_005fforEach_005f0.doAfterBody();
          if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
            break;
        } while (true);
      }
      if (_jspx_th_c_005fforEach_005f0.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
        return true;
      }
    } catch (java.lang.Throwable _jspx_exception) {
      while (_jspx_push_body_count_c_005fforEach_005f0[0]-- > 0)
        out = _jspx_page_context.popBody();
      _jspx_th_c_005fforEach_005f0.doCatch(_jspx_exception);
    } finally {
      _jspx_th_c_005fforEach_005f0.doFinally();
      _005fjspx_005ftagPool_005fc_005fforEach_0026_005fvar_005fitems.reuse(_jspx_th_c_005fforEach_005f0);
    }
    return false;
  }

  private boolean _jspx_meth_c_005fchoose_005f1(javax.servlet.jsp.tagext.JspTag _jspx_th_c_005fforEach_005f0, javax.servlet.jsp.PageContext _jspx_page_context, int[] _jspx_push_body_count_c_005fforEach_005f0)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:choose
    org.apache.taglibs.standard.tag.common.core.ChooseTag _jspx_th_c_005fchoose_005f1 = (org.apache.taglibs.standard.tag.common.core.ChooseTag) _005fjspx_005ftagPool_005fc_005fchoose.get(org.apache.taglibs.standard.tag.common.core.ChooseTag.class);
    _jspx_th_c_005fchoose_005f1.setPageContext(_jspx_page_context);
    _jspx_th_c_005fchoose_005f1.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_c_005fforEach_005f0);
    int _jspx_eval_c_005fchoose_005f1 = _jspx_th_c_005fchoose_005f1.doStartTag();
    if (_jspx_eval_c_005fchoose_005f1 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
      do {
        out.write("\r\n");
        out.write("                                                                    ");
        if (_jspx_meth_c_005fwhen_005f1(_jspx_th_c_005fchoose_005f1, _jspx_page_context, _jspx_push_body_count_c_005fforEach_005f0))
          return true;
        out.write("\r\n");
        out.write("                                                                    ");
        if (_jspx_meth_c_005fotherwise_005f0(_jspx_th_c_005fchoose_005f1, _jspx_page_context, _jspx_push_body_count_c_005fforEach_005f0))
          return true;
        out.write("\r\n");
        out.write("                                                                ");
        int evalDoAfterBody = _jspx_th_c_005fchoose_005f1.doAfterBody();
        if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
          break;
      } while (true);
    }
    if (_jspx_th_c_005fchoose_005f1.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005fc_005fchoose.reuse(_jspx_th_c_005fchoose_005f1);
      return true;
    }
    _005fjspx_005ftagPool_005fc_005fchoose.reuse(_jspx_th_c_005fchoose_005f1);
    return false;
  }

  private boolean _jspx_meth_c_005fwhen_005f1(javax.servlet.jsp.tagext.JspTag _jspx_th_c_005fchoose_005f1, javax.servlet.jsp.PageContext _jspx_page_context, int[] _jspx_push_body_count_c_005fforEach_005f0)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:when
    org.apache.taglibs.standard.tag.rt.core.WhenTag _jspx_th_c_005fwhen_005f1 = (org.apache.taglibs.standard.tag.rt.core.WhenTag) _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.get(org.apache.taglibs.standard.tag.rt.core.WhenTag.class);
    _jspx_th_c_005fwhen_005f1.setPageContext(_jspx_page_context);
    _jspx_th_c_005fwhen_005f1.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_c_005fchoose_005f1);
    // /contact_management.jsp(228,68) name = test type = boolean reqTime = true required = true fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
    _jspx_th_c_005fwhen_005f1.setTest(((java.lang.Boolean) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${fn:length(message.message) > 50}", java.lang.Boolean.class, (javax.servlet.jsp.PageContext)_jspx_page_context, _jspx_fnmap_0, false)).booleanValue());
    int _jspx_eval_c_005fwhen_005f1 = _jspx_th_c_005fwhen_005f1.doStartTag();
    if (_jspx_eval_c_005fwhen_005f1 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
      do {
        out.write("\r\n");
        out.write("                                                                        ");
        out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${fn:substring(message.message, 0, 50)}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, _jspx_fnmap_1, false));
        out.write("...\r\n");
        out.write("                                                                    ");
        int evalDoAfterBody = _jspx_th_c_005fwhen_005f1.doAfterBody();
        if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
          break;
      } while (true);
    }
    if (_jspx_th_c_005fwhen_005f1.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.reuse(_jspx_th_c_005fwhen_005f1);
      return true;
    }
    _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.reuse(_jspx_th_c_005fwhen_005f1);
    return false;
  }

  private boolean _jspx_meth_c_005fotherwise_005f0(javax.servlet.jsp.tagext.JspTag _jspx_th_c_005fchoose_005f1, javax.servlet.jsp.PageContext _jspx_page_context, int[] _jspx_push_body_count_c_005fforEach_005f0)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:otherwise
    org.apache.taglibs.standard.tag.common.core.OtherwiseTag _jspx_th_c_005fotherwise_005f0 = (org.apache.taglibs.standard.tag.common.core.OtherwiseTag) _005fjspx_005ftagPool_005fc_005fotherwise.get(org.apache.taglibs.standard.tag.common.core.OtherwiseTag.class);
    _jspx_th_c_005fotherwise_005f0.setPageContext(_jspx_page_context);
    _jspx_th_c_005fotherwise_005f0.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_c_005fchoose_005f1);
    int _jspx_eval_c_005fotherwise_005f0 = _jspx_th_c_005fotherwise_005f0.doStartTag();
    if (_jspx_eval_c_005fotherwise_005f0 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
      do {
        out.write("\r\n");
        out.write("                                                                        ");
        out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.message}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
        out.write("\r\n");
        out.write("                                                                    ");
        int evalDoAfterBody = _jspx_th_c_005fotherwise_005f0.doAfterBody();
        if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
          break;
      } while (true);
    }
    if (_jspx_th_c_005fotherwise_005f0.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005fc_005fotherwise.reuse(_jspx_th_c_005fotherwise_005f0);
      return true;
    }
    _005fjspx_005ftagPool_005fc_005fotherwise.reuse(_jspx_th_c_005fotherwise_005f0);
    return false;
  }

  private boolean _jspx_meth_c_005fchoose_005f2(javax.servlet.jsp.tagext.JspTag _jspx_th_c_005fforEach_005f0, javax.servlet.jsp.PageContext _jspx_page_context, int[] _jspx_push_body_count_c_005fforEach_005f0)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:choose
    org.apache.taglibs.standard.tag.common.core.ChooseTag _jspx_th_c_005fchoose_005f2 = (org.apache.taglibs.standard.tag.common.core.ChooseTag) _005fjspx_005ftagPool_005fc_005fchoose.get(org.apache.taglibs.standard.tag.common.core.ChooseTag.class);
    _jspx_th_c_005fchoose_005f2.setPageContext(_jspx_page_context);
    _jspx_th_c_005fchoose_005f2.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_c_005fforEach_005f0);
    int _jspx_eval_c_005fchoose_005f2 = _jspx_th_c_005fchoose_005f2.doStartTag();
    if (_jspx_eval_c_005fchoose_005f2 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
      do {
        out.write("\r\n");
        out.write("                                                                    ");
        if (_jspx_meth_c_005fwhen_005f2(_jspx_th_c_005fchoose_005f2, _jspx_page_context, _jspx_push_body_count_c_005fforEach_005f0))
          return true;
        out.write("\r\n");
        out.write("                                                                    ");
        if (_jspx_meth_c_005fwhen_005f3(_jspx_th_c_005fchoose_005f2, _jspx_page_context, _jspx_push_body_count_c_005fforEach_005f0))
          return true;
        out.write("\r\n");
        out.write("                                                                    ");
        if (_jspx_meth_c_005fwhen_005f4(_jspx_th_c_005fchoose_005f2, _jspx_page_context, _jspx_push_body_count_c_005fforEach_005f0))
          return true;
        out.write("\r\n");
        out.write("                                                                    ");
        if (_jspx_meth_c_005fwhen_005f5(_jspx_th_c_005fchoose_005f2, _jspx_page_context, _jspx_push_body_count_c_005fforEach_005f0))
          return true;
        out.write("\r\n");
        out.write("                                                                    ");
        if (_jspx_meth_c_005fotherwise_005f1(_jspx_th_c_005fchoose_005f2, _jspx_page_context, _jspx_push_body_count_c_005fforEach_005f0))
          return true;
        out.write("\r\n");
        out.write("                                                                ");
        int evalDoAfterBody = _jspx_th_c_005fchoose_005f2.doAfterBody();
        if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
          break;
      } while (true);
    }
    if (_jspx_th_c_005fchoose_005f2.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005fc_005fchoose.reuse(_jspx_th_c_005fchoose_005f2);
      return true;
    }
    _005fjspx_005ftagPool_005fc_005fchoose.reuse(_jspx_th_c_005fchoose_005f2);
    return false;
  }

  private boolean _jspx_meth_c_005fwhen_005f2(javax.servlet.jsp.tagext.JspTag _jspx_th_c_005fchoose_005f2, javax.servlet.jsp.PageContext _jspx_page_context, int[] _jspx_push_body_count_c_005fforEach_005f0)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:when
    org.apache.taglibs.standard.tag.rt.core.WhenTag _jspx_th_c_005fwhen_005f2 = (org.apache.taglibs.standard.tag.rt.core.WhenTag) _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.get(org.apache.taglibs.standard.tag.rt.core.WhenTag.class);
    _jspx_th_c_005fwhen_005f2.setPageContext(_jspx_page_context);
    _jspx_th_c_005fwhen_005f2.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_c_005fchoose_005f2);
    // /contact_management.jsp(238,68) name = test type = boolean reqTime = true required = true fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
    _jspx_th_c_005fwhen_005f2.setTest(((java.lang.Boolean) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.status == 'new'}", java.lang.Boolean.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false)).booleanValue());
    int _jspx_eval_c_005fwhen_005f2 = _jspx_th_c_005fwhen_005f2.doStartTag();
    if (_jspx_eval_c_005fwhen_005f2 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
      do {
        out.write("\r\n");
        out.write("                                                                        <span class=\"label label-danger\">Mới</span>\r\n");
        out.write("                                                                    ");
        int evalDoAfterBody = _jspx_th_c_005fwhen_005f2.doAfterBody();
        if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
          break;
      } while (true);
    }
    if (_jspx_th_c_005fwhen_005f2.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.reuse(_jspx_th_c_005fwhen_005f2);
      return true;
    }
    _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.reuse(_jspx_th_c_005fwhen_005f2);
    return false;
  }

  private boolean _jspx_meth_c_005fwhen_005f3(javax.servlet.jsp.tagext.JspTag _jspx_th_c_005fchoose_005f2, javax.servlet.jsp.PageContext _jspx_page_context, int[] _jspx_push_body_count_c_005fforEach_005f0)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:when
    org.apache.taglibs.standard.tag.rt.core.WhenTag _jspx_th_c_005fwhen_005f3 = (org.apache.taglibs.standard.tag.rt.core.WhenTag) _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.get(org.apache.taglibs.standard.tag.rt.core.WhenTag.class);
    _jspx_th_c_005fwhen_005f3.setPageContext(_jspx_page_context);
    _jspx_th_c_005fwhen_005f3.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_c_005fchoose_005f2);
    // /contact_management.jsp(241,68) name = test type = boolean reqTime = true required = true fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
    _jspx_th_c_005fwhen_005f3.setTest(((java.lang.Boolean) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.status == 'read'}", java.lang.Boolean.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false)).booleanValue());
    int _jspx_eval_c_005fwhen_005f3 = _jspx_th_c_005fwhen_005f3.doStartTag();
    if (_jspx_eval_c_005fwhen_005f3 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
      do {
        out.write("\r\n");
        out.write("                                                                        <span class=\"label label-info\">Đã đọc</span>\r\n");
        out.write("                                                                    ");
        int evalDoAfterBody = _jspx_th_c_005fwhen_005f3.doAfterBody();
        if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
          break;
      } while (true);
    }
    if (_jspx_th_c_005fwhen_005f3.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.reuse(_jspx_th_c_005fwhen_005f3);
      return true;
    }
    _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.reuse(_jspx_th_c_005fwhen_005f3);
    return false;
  }

  private boolean _jspx_meth_c_005fwhen_005f4(javax.servlet.jsp.tagext.JspTag _jspx_th_c_005fchoose_005f2, javax.servlet.jsp.PageContext _jspx_page_context, int[] _jspx_push_body_count_c_005fforEach_005f0)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:when
    org.apache.taglibs.standard.tag.rt.core.WhenTag _jspx_th_c_005fwhen_005f4 = (org.apache.taglibs.standard.tag.rt.core.WhenTag) _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.get(org.apache.taglibs.standard.tag.rt.core.WhenTag.class);
    _jspx_th_c_005fwhen_005f4.setPageContext(_jspx_page_context);
    _jspx_th_c_005fwhen_005f4.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_c_005fchoose_005f2);
    // /contact_management.jsp(244,68) name = test type = boolean reqTime = true required = true fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
    _jspx_th_c_005fwhen_005f4.setTest(((java.lang.Boolean) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.status == 'replied'}", java.lang.Boolean.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false)).booleanValue());
    int _jspx_eval_c_005fwhen_005f4 = _jspx_th_c_005fwhen_005f4.doStartTag();
    if (_jspx_eval_c_005fwhen_005f4 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
      do {
        out.write("\r\n");
        out.write("                                                                        <span class=\"label label-success\">Đã liên hệ</span>\r\n");
        out.write("                                                                    ");
        int evalDoAfterBody = _jspx_th_c_005fwhen_005f4.doAfterBody();
        if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
          break;
      } while (true);
    }
    if (_jspx_th_c_005fwhen_005f4.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.reuse(_jspx_th_c_005fwhen_005f4);
      return true;
    }
    _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.reuse(_jspx_th_c_005fwhen_005f4);
    return false;
  }

  private boolean _jspx_meth_c_005fwhen_005f5(javax.servlet.jsp.tagext.JspTag _jspx_th_c_005fchoose_005f2, javax.servlet.jsp.PageContext _jspx_page_context, int[] _jspx_push_body_count_c_005fforEach_005f0)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:when
    org.apache.taglibs.standard.tag.rt.core.WhenTag _jspx_th_c_005fwhen_005f5 = (org.apache.taglibs.standard.tag.rt.core.WhenTag) _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.get(org.apache.taglibs.standard.tag.rt.core.WhenTag.class);
    _jspx_th_c_005fwhen_005f5.setPageContext(_jspx_page_context);
    _jspx_th_c_005fwhen_005f5.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_c_005fchoose_005f2);
    // /contact_management.jsp(247,68) name = test type = boolean reqTime = true required = true fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
    _jspx_th_c_005fwhen_005f5.setTest(((java.lang.Boolean) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.status == 'converted'}", java.lang.Boolean.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false)).booleanValue());
    int _jspx_eval_c_005fwhen_005f5 = _jspx_th_c_005fwhen_005f5.doStartTag();
    if (_jspx_eval_c_005fwhen_005f5 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
      do {
        out.write("\r\n");
        out.write("                                                                        <span class=\"label label-primary\">Đã chuyển đổi</span>\r\n");
        out.write("                                                                    ");
        int evalDoAfterBody = _jspx_th_c_005fwhen_005f5.doAfterBody();
        if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
          break;
      } while (true);
    }
    if (_jspx_th_c_005fwhen_005f5.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.reuse(_jspx_th_c_005fwhen_005f5);
      return true;
    }
    _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.reuse(_jspx_th_c_005fwhen_005f5);
    return false;
  }

  private boolean _jspx_meth_c_005fotherwise_005f1(javax.servlet.jsp.tagext.JspTag _jspx_th_c_005fchoose_005f2, javax.servlet.jsp.PageContext _jspx_page_context, int[] _jspx_push_body_count_c_005fforEach_005f0)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:otherwise
    org.apache.taglibs.standard.tag.common.core.OtherwiseTag _jspx_th_c_005fotherwise_005f1 = (org.apache.taglibs.standard.tag.common.core.OtherwiseTag) _005fjspx_005ftagPool_005fc_005fotherwise.get(org.apache.taglibs.standard.tag.common.core.OtherwiseTag.class);
    _jspx_th_c_005fotherwise_005f1.setPageContext(_jspx_page_context);
    _jspx_th_c_005fotherwise_005f1.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_c_005fchoose_005f2);
    int _jspx_eval_c_005fotherwise_005f1 = _jspx_th_c_005fotherwise_005f1.doStartTag();
    if (_jspx_eval_c_005fotherwise_005f1 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
      do {
        out.write("\r\n");
        out.write("                                                                        <span class=\"label label-default\">");
        out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.status}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
        out.write("</span>\r\n");
        out.write("                                                                    ");
        int evalDoAfterBody = _jspx_th_c_005fotherwise_005f1.doAfterBody();
        if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
          break;
      } while (true);
    }
    if (_jspx_th_c_005fotherwise_005f1.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005fc_005fotherwise.reuse(_jspx_th_c_005fotherwise_005f1);
      return true;
    }
    _005fjspx_005ftagPool_005fc_005fotherwise.reuse(_jspx_th_c_005fotherwise_005f1);
    return false;
  }

  private boolean _jspx_meth_fmt_005fformatDate_005f0(javax.servlet.jsp.tagext.JspTag _jspx_th_c_005fforEach_005f0, javax.servlet.jsp.PageContext _jspx_page_context, int[] _jspx_push_body_count_c_005fforEach_005f0)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  fmt:formatDate
    org.apache.taglibs.standard.tag.rt.fmt.FormatDateTag _jspx_th_fmt_005fformatDate_005f0 = (org.apache.taglibs.standard.tag.rt.fmt.FormatDateTag) _005fjspx_005ftagPool_005ffmt_005fformatDate_0026_005fvalue_005fpattern_005fnobody.get(org.apache.taglibs.standard.tag.rt.fmt.FormatDateTag.class);
    _jspx_th_fmt_005fformatDate_005f0.setPageContext(_jspx_page_context);
    _jspx_th_fmt_005fformatDate_005f0.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_c_005fforEach_005f0);
    // /contact_management.jsp(256,64) name = value type = null reqTime = true required = true fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
    _jspx_th_fmt_005fformatDate_005f0.setValue((java.util.Date) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.createdAt}", java.util.Date.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
    // /contact_management.jsp(256,64) name = pattern type = null reqTime = true required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
    _jspx_th_fmt_005fformatDate_005f0.setPattern("dd/MM/yyyy HH:mm");
    int _jspx_eval_fmt_005fformatDate_005f0 = _jspx_th_fmt_005fformatDate_005f0.doStartTag();
    if (_jspx_th_fmt_005fformatDate_005f0.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005ffmt_005fformatDate_0026_005fvalue_005fpattern_005fnobody.reuse(_jspx_th_fmt_005fformatDate_005f0);
      return true;
    }
    _005fjspx_005ftagPool_005ffmt_005fformatDate_0026_005fvalue_005fpattern_005fnobody.reuse(_jspx_th_fmt_005fformatDate_005f0);
    return false;
  }

  private boolean _jspx_meth_c_005fchoose_005f3(javax.servlet.jsp.tagext.JspTag _jspx_th_c_005fforEach_005f0, javax.servlet.jsp.PageContext _jspx_page_context, int[] _jspx_push_body_count_c_005fforEach_005f0)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:choose
    org.apache.taglibs.standard.tag.common.core.ChooseTag _jspx_th_c_005fchoose_005f3 = (org.apache.taglibs.standard.tag.common.core.ChooseTag) _005fjspx_005ftagPool_005fc_005fchoose.get(org.apache.taglibs.standard.tag.common.core.ChooseTag.class);
    _jspx_th_c_005fchoose_005f3.setPageContext(_jspx_page_context);
    _jspx_th_c_005fchoose_005f3.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_c_005fforEach_005f0);
    int _jspx_eval_c_005fchoose_005f3 = _jspx_th_c_005fchoose_005f3.doStartTag();
    if (_jspx_eval_c_005fchoose_005f3 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
      do {
        out.write("\r\n");
        out.write("                                                                    ");
        if (_jspx_meth_c_005fwhen_005f6(_jspx_th_c_005fchoose_005f3, _jspx_page_context, _jspx_push_body_count_c_005fforEach_005f0))
          return true;
        out.write("\r\n");
        out.write("                                                                    ");
        if (_jspx_meth_c_005fotherwise_005f2(_jspx_th_c_005fchoose_005f3, _jspx_page_context, _jspx_push_body_count_c_005fforEach_005f0))
          return true;
        out.write("\r\n");
        out.write("                                                                ");
        int evalDoAfterBody = _jspx_th_c_005fchoose_005f3.doAfterBody();
        if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
          break;
      } while (true);
    }
    if (_jspx_th_c_005fchoose_005f3.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005fc_005fchoose.reuse(_jspx_th_c_005fchoose_005f3);
      return true;
    }
    _005fjspx_005ftagPool_005fc_005fchoose.reuse(_jspx_th_c_005fchoose_005f3);
    return false;
  }

  private boolean _jspx_meth_c_005fwhen_005f6(javax.servlet.jsp.tagext.JspTag _jspx_th_c_005fchoose_005f3, javax.servlet.jsp.PageContext _jspx_page_context, int[] _jspx_push_body_count_c_005fforEach_005f0)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:when
    org.apache.taglibs.standard.tag.rt.core.WhenTag _jspx_th_c_005fwhen_005f6 = (org.apache.taglibs.standard.tag.rt.core.WhenTag) _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.get(org.apache.taglibs.standard.tag.rt.core.WhenTag.class);
    _jspx_th_c_005fwhen_005f6.setPageContext(_jspx_page_context);
    _jspx_th_c_005fwhen_005f6.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_c_005fchoose_005f3);
    // /contact_management.jsp(260,68) name = test type = boolean reqTime = true required = true fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
    _jspx_th_c_005fwhen_005f6.setTest(((java.lang.Boolean) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${not empty message.repliedAt}", java.lang.Boolean.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false)).booleanValue());
    int _jspx_eval_c_005fwhen_005f6 = _jspx_th_c_005fwhen_005f6.doStartTag();
    if (_jspx_eval_c_005fwhen_005f6 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
      do {
        out.write("\r\n");
        out.write("                                                                        ");
        if (_jspx_meth_fmt_005fformatDate_005f1(_jspx_th_c_005fwhen_005f6, _jspx_page_context, _jspx_push_body_count_c_005fforEach_005f0))
          return true;
        out.write("\r\n");
        out.write("                                                                    ");
        int evalDoAfterBody = _jspx_th_c_005fwhen_005f6.doAfterBody();
        if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
          break;
      } while (true);
    }
    if (_jspx_th_c_005fwhen_005f6.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.reuse(_jspx_th_c_005fwhen_005f6);
      return true;
    }
    _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.reuse(_jspx_th_c_005fwhen_005f6);
    return false;
  }

  private boolean _jspx_meth_fmt_005fformatDate_005f1(javax.servlet.jsp.tagext.JspTag _jspx_th_c_005fwhen_005f6, javax.servlet.jsp.PageContext _jspx_page_context, int[] _jspx_push_body_count_c_005fforEach_005f0)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  fmt:formatDate
    org.apache.taglibs.standard.tag.rt.fmt.FormatDateTag _jspx_th_fmt_005fformatDate_005f1 = (org.apache.taglibs.standard.tag.rt.fmt.FormatDateTag) _005fjspx_005ftagPool_005ffmt_005fformatDate_0026_005fvalue_005fpattern_005fnobody.get(org.apache.taglibs.standard.tag.rt.fmt.FormatDateTag.class);
    _jspx_th_fmt_005fformatDate_005f1.setPageContext(_jspx_page_context);
    _jspx_th_fmt_005fformatDate_005f1.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_c_005fwhen_005f6);
    // /contact_management.jsp(261,72) name = value type = null reqTime = true required = true fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
    _jspx_th_fmt_005fformatDate_005f1.setValue((java.util.Date) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.repliedAt}", java.util.Date.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
    // /contact_management.jsp(261,72) name = pattern type = null reqTime = true required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
    _jspx_th_fmt_005fformatDate_005f1.setPattern("dd/MM/yyyy HH:mm");
    int _jspx_eval_fmt_005fformatDate_005f1 = _jspx_th_fmt_005fformatDate_005f1.doStartTag();
    if (_jspx_th_fmt_005fformatDate_005f1.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005ffmt_005fformatDate_0026_005fvalue_005fpattern_005fnobody.reuse(_jspx_th_fmt_005fformatDate_005f1);
      return true;
    }
    _005fjspx_005ftagPool_005ffmt_005fformatDate_0026_005fvalue_005fpattern_005fnobody.reuse(_jspx_th_fmt_005fformatDate_005f1);
    return false;
  }

  private boolean _jspx_meth_c_005fotherwise_005f2(javax.servlet.jsp.tagext.JspTag _jspx_th_c_005fchoose_005f3, javax.servlet.jsp.PageContext _jspx_page_context, int[] _jspx_push_body_count_c_005fforEach_005f0)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:otherwise
    org.apache.taglibs.standard.tag.common.core.OtherwiseTag _jspx_th_c_005fotherwise_005f2 = (org.apache.taglibs.standard.tag.common.core.OtherwiseTag) _005fjspx_005ftagPool_005fc_005fotherwise.get(org.apache.taglibs.standard.tag.common.core.OtherwiseTag.class);
    _jspx_th_c_005fotherwise_005f2.setPageContext(_jspx_page_context);
    _jspx_th_c_005fotherwise_005f2.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_c_005fchoose_005f3);
    int _jspx_eval_c_005fotherwise_005f2 = _jspx_th_c_005fotherwise_005f2.doStartTag();
    if (_jspx_eval_c_005fotherwise_005f2 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
      do {
        out.write("\r\n");
        out.write("                                                                        <span class=\"text-muted\">-</span>\r\n");
        out.write("                                                                    ");
        int evalDoAfterBody = _jspx_th_c_005fotherwise_005f2.doAfterBody();
        if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
          break;
      } while (true);
    }
    if (_jspx_th_c_005fotherwise_005f2.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005fc_005fotherwise.reuse(_jspx_th_c_005fotherwise_005f2);
      return true;
    }
    _005fjspx_005ftagPool_005fc_005fotherwise.reuse(_jspx_th_c_005fotherwise_005f2);
    return false;
  }

  private boolean _jspx_meth_c_005fchoose_005f4(javax.servlet.jsp.tagext.JspTag _jspx_th_c_005fforEach_005f0, javax.servlet.jsp.PageContext _jspx_page_context, int[] _jspx_push_body_count_c_005fforEach_005f0)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:choose
    org.apache.taglibs.standard.tag.common.core.ChooseTag _jspx_th_c_005fchoose_005f4 = (org.apache.taglibs.standard.tag.common.core.ChooseTag) _005fjspx_005ftagPool_005fc_005fchoose.get(org.apache.taglibs.standard.tag.common.core.ChooseTag.class);
    _jspx_th_c_005fchoose_005f4.setPageContext(_jspx_page_context);
    _jspx_th_c_005fchoose_005f4.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_c_005fforEach_005f0);
    int _jspx_eval_c_005fchoose_005f4 = _jspx_th_c_005fchoose_005f4.doStartTag();
    if (_jspx_eval_c_005fchoose_005f4 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
      do {
        out.write("\r\n");
        out.write("                                                                    ");
        if (_jspx_meth_c_005fwhen_005f7(_jspx_th_c_005fchoose_005f4, _jspx_page_context, _jspx_push_body_count_c_005fforEach_005f0))
          return true;
        out.write("\r\n");
        out.write("                                                                    ");
        if (_jspx_meth_c_005fwhen_005f8(_jspx_th_c_005fchoose_005f4, _jspx_page_context, _jspx_push_body_count_c_005fforEach_005f0))
          return true;
        out.write("\r\n");
        out.write("                                                                    ");
        if (_jspx_meth_c_005fotherwise_005f3(_jspx_th_c_005fchoose_005f4, _jspx_page_context, _jspx_push_body_count_c_005fforEach_005f0))
          return true;
        out.write("\r\n");
        out.write("                                                                ");
        int evalDoAfterBody = _jspx_th_c_005fchoose_005f4.doAfterBody();
        if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
          break;
      } while (true);
    }
    if (_jspx_th_c_005fchoose_005f4.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005fc_005fchoose.reuse(_jspx_th_c_005fchoose_005f4);
      return true;
    }
    _005fjspx_005ftagPool_005fc_005fchoose.reuse(_jspx_th_c_005fchoose_005f4);
    return false;
  }

  private boolean _jspx_meth_c_005fwhen_005f7(javax.servlet.jsp.tagext.JspTag _jspx_th_c_005fchoose_005f4, javax.servlet.jsp.PageContext _jspx_page_context, int[] _jspx_push_body_count_c_005fforEach_005f0)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:when
    org.apache.taglibs.standard.tag.rt.core.WhenTag _jspx_th_c_005fwhen_005f7 = (org.apache.taglibs.standard.tag.rt.core.WhenTag) _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.get(org.apache.taglibs.standard.tag.rt.core.WhenTag.class);
    _jspx_th_c_005fwhen_005f7.setPageContext(_jspx_page_context);
    _jspx_th_c_005fwhen_005f7.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_c_005fchoose_005f4);
    // /contact_management.jsp(281,68) name = test type = boolean reqTime = true required = true fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
    _jspx_th_c_005fwhen_005f7.setTest(((java.lang.Boolean) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.status == 'replied'}", java.lang.Boolean.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false)).booleanValue());
    int _jspx_eval_c_005fwhen_005f7 = _jspx_th_c_005fwhen_005f7.doStartTag();
    if (_jspx_eval_c_005fwhen_005f7 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
      do {
        out.write("\r\n");
        out.write("                                                                        <button class=\"btn btn-success btn-xs\" disabled title=\"Đã liên hệ\" style=\"cursor: not-allowed;\">\r\n");
        out.write("                                                                            <i class=\"fa fa-check\"></i> Đã liên hệ\r\n");
        out.write("                                                                        </button>\r\n");
        out.write("                                                                    ");
        int evalDoAfterBody = _jspx_th_c_005fwhen_005f7.doAfterBody();
        if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
          break;
      } while (true);
    }
    if (_jspx_th_c_005fwhen_005f7.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.reuse(_jspx_th_c_005fwhen_005f7);
      return true;
    }
    _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.reuse(_jspx_th_c_005fwhen_005f7);
    return false;
  }

  private boolean _jspx_meth_c_005fwhen_005f8(javax.servlet.jsp.tagext.JspTag _jspx_th_c_005fchoose_005f4, javax.servlet.jsp.PageContext _jspx_page_context, int[] _jspx_push_body_count_c_005fforEach_005f0)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:when
    org.apache.taglibs.standard.tag.rt.core.WhenTag _jspx_th_c_005fwhen_005f8 = (org.apache.taglibs.standard.tag.rt.core.WhenTag) _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.get(org.apache.taglibs.standard.tag.rt.core.WhenTag.class);
    _jspx_th_c_005fwhen_005f8.setPageContext(_jspx_page_context);
    _jspx_th_c_005fwhen_005f8.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_c_005fchoose_005f4);
    // /contact_management.jsp(286,68) name = test type = boolean reqTime = true required = true fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null
    _jspx_th_c_005fwhen_005f8.setTest(((java.lang.Boolean) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.status == 'converted'}", java.lang.Boolean.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false)).booleanValue());
    int _jspx_eval_c_005fwhen_005f8 = _jspx_th_c_005fwhen_005f8.doStartTag();
    if (_jspx_eval_c_005fwhen_005f8 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
      do {
        out.write("\r\n");
        out.write("                                                                        <!-- Không hiển thị nút \"Đã liên hệ\" khi trạng thái là \"converted\" -->\r\n");
        out.write("                                                                    ");
        int evalDoAfterBody = _jspx_th_c_005fwhen_005f8.doAfterBody();
        if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
          break;
      } while (true);
    }
    if (_jspx_th_c_005fwhen_005f8.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.reuse(_jspx_th_c_005fwhen_005f8);
      return true;
    }
    _005fjspx_005ftagPool_005fc_005fwhen_0026_005ftest.reuse(_jspx_th_c_005fwhen_005f8);
    return false;
  }

  private boolean _jspx_meth_c_005fotherwise_005f3(javax.servlet.jsp.tagext.JspTag _jspx_th_c_005fchoose_005f4, javax.servlet.jsp.PageContext _jspx_page_context, int[] _jspx_push_body_count_c_005fforEach_005f0)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:otherwise
    org.apache.taglibs.standard.tag.common.core.OtherwiseTag _jspx_th_c_005fotherwise_005f3 = (org.apache.taglibs.standard.tag.common.core.OtherwiseTag) _005fjspx_005ftagPool_005fc_005fotherwise.get(org.apache.taglibs.standard.tag.common.core.OtherwiseTag.class);
    _jspx_th_c_005fotherwise_005f3.setPageContext(_jspx_page_context);
    _jspx_th_c_005fotherwise_005f3.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_c_005fchoose_005f4);
    int _jspx_eval_c_005fotherwise_005f3 = _jspx_th_c_005fotherwise_005f3.doStartTag();
    if (_jspx_eval_c_005fotherwise_005f3 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
      do {
        out.write("\r\n");
        out.write("                                                                        <button class=\"btn btn-primary btn-xs mark-replied-btn\" data-message-id=\"");
        out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${message.id}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
        out.write("\" title=\"Đánh dấu đã liên hệ\">\r\n");
        out.write("                                                                            <i class=\"fa fa-reply\"></i> Đã liên hệ\r\n");
        out.write("                                                                        </button>\r\n");
        out.write("                                                                    ");
        int evalDoAfterBody = _jspx_th_c_005fotherwise_005f3.doAfterBody();
        if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
          break;
      } while (true);
    }
    if (_jspx_th_c_005fotherwise_005f3.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005fc_005fotherwise.reuse(_jspx_th_c_005fotherwise_005f3);
      return true;
    }
    _005fjspx_005ftagPool_005fc_005fotherwise.reuse(_jspx_th_c_005fotherwise_005f3);
    return false;
  }

  private boolean _jspx_meth_c_005fotherwise_005f4(javax.servlet.jsp.tagext.JspTag _jspx_th_c_005fchoose_005f0, javax.servlet.jsp.PageContext _jspx_page_context)
          throws java.lang.Throwable {
    javax.servlet.jsp.PageContext pageContext = _jspx_page_context;
    javax.servlet.jsp.JspWriter out = _jspx_page_context.getOut();
    //  c:otherwise
    org.apache.taglibs.standard.tag.common.core.OtherwiseTag _jspx_th_c_005fotherwise_005f4 = (org.apache.taglibs.standard.tag.common.core.OtherwiseTag) _005fjspx_005ftagPool_005fc_005fotherwise.get(org.apache.taglibs.standard.tag.common.core.OtherwiseTag.class);
    _jspx_th_c_005fotherwise_005f4.setPageContext(_jspx_page_context);
    _jspx_th_c_005fotherwise_005f4.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_c_005fchoose_005f0);
    int _jspx_eval_c_005fotherwise_005f4 = _jspx_th_c_005fotherwise_005f4.doStartTag();
    if (_jspx_eval_c_005fotherwise_005f4 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {
      do {
        out.write("\r\n");
        out.write("                                                    <tr>\r\n");
        out.write("                                                        <td colspan=\"9\" class=\"text-center\">\r\n");
        out.write("                                                            <p class=\"text-muted\">Không có tin nhắn nào.</p>\r\n");
        out.write("                                                        </td>\r\n");
        out.write("                                                    </tr>\r\n");
        out.write("                                                ");
        int evalDoAfterBody = _jspx_th_c_005fotherwise_005f4.doAfterBody();
        if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)
          break;
      } while (true);
    }
    if (_jspx_th_c_005fotherwise_005f4.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {
      _005fjspx_005ftagPool_005fc_005fotherwise.reuse(_jspx_th_c_005fotherwise_005f4);
      return true;
    }
    _005fjspx_005ftagPool_005fc_005fotherwise.reuse(_jspx_th_c_005fotherwise_005f4);
    return false;
  }
}
