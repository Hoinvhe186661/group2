/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.47
 * Generated at: 2025-10-02 13:29:51 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.customer;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;

public final class hotro_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n");
      out.write("<!DOCTYPE html>\r\n");
      out.write("<html lang=\"vi\">\r\n");
      out.write("<head>\r\n");
      out.write("    <meta charset=\"UTF-8\">\r\n");
      out.write("    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n");
      out.write("    <title>Công ty CP Chế tạo máy Hoà Lạc - Chuyên cung cấp máy phát điện chính hãng</title>\r\n");
      out.write("    <link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css\" rel=\"stylesheet\">\r\n");
      out.write("    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n");
      out.write("    <link href=\"https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap\" rel=\"stylesheet\">\r\n");
      out.write("    <link rel=\"stylesheet\" href=\"css/styles.css\"/>\r\n");
      out.write("    </head>\r\n");
      out.write("    <body>\r\n");
      out.write("    <!-- Top Header -->\r\n");
      out.write("    <div class=\"top-header\">\r\n");
      out.write("        <div class=\"container\">\r\n");
      out.write("            <div class=\"row align-items-center\">\r\n");
      out.write("                <div class=\"col-md-6\">\r\n");
      out.write("                    <span class=\"header-text\">MÁY PHÁT ĐIỆN CÔNG NGHIỆP</span>\r\n");
      out.write("                </div>\r\n");
      out.write("                <div class=\"col-md-6 text-end\">\r\n");
      out.write("                    <span class=\"contact-info\">\r\n");
      out.write("                        <i class=\"fas fa-envelope\"></i> Mayphatdienhoalac@gmail.com\r\n");
      out.write("                    </span>\r\n");
      out.write("                    <span class=\"contact-info\">\r\n");
      out.write("                        <i class=\"fas fa-clock\"></i> 08:00 - 17:00\r\n");
      out.write("                    </span>\r\n");
      out.write("                </div>\r\n");
      out.write("            </div>\r\n");
      out.write("        </div>\r\n");
      out.write("    </div>\r\n");
      out.write("\r\n");
      out.write("    <!-- Navigation -->\r\n");
      out.write("    <nav class=\"navbar navbar-expand-lg navbar-light bg-white\">\r\n");
      out.write("    <div class=\"container flex-column align-items-start\">\r\n");
      out.write("        <div class=\"d-flex w-100 justify-content-between align-items-center\">\r\n");
      out.write("            <a class=\"navbar-brand\" href=\"#\">\r\n");
      out.write("                <div class=\"logo-container\">\r\n");
      out.write("                    <div class=\"logo-icon\">\r\n");
      out.write("                        <img src=\"images/logo.png\" alt=\"Logo Hoà Lạc\" onerror=\"this.style.display='none'; this.nextElementSibling.style.display='flex';\">\r\n");
      out.write("                        <div style=\"display:none; width:100%; height:100%; background:var(--primary-red); border-radius:50%; align-items:center; justify-content:center; color:white; font-size:20px;\">★</div>\r\n");
      out.write("                    </div>\r\n");
      out.write("                    <div class=\"logo-text\">\r\n");
      out.write("                        <strong>HOÀ LẠC ELECTRIC INDUSTRIAL GENERATOR</strong>\r\n");
      out.write("                    </div>\r\n");
      out.write("                </div>\r\n");
      out.write("            </a>\r\n");
      out.write("            <div class=\"search-container\">\r\n");
      out.write("                <input type=\"text\" class=\"search-input\" placeholder=\"Tìm kiếm...\">\r\n");
      out.write("                <i class=\"fas fa-search search-icon\"></i>\r\n");
      out.write("            </div>\r\n");
      out.write("            <div class=\"contact-info-nav\">\r\n");
      out.write("                <div class=\"phone-number\">\r\n");
      out.write("                    <i class=\"fas fa-phone\"></i> 0989.888.999\r\n");
      out.write("                </div>\r\n");
      out.write("                <div class=\"nav-icons\">\r\n");
      out.write("                    <i class=\"fas fa-user\"></i>\r\n");
      out.write("                    <i class=\"fas fa-shopping-bag\"></i>\r\n");
      out.write("                </div>\r\n");
      out.write("            </div>\r\n");
      out.write("            <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#navbarNav\">\r\n");
      out.write("                <span class=\"navbar-toggler-icon\"></span>\r\n");
      out.write("            </button>\r\n");
      out.write("        </div>\r\n");
      out.write("        <div class=\"collapse navbar-collapse w-100\" id=\"navbarNav\">\r\n");
      out.write("            <ul class=\"navbar-nav w-100 justify-content-center mt-3\">\r\n");
      out.write("                <li class=\"nav-item\">\r\n");
      out.write("                    <a class=\"nav-link active\" href=\"#home\">TRANG CHỦ</a>\r\n");
      out.write("                </li>\r\n");
      out.write("                <li class=\"nav-item\">\r\n");
      out.write("                    <a class=\"nav-link\" href=\"#customer.jsp\">GIỚI THIỆU</a>\r\n");
      out.write("                </li>\r\n");
      out.write("                <li class=\"nav-item\">\r\n");
      out.write("                    <a class=\"nav-link\" href=\"#products\">MÁY PHÁT ĐIỆN</a>\r\n");
      out.write("                </li>\r\n");
      out.write("                <li class=\"nav-item\">\r\n");
      out.write("                    <a class=\"nav-link\" href=\"#services\">DỊCH VỤ</a>\r\n");
      out.write("                </li>\r\n");
      out.write("                <li class=\"nav-item dropdown\">\r\n");
      out.write("                    <a class=\"nav-link dropdown-toggle\" href=\"#projects\">DỰ ÁN</a>\r\n");
      out.write("                </li>\r\n");
      out.write("                <li class=\"nav-item\">\r\n");
      out.write("                    <a class=\"nav-link\" href=\"#guide\">HƯỚNG DẪN</a>\r\n");
      out.write("                </li>\r\n");
      out.write("                <li class=\"nav-item\">\r\n");
      out.write("                    <a class=\"nav-link\" href=\"#news\">TIN TỨC</a>\r\n");
      out.write("                </li>\r\n");
      out.write("                <li class=\"nav-item\">\r\n");
      out.write("                    <a class=\"nav-link\" href=\"#contact\">LIÊN HỆ</a>\r\n");
      out.write("                </li>\r\n");
      out.write("                <li class=\"nav-item dropdown\">\r\n");
      out.write("                    <a class=\"nav-link dropdown-toggle\" href=\"#\" id=\"supportDropdown\" role=\"button\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n");
      out.write("                        HỖ TRỢ\r\n");
      out.write("                    </a>\r\n");
      out.write("                    <ul class=\"dropdown-menu\" aria-labelledby=\"supportDropdown\">\r\n");
      out.write("                        <li><a class=\"dropdown-item\" href=\"hotro.jsp\">Tạo yêu cầu</a></li>\r\n");
      out.write("                    </ul>\r\n");
      out.write("                </li>\r\n");
      out.write("            </ul>\r\n");
      out.write("        </div>\r\n");
      out.write("    </div>\r\n");
      out.write("</nav>\r\n");
      out.write("\r\n");
      out.write("    \r\n");
      out.write("    <!-- Floating Social Icons -->\r\n");
      out.write("    <div class=\"floating-icons\">\r\n");
      out.write("        <div class=\"floating-icon facebook\">\r\n");
      out.write("            <i class=\"fab fa-facebook-f\"></i>\r\n");
      out.write("                    </div>\r\n");
      out.write("        <div class=\"floating-icon zalo\">\r\n");
      out.write("            <i class=\"fas fa-comments\"></i>\r\n");
      out.write("                </div>\r\n");
      out.write("        <div class=\"floating-icon phone\">\r\n");
      out.write("            <i class=\"fas fa-phone\"></i>\r\n");
      out.write("                        </div>\r\n");
      out.write("                    </div>\r\n");
      out.write("\r\n");
      out.write("    <div class=\"container mt-4\">\r\n");
      out.write("    <div class=\"support-header mb-3 d-flex justify-content-between align-items-center\">\r\n");
      out.write("        <div>\r\n");
      out.write("            <h4 class=\"support-title\">Yêu cầu hỗ trợ</h4>\r\n");
      out.write("            <a href=\"#\" class=\"create-request-link\" data-bs-toggle=\"modal\" data-bs-target=\"#supportModal\">Tạo yêu cầu mới +</a>\r\n");
      out.write("        </div>\r\n");
      out.write("        <div class=\"support-search\">\r\n");
      out.write("            <input type=\"text\" class=\"form-control\" placeholder=\"Tìm kiếm...\">\r\n");
      out.write("        </div>\r\n");
      out.write("    </div>\r\n");
      out.write("    <div class=\"table-responsive\">\r\n");
      out.write("        <table class=\"table support-table align-middle\">\r\n");
      out.write("            <thead>\r\n");
      out.write("                <tr>\r\n");
      out.write("                    <th>ID</th>\r\n");
      out.write("                    <th>Loại yêu cầu</th>\r\n");
      out.write("                    <th>Độ ưu tiên</th>\r\n");
      out.write("                    <th>Chi tiết vấn đề</th>\r\n");
      out.write("                    <th>Ngày tạo</th>\r\n");
      out.write("                    <th>Trạng thái</th>\r\n");
      out.write("                    <th>Thao tác</th>\r\n");
      out.write("                </tr>\r\n");
      out.write("            </thead>\r\n");
      out.write("            <tbody id=\"supportRows\"></tbody>\r\n");
      out.write("        </table>\r\n");
      out.write("    </div>\r\n");
      out.write("    <div class=\"d-flex justify-content-end mt-2\">\r\n");
      out.write("        <nav>\r\n");
      out.write("            <ul class=\"pagination custom-pagination mb-0\">\r\n");
      out.write("                <li class=\"page-item\"><a class=\"page-link\" href=\"#\">Trước</a></li>\r\n");
      out.write("                <li class=\"page-item active\"><a class=\"page-link\" href=\"#\">1</a></li>\r\n");
      out.write("                <li class=\"page-item\"><a class=\"page-link\" href=\"#\">Tiếp</a></li>\r\n");
      out.write("            </ul>\r\n");
      out.write("        </nav>\r\n");
      out.write("    </div>\r\n");
      out.write("</div>\r\n");
      out.write("\r\n");
      out.write("    <!-- Modal Yêu cầu hỗ trợ -->\r\n");
      out.write("<div class=\"modal fade\" id=\"supportModal\" tabindex=\"-1\" aria-labelledby=\"supportModalLabel\" aria-hidden=\"true\">\r\n");
      out.write("  <div class=\"modal-dialog\">\r\n");
      out.write("    <div class=\"modal-content\" style=\"border-radius:30px;\">\r\n");
      out.write("      <div class=\"modal-header\">\r\n");
      out.write("        <h5 class=\"modal-title\" id=\"supportModalLabel\">Yêu cầu hỗ trợ</h5>\r\n");
      out.write("        <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Đóng\"></button>\r\n");
      out.write("      </div>\r\n");
      out.write("      <div class=\"modal-body\">\r\n");
      out.write("        <form id=\"supportForm\">\r\n");
      out.write("          <div class=\"row mb-2\">\r\n");
      out.write("            <div class=\"col-6\">\r\n");
      out.write("              <label>Tên/Code khách hàng :</label>\r\n");
      out.write("              <input type=\"text\" class=\"form-control\" id=\"customerId\" placeholder=\"Nhập ID khách hàng\">\r\n");
      out.write("            </div>\r\n");
      out.write("            <div class=\"col-6\">\r\n");
      out.write("              <label>Email:</label>\r\n");
      out.write("              <input type=\"email\" class=\"form-control\" id=\"email\">\r\n");
      out.write("            </div>\r\n");
      out.write("          </div>\r\n");
      out.write("          <div class=\"mb-2\">\r\n");
      out.write("            <label>Tiêu đề:</label>\r\n");
      out.write("            <input type=\"text\" class=\"form-control\" id=\"subject\" placeholder=\"Nhập tiêu đề\">\r\n");
      out.write("          </div>\r\n");
      out.write("          <div class=\"mb-2\">\r\n");
      out.write("            <label>Loại yêu cầu :</label>\r\n");
      out.write("            <select class=\"form-control\" id=\"category\">\r\n");
      out.write("                <option value=\"technical\">Kỹ thuật</option>\r\n");
      out.write("                <option value=\"billing\">Thanh toán</option>\r\n");
      out.write("                <option value=\"general\" selected>Chung</option>\r\n");
      out.write("                <option value=\"complaint\">Khiếu nại</option>\r\n");
      out.write("            </select>\r\n");
      out.write("          </div>\r\n");
      out.write("          <div class=\"mb-2\">\r\n");
      out.write("            <label>Mức độ ưu tiên :</label>\r\n");
      out.write("            <select class=\"form-control\" id=\"priority\">\r\n");
      out.write("              <option value=\"urgent\">Cao</option>\r\n");
      out.write("              <option value=\"high\">Trung bình</option>\r\n");
      out.write("              <option value=\"medium\" selected>Thường</option>\r\n");
      out.write("              <option value=\"low\">Thấp</option>\r\n");
      out.write("            </select>\r\n");
      out.write("          </div>\r\n");
      out.write("          <div class=\"mb-2\">\r\n");
      out.write("            <label>Ngày tạo :</label>\r\n");
      out.write("            <input type=\"date\" class=\"form-control\" id=\"createdDate\" readonly>\r\n");
      out.write("          </div>\r\n");
      out.write("          <div class=\"mb-2\">\r\n");
      out.write("            <label>Chi tiết vấn đề :</label>\r\n");
      out.write("            <textarea class=\"form-control\" id=\"description\"></textarea>\r\n");
      out.write("          </div>\r\n");
      out.write("          <div class=\"text-end mt-3\">\r\n");
      out.write("            <button type=\"submit\" class=\"btn btn-success\" id=\"submitBtn\">Xác nhận</button>\r\n");
      out.write("            <button type=\"button\" class=\"btn btn-danger\" data-bs-dismiss=\"modal\">Hủy bỏ</button>\r\n");
      out.write("          </div>\r\n");
      out.write("        </form>\r\n");
      out.write("      </div>\r\n");
      out.write("    </div>\r\n");
      out.write("  </div>\r\n");
      out.write("</div>\r\n");
      out.write("\r\n");
      out.write("<!-- Modal xem chi tiết yêu cầu -->\r\n");
      out.write("<div class=\"modal fade\" id=\"viewModal\" tabindex=\"-1\" aria-hidden=\"true\">\r\n");
      out.write("  <div class=\"modal-dialog modal-lg\">\r\n");
      out.write("    <div class=\"modal-content\" style=\"border-radius:20px;\">\r\n");
      out.write("      <div class=\"modal-header\">\r\n");
      out.write("        <h5 class=\"modal-title\">Chi tiết yêu cầu hỗ trợ</h5>\r\n");
      out.write("        <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Đóng\"></button>\r\n");
      out.write("      </div>\r\n");
      out.write("      <div class=\"modal-body\">\r\n");
      out.write("        <div class=\"row g-3\">\r\n");
      out.write("          <div class=\"col-md-6\"><label>Mã ticket</label><div id=\"v_ticket\" class=\"form-control-plaintext\"></div></div>\r\n");
      out.write("          <div class=\"col-md-6\"><label>Trạng thái</label><div id=\"v_status\" class=\"form-control-plaintext\"></div></div>\r\n");
      out.write("          <div class=\"col-md-6\"><label>Loại yêu cầu</label>\r\n");
      out.write("            <select id=\"v_category_inp\" class=\"form-control\" disabled>\r\n");
      out.write("              <option value=\"technical\">Kỹ thuật</option>\r\n");
      out.write("              <option value=\"billing\">Thanh toán</option>\r\n");
      out.write("              <option value=\"general\">Chung</option>\r\n");
      out.write("              <option value=\"complaint\">Khiếu nại</option>\r\n");
      out.write("            </select>\r\n");
      out.write("          </div>\r\n");
      out.write("          <div class=\"col-md-6\"><label>Ưu tiên</label>\r\n");
      out.write("            <select id=\"v_priority_inp\" class=\"form-control\" disabled>\r\n");
      out.write("              <option value=\"urgent\">Cao</option>\r\n");
      out.write("              <option value=\"high\">Trung bình</option>\r\n");
      out.write("              <option value=\"medium\">Thường</option>\r\n");
      out.write("              <option value=\"low\">Thấp</option>\r\n");
      out.write("            </select>\r\n");
      out.write("          </div>\r\n");
      out.write("          <div class=\"col-12\"><label>Tiêu đề</label><input id=\"v_subject_inp\" class=\"form-control\" disabled/></div>\r\n");
      out.write("          <div class=\"col-12\"><label>Chi tiết vấn đề</label><textarea id=\"v_description_inp\" class=\"form-control\" rows=\"4\" disabled></textarea></div>\r\n");
      out.write("          <div class=\"col-md-6\"><label>Ngày tạo</label><div id=\"v_created\" class=\"form-control-plaintext\"></div></div>\r\n");
      out.write("          <div class=\"col-md-6\"><label>Ngày xử lý xong</label><div id=\"v_resolved\" class=\"form-control-plaintext\"></div></div>\r\n");
      out.write("          <div class=\"col-12 d-flex align-items-center justify-content-between\">\r\n");
      out.write("            <div class=\"form-check\">\r\n");
      out.write("              <input class=\"form-check-input\" type=\"checkbox\" id=\"v_enable_edit\">\r\n");
      out.write("              <label class=\"form-check-label\" for=\"v_enable_edit\">Cho phép chỉnh sửa (ủy quyền)</label>\r\n");
      out.write("            </div>\r\n");
      out.write("            <button type=\"button\" id=\"v_save_btn\" class=\"btn btn-success\" disabled>Lưu thành yêu cầu mới</button>\r\n");
      out.write("          </div>\r\n");
      out.write("        </div>\r\n");
      out.write("      </div>\r\n");
      out.write("      <div class=\"modal-footer\">\r\n");
      out.write("        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Đóng</button>\r\n");
      out.write("      </div>\r\n");
      out.write("    </div>\r\n");
      out.write("  </div>\r\n");
      out.write("</div>\r\n");
      out.write("<script>\r\n");
      out.write("  // Tự động set ngày hiện tại cho trường \"Ngày tạo\"\r\n");
      out.write("  document.addEventListener('DOMContentLoaded', function() {\r\n");
      out.write("    var today = new Date().toISOString().split('T')[0];\r\n");
      out.write("    document.getElementById('createdDate').value = today;\r\n");
      out.write("    \r\n");
      out.write("    const ctx = '");
      out.print(request.getContextPath());
      out.write("';\r\n");
      out.write("    const tbody = document.getElementById('supportRows');\r\n");
      out.write("    const pagerContainer = document.querySelector('.pagination.custom-pagination');\r\n");
      out.write("    let allItems = [];\r\n");
      out.write("    let filteredItems = [];\r\n");
      out.write("    let currentPage = 1;\r\n");
      out.write("    const pageSize = 9;\r\n");
      out.write("    let cancelledItems = new Set(); // Lưu trữ các ID đã hủy trên frontend\r\n");
      out.write("    let searchTerm = ''; // Lưu từ khóa tìm kiếm\r\n");
      out.write("    function formatDate(it){\r\n");
      out.write("      if (it.createdDate && typeof it.createdDate === 'string' && it.createdDate.includes('-')) {\r\n");
      out.write("        var parts = it.createdDate.split('-');\r\n");
      out.write("        if (parts.length === 3) return parts[2] + '/' + parts[1] + '/' + parts[0];\r\n");
      out.write("      }\r\n");
      out.write("      if (it.createdAt) {\r\n");
      out.write("        try {\r\n");
      out.write("          return new Intl.DateTimeFormat('vi-VN', { timeZone: 'Asia/Ho_Chi_Minh' }).format(new Date(it.createdAt));\r\n");
      out.write("        } catch (e) {}\r\n");
      out.write("      }\r\n");
      out.write("      return '';\r\n");
      out.write("    }\r\n");
      out.write("    \r\n");
      out.write("    function getStatusText(status) {\r\n");
      out.write("      const statusMap = {\r\n");
      out.write("        'pending': 'Chờ xử lý',\r\n");
      out.write("        'open': 'Chờ xử lý',\r\n");
      out.write("        'in_progress': 'Đang xử lý',\r\n");
      out.write("        'resolved': 'Đã giải quyết',\r\n");
      out.write("        'cancelled': 'Đã hủy',\r\n");
      out.write("        'closed': 'Đã đóng'\r\n");
      out.write("      };\r\n");
      out.write("      return statusMap[status] || 'Chờ xử lý';\r\n");
      out.write("    }\r\n");
      out.write("    \r\n");
      out.write("    function getStatusClass(status) {\r\n");
      out.write("      const classMap = {\r\n");
      out.write("        'pending': 'bg-warning',\r\n");
      out.write("        'open': 'bg-warning',\r\n");
      out.write("        'in_progress': 'bg-info',\r\n");
      out.write("        'resolved': 'bg-success',\r\n");
      out.write("        'cancelled': 'bg-danger',\r\n");
      out.write("        'closed': 'bg-secondary'\r\n");
      out.write("      };\r\n");
      out.write("      return classMap[status] || 'bg-warning';\r\n");
      out.write("    }\r\n");
      out.write("    \r\n");
      out.write("    function filterItems() {\r\n");
      out.write("      if (!searchTerm.trim()) {\r\n");
      out.write("        filteredItems = [...allItems];\r\n");
      out.write("      } else {\r\n");
      out.write("        const term = searchTerm.toLowerCase();\r\n");
      out.write("        filteredItems = allItems.filter(function(item) {\r\n");
      out.write("          return (\r\n");
      out.write("            (item.subject && item.subject.toLowerCase().includes(term)) ||\r\n");
      out.write("            (item.description && item.description.toLowerCase().includes(term)) ||\r\n");
      out.write("            (item.category && item.category.toLowerCase().includes(term)) ||\r\n");
      out.write("            (item.priority && item.priority.toLowerCase().includes(term)) ||\r\n");
      out.write("            (item.ticketNumber && item.ticketNumber.toLowerCase().includes(term))\r\n");
      out.write("          );\r\n");
      out.write("        });\r\n");
      out.write("      }\r\n");
      out.write("    }\r\n");
      out.write("    \r\n");
      out.write("    function rows(items){\r\n");
      out.write("      tbody.innerHTML = '';\r\n");
      out.write("      if(!items || !items.length){\r\n");
      out.write("        tbody.innerHTML = '<tr><td colspan=\"7\" class=\"text-center\">Chưa có yêu cầu nào</td></tr>';\r\n");
      out.write("        return;\r\n");
      out.write("      }\r\n");
      out.write("      items.forEach(function(it, idx){\r\n");
      out.write("        const created = formatDate(it);\r\n");
      out.write("        // Ưu tiên trạng thái đã hủy trên frontend\r\n");
      out.write("        const finalStatus = cancelledItems.has(String(it.id)) ? 'cancelled' : (it.status || 'pending');\r\n");
      out.write("        const status = getStatusText(finalStatus);\r\n");
      out.write("        const statusClass = getStatusClass(finalStatus);\r\n");
      out.write("        const tr = document.createElement('tr');\r\n");
      out.write("        // Chỉ hiển thị nút hủy khi có thể hủy (pending hoặc open)\r\n");
      out.write("        const canCancel = finalStatus === 'pending' || finalStatus === 'open';\r\n");
      out.write("        const cancelButton = canCancel ? '<a href=\"#\" class=\"cancel-link text-danger\" data-id=\"'+ (it.id||'') +'\">Hủy</a>' : '';\r\n");
      out.write("        // Tính số thứ tự theo thời gian tạo (mới nhất = 1)\r\n");
      out.write("        const sequenceNumber = (currentPage - 1) * pageSize + idx + 1;\r\n");
      out.write("        tr.innerHTML = '<td>'+ sequenceNumber +'</td><td>'+ (it.category||'') +'</td><td>'+ (it.priority||'') +'</td><td>'+ (it.description||'') +'</td><td>'+ created +'</td><td><span class=\"badge ' + statusClass + '\">' + status + '</span></td><td><a href=\"#\" class=\"view-link me-2\" data-id=\"'+ (it.id||'') +'\">Xem</a> ' + cancelButton + '</td>';\r\n");
      out.write("        tbody.appendChild(tr);\r\n");
      out.write("      });\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    function renderPagination(totalItems){\r\n");
      out.write("      if(!pagerContainer) return;\r\n");
      out.write("      const totalPages = Math.max(1, Math.ceil(totalItems / pageSize));\r\n");
      out.write("      let html = '';\r\n");
      out.write("      html += '<li class=\"page-item'+(currentPage===1?' disabled':'')+'\"><a class=\"page-link\" href=\"#\" data-page=\"prev\">Trước</a></li>';\r\n");
      out.write("      // show only current page number\r\n");
      out.write("      html += '<li class=\"page-item active\"><a class=\"page-link\" href=\"#\" data-page=\"'+currentPage+'\">'+currentPage+'</a></li>';\r\n");
      out.write("      html += '<li class=\"page-item'+(currentPage===totalPages?' disabled':'')+'\"><a class=\"page-link\" href=\"#\" data-page=\"next\">Tiếp</a></li>';\r\n");
      out.write("      pagerContainer.innerHTML = html;\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    function renderPage(page){\r\n");
      out.write("      const total = filteredItems.length;\r\n");
      out.write("      const totalPages = Math.max(1, Math.ceil(total / pageSize));\r\n");
      out.write("      if(page === 'prev') page = Math.max(1, currentPage - 1);\r\n");
      out.write("      if(page === 'next') page = Math.min(totalPages, currentPage + 1);\r\n");
      out.write("      page = Math.min(Math.max(1, parseInt(page||1,10)), totalPages);\r\n");
      out.write("      currentPage = page;\r\n");
      out.write("      const start = (page - 1) * pageSize;\r\n");
      out.write("      const end = start + pageSize;\r\n");
      out.write("      const pageItems = filteredItems.slice(start, end);\r\n");
      out.write("      rows(pageItems);\r\n");
      out.write("      renderPagination(total);\r\n");
      out.write("    }\r\n");
      out.write("    function load(){\r\n");
      out.write("      fetch(ctx + '/api/support-requests?action=list', {headers:{'Accept':'application/json'}})\r\n");
      out.write("        .then(r=>r.json()).then(j=>{ \r\n");
      out.write("          allItems = Array.isArray(j.data)? j.data : []; \r\n");
      out.write("          filterItems();\r\n");
      out.write("          renderPage(1); \r\n");
      out.write("        })\r\n");
      out.write("        .catch(()=>{tbody.innerHTML='<tr><td colspan=\"7\" class=\"text-center text-danger\">Lỗi tải dữ liệu</td></tr>';});\r\n");
      out.write("    }\r\n");
      out.write("    load();\r\n");
      out.write("\r\n");
      out.write("    // Thêm chức năng tìm kiếm\r\n");
      out.write("    const searchInput = document.querySelector('.support-search input');\r\n");
      out.write("    if (searchInput) {\r\n");
      out.write("      searchInput.addEventListener('input', function(e) {\r\n");
      out.write("        searchTerm = e.target.value;\r\n");
      out.write("        filterItems();\r\n");
      out.write("        renderPage(1);\r\n");
      out.write("      });\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    if (pagerContainer) {\r\n");
      out.write("      pagerContainer.addEventListener('click', function(e){\r\n");
      out.write("        const a = e.target.closest('a[data-page]');\r\n");
      out.write("        if(!a) return;\r\n");
      out.write("        e.preventDefault();\r\n");
      out.write("        const p = a.getAttribute('data-page');\r\n");
      out.write("        renderPage(p === 'prev' || p === 'next' ? p : parseInt(p,10));\r\n");
      out.write("      });\r\n");
      out.write("    }\r\n");
      out.write("\r\n");
      out.write("    // Handle submit\r\n");
      out.write("    document.getElementById('supportForm').addEventListener('submit', function(e){\r\n");
      out.write("      e.preventDefault();\r\n");
      out.write("      const form = e.target;\r\n");
      out.write("      const data = new URLSearchParams();\r\n");
      out.write("      data.append('subject', document.getElementById('subject').value || '');\r\n");
      out.write("      data.append('description', document.getElementById('description').value || '');\r\n");
      out.write("      data.append('category', document.getElementById('category').value || 'general');\r\n");
      out.write("      data.append('priority', document.getElementById('priority').value || 'medium');\r\n");
      out.write("      fetch(ctx + '/api/support-requests', {\r\n");
      out.write("        method: 'POST',\r\n");
      out.write("        headers: { 'Content-Type': 'application/x-www-form-urlencoded', 'Accept': 'application/json' },\r\n");
      out.write("        body: data.toString()\r\n");
      out.write("      }).then(r=>r.json())\r\n");
      out.write("        .then(j=>{\r\n");
      out.write("          if(j && j.success){\r\n");
      out.write("            form.reset();\r\n");
      out.write("            const modalEl = document.getElementById('supportModal');\r\n");
      out.write("            const modal = bootstrap.Modal.getInstance(modalEl) || new bootstrap.Modal(modalEl);\r\n");
      out.write("            modal.hide();\r\n");
      out.write("            load();\r\n");
      out.write("          } else {\r\n");
      out.write("            alert(j && j.message ? j.message : 'Không thể tạo yêu cầu');\r\n");
      out.write("          }\r\n");
      out.write("        })\r\n");
      out.write("        .catch(()=> alert('Lỗi kết nối máy chủ'));\r\n");
      out.write("    });\r\n");
      out.write("\r\n");
      out.write("    // View detail handler\r\n");
      out.write("    tbody.addEventListener('click', function(e){\r\n");
      out.write("      const viewLink = e.target.closest('a.view-link');\r\n");
      out.write("      const cancelLink = e.target.closest('a.cancel-link');\r\n");
      out.write("      \r\n");
      out.write("      if(viewLink) {\r\n");
      out.write("        e.preventDefault();\r\n");
      out.write("        const id = viewLink.getAttribute('data-id');\r\n");
      out.write("        const it = allItems.find(function(x){ return String(x.id) === String(id); });\r\n");
      out.write("        if(!it) return;\r\n");
      out.write("      document.getElementById('v_ticket').textContent = it.ticketNumber || '';\r\n");
      out.write("      document.getElementById('v_status').textContent = it.status || '';\r\n");
      out.write("      // fill editable inputs\r\n");
      out.write("      var catInp = document.getElementById('v_category_inp');\r\n");
      out.write("      var priInp = document.getElementById('v_priority_inp');\r\n");
      out.write("      var subInp = document.getElementById('v_subject_inp');\r\n");
      out.write("      var desInp = document.getElementById('v_description_inp');\r\n");
      out.write("      if (catInp) catInp.value = (it.category||'general');\r\n");
      out.write("      if (priInp) priInp.value = (it.priority||'medium');\r\n");
      out.write("      if (subInp) subInp.value = (it.subject||'');\r\n");
      out.write("      if (desInp) desInp.value = (it.description||'');\r\n");
      out.write("      const created = formatDate(it);\r\n");
      out.write("      const resolved = (it.resolvedAt ? new Intl.DateTimeFormat('vi-VN', { timeZone: 'Asia/Ho_Chi_Minh' }).format(new Date(it.resolvedAt)) : '');\r\n");
      out.write("      document.getElementById('v_created').textContent = created;\r\n");
      out.write("      document.getElementById('v_resolved').textContent = resolved;\r\n");
      out.write("      const vm = bootstrap.Modal.getOrCreateInstance(document.getElementById('viewModal'));\r\n");
      out.write("      vm.show();\r\n");
      out.write("      // reset edit state\r\n");
      out.write("      const enable = document.getElementById('v_enable_edit');\r\n");
      out.write("      const saveBtn = document.getElementById('v_save_btn');\r\n");
      out.write("      [catInp, priInp, subInp, desInp].forEach(function(el){ if(el){ el.disabled = true; }});\r\n");
      out.write("      if (enable) enable.checked = false;\r\n");
      out.write("      if (saveBtn) saveBtn.disabled = true;\r\n");
      out.write("      \r\n");
      out.write("      // Kiểm tra trạng thái để quyết định có cho phép chỉnh sửa không\r\n");
      out.write("      const finalStatus = cancelledItems.has(String(id)) ? 'cancelled' : (it.status || 'pending');\r\n");
      out.write("      const canEdit = finalStatus === 'pending' || finalStatus === 'open';\r\n");
      out.write("      \r\n");
      out.write("      // Disable checkbox nếu không thể chỉnh sửa\r\n");
      out.write("      if (enable) {\r\n");
      out.write("        enable.disabled = !canEdit;\r\n");
      out.write("        if (!canEdit) {\r\n");
      out.write("          enable.title = 'Chỉ có thể chỉnh sửa yêu cầu đang chờ xử lý';\r\n");
      out.write("        }\r\n");
      out.write("      }\r\n");
      out.write("      \r\n");
      out.write("      // attach handlers\r\n");
      out.write("      if (enable) {\r\n");
      out.write("        enable.onchange = function(){\r\n");
      out.write("          if (!canEdit) {\r\n");
      out.write("            alert('Chỉ có thể chỉnh sửa yêu cầu đang chờ xử lý!');\r\n");
      out.write("            enable.checked = false;\r\n");
      out.write("            return;\r\n");
      out.write("          }\r\n");
      out.write("          var on = !!enable.checked;\r\n");
      out.write("          [catInp, priInp, subInp, desInp].forEach(function(el){ if(el){ el.disabled = !on; }});\r\n");
      out.write("          if (saveBtn) saveBtn.disabled = !on;\r\n");
      out.write("        };\r\n");
      out.write("      }\r\n");
      out.write("      if (saveBtn) {\r\n");
      out.write("        saveBtn.onclick = function(){\r\n");
      out.write("          const data = new URLSearchParams();\r\n");
      out.write("          data.append('subject', subInp.value || '');\r\n");
      out.write("          data.append('description', desInp.value || '');\r\n");
      out.write("          data.append('category', catInp.value || 'general');\r\n");
      out.write("          data.append('priority', priInp.value || 'medium');\r\n");
      out.write("          data.append('delete_old_id', id); // thêm ID để xóa bản cũ\r\n");
      out.write("          fetch(ctx + '/api/support-requests', {\r\n");
      out.write("            method: 'POST',\r\n");
      out.write("            headers: { 'Content-Type': 'application/x-www-form-urlencoded', 'Accept': 'application/json' },\r\n");
      out.write("            body: data.toString()\r\n");
      out.write("          }).then(r=>r.json()).then(function(j){\r\n");
      out.write("            if(j && j.success){\r\n");
      out.write("              vm.hide();\r\n");
      out.write("              load();\r\n");
      out.write("              renderPage(1);\r\n");
      out.write("            } else {\r\n");
      out.write("              alert(j && j.message ? j.message : 'Không thể cập nhật');\r\n");
      out.write("            }\r\n");
      out.write("          }).catch(function(){ alert('Lỗi kết nối máy chủ'); });\r\n");
      out.write("        };\r\n");
      out.write("      }\r\n");
      out.write("      }\r\n");
      out.write("      \r\n");
      out.write("      if(cancelLink) {\r\n");
      out.write("        e.preventDefault();\r\n");
      out.write("        const id = cancelLink.getAttribute('data-id');\r\n");
      out.write("        const it = allItems.find(function(x){ return String(x.id) === String(id); });\r\n");
      out.write("        if(!it) return;\r\n");
      out.write("        \r\n");
      out.write("        // Kiểm tra trạng thái trước khi hủy\r\n");
      out.write("        const finalStatus = cancelledItems.has(String(id)) ? 'cancelled' : (it.status || 'pending');\r\n");
      out.write("        if(finalStatus === 'cancelled') {\r\n");
      out.write("          alert('Yêu cầu này đã được hủy rồi!');\r\n");
      out.write("          return;\r\n");
      out.write("        }\r\n");
      out.write("        if(finalStatus !== 'pending' && finalStatus !== 'open') {\r\n");
      out.write("          alert('Chỉ có thể hủy yêu cầu đang chờ xử lý!');\r\n");
      out.write("          return;\r\n");
      out.write("        }\r\n");
      out.write("        \r\n");
      out.write("        if(confirm('Bạn có chắc chắn muốn hủy yêu cầu này?')) {\r\n");
      out.write("          // Đánh dấu item đã hủy và cập nhật hiển thị\r\n");
      out.write("          cancelledItems.add(String(id));\r\n");
      out.write("          renderPage(currentPage); // Cập nhật hiển thị ngay lập tức\r\n");
      out.write("          \r\n");
      out.write("          // Gửi request hủy yêu cầu đến server\r\n");
      out.write("          const data = new URLSearchParams();\r\n");
      out.write("          data.append('action', 'cancel');\r\n");
      out.write("          data.append('id', id);\r\n");
      out.write("          \r\n");
      out.write("          console.log('DEBUG: Sending cancel request with:', data.toString());\r\n");
      out.write("          fetch(ctx + '/api/support-requests', {\r\n");
      out.write("            method: 'POST',\r\n");
      out.write("            headers: { 'Content-Type': 'application/x-www-form-urlencoded', 'Accept': 'application/json' },\r\n");
      out.write("            body: data.toString()\r\n");
      out.write("          }).then(r=>r.json())\r\n");
      out.write("            .then(j=>{\r\n");
      out.write("              if(j && j.success){\r\n");
      out.write("                alert('Đã hủy yêu cầu thành công!');\r\n");
      out.write("                load(); // Reload danh sách từ server\r\n");
      out.write("              } else {\r\n");
      out.write("                // Nếu server từ chối, revert lại trạng thái\r\n");
      out.write("                cancelledItems.delete(String(id));\r\n");
      out.write("                renderPage(currentPage);\r\n");
      out.write("                alert(j && j.message ? j.message : 'Không thể hủy yêu cầu');\r\n");
      out.write("              }\r\n");
      out.write("            })\r\n");
      out.write("            .catch(()=> {\r\n");
      out.write("              // Nếu có lỗi kết nối, revert lại trạng thái\r\n");
      out.write("              cancelledItems.delete(String(id));\r\n");
      out.write("              renderPage(currentPage);\r\n");
      out.write("              alert('Lỗi kết nối máy chủ');\r\n");
      out.write("            });\r\n");
      out.write("        }\r\n");
      out.write("      }\r\n");
      out.write("    });\r\n");
      out.write("  });\r\n");
      out.write("</script>\r\n");
      out.write("    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\r\n");
      out.write("    <script>\r\n");
      out.write("        // Smooth scrolling for navigation links\r\n");
      out.write("        document.querySelectorAll('a[href^=\"#\"]').forEach(anchor => {\r\n");
      out.write("            anchor.addEventListener('click', function (e) {\r\n");
      out.write("                e.preventDefault();\r\n");
      out.write("                const target = document.querySelector(this.getAttribute('href'));\r\n");
      out.write("                if (target) {\r\n");
      out.write("                    target.scrollIntoView({\r\n");
      out.write("                        behavior: 'smooth',\r\n");
      out.write("                        block: 'start'\r\n");
      out.write("                    });\r\n");
      out.write("                }\r\n");
      out.write("            });\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        // Add scroll effect to navbar\r\n");
      out.write("        window.addEventListener('scroll', function() {\r\n");
      out.write("            const navbar = document.querySelector('.navbar');\r\n");
      out.write("            if (window.scrollY > 50) {\r\n");
      out.write("                navbar.classList.add('scrolled');\r\n");
      out.write("            } else {\r\n");
      out.write("                navbar.classList.remove('scrolled');\r\n");
      out.write("            }\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        // Banner indicators functionality\r\n");
      out.write("        const bannerIndicators = document.querySelectorAll('.banner-indicators .indicator');\r\n");
      out.write("        bannerIndicators.forEach((indicator, index) => {\r\n");
      out.write("            indicator.addEventListener('click', function() {\r\n");
      out.write("                bannerIndicators.forEach(ind => ind.classList.remove('active'));\r\n");
      out.write("                this.classList.add('active');\r\n");
      out.write("            });\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        // Quote indicators functionality\r\n");
      out.write("        const quoteIndicators = document.querySelectorAll('.quote-indicators .quote-indicator');\r\n");
      out.write("        quoteIndicators.forEach((indicator, index) => {\r\n");
      out.write("            indicator.addEventListener('click', function() {\r\n");
      out.write("                quoteIndicators.forEach(ind => ind.classList.remove('active'));\r\n");
      out.write("                this.classList.add('active');\r\n");
      out.write("            });\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        // Floating icons functionality\r\n");
      out.write("        document.querySelectorAll('.floating-icon').forEach(icon => {\r\n");
      out.write("            icon.addEventListener('click', function() {\r\n");
      out.write("                if (this.classList.contains('phone')) {\r\n");
      out.write("                    window.location.href = 'tel:0989888999';\r\n");
      out.write("                } else if (this.classList.contains('facebook')) {\r\n");
      out.write("                    window.open('https://facebook.com', '_blank');\r\n");
      out.write("                } else if (this.classList.contains('zalo')) {\r\n");
      out.write("                    window.open('https://zalo.me/0989888999', '_blank');\r\n");
      out.write("                }\r\n");
      out.write("            });\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        // Learn more button functionality\r\n");
      out.write("        document.querySelector('.learn-more-btn .btn').addEventListener('click', function() {\r\n");
      out.write("            alert('Cảm ơn bạn đã quan tâm! Chúng tôi sẽ liên hệ lại sớm nhất.');\r\n");
      out.write("        });\r\n");
      out.write("    </script>\r\n");
      out.write("</body>\r\n");
      out.write("</html>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
